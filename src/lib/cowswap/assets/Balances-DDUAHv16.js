import{gx as Oe,gy as Ae,gz as Ee,gA as re,r as v,v as U,dS as ie,gB as ae,gC as J,gD as ye,j as e,aT as Ne,a9 as L,b0 as Ve,ak as x,gE as We,gF as te,eN as de,gG as le,gH as De,gI as F,gJ as Le,gK as H,dU as ue,bk as Me,bd as Re,gL as _e,gM as fe,gN as D,gO as y,gP as he,b$ as j,c2 as M,gQ as Ce,gR as be,cm as Be,ac as z,T as xe,cU as Ge,gS as pe,gT as $,gm as K,gn as q,gU as Z,gV as Pe,df as Ue,eY as Fe,gW as He,gX as ze,gY as k,gZ as $e,cP as Ke,g_ as qe,gv as Ze,gk as Ye,g$ as P,h0 as Je,co as Qe}from"./index-rJtv6IUT.js";import{r as d}from"./@sentry-C02iiIsL.js";import{C as N}from"./@uniswap-j9167AqE.js";import{u as me}from"./RoutesApp-C72GReYV.js";import"./@1inch-8aFH8gck.js";import"./web3-CuCGfqCq.js";import"./@safe-global-CsTz-vid.js";import"./index-CzQ2E3wO.js";const Xe=""+new URL("vCOW-C3OJ04r8.svg",import.meta.url).href;function se(n){const{chainId:a}=v(),t=J[a];return d.useMemo(()=>{if(!(!t||!n))return N.fromRawAmount(t,n.toString())},[n,t])}function en(){const{contract:n}=re(),{account:a}=v(),{data:t,isLoading:o}=U(a&&n?["useVCowData.swappableBalanceOf",a,n]:null,async([,f,C])=>C.swappableBalanceOf(f)),{data:c,isLoading:r}=U(a&&n?["useVCowData.balanceOf",a,n]:null,async([,f,C])=>C.balanceOf(f)),s=se(t),i=se(c),l=d.useMemo(()=>!i||!s||i.lessThan(s)?null:i.subtract(s),[i,s]),u=o||r;return d.useMemo(()=>({isLoading:u,vested:s,unvested:l,total:i}),[u,s,l,i])}function nn({openModal:n,closeModal:a}){const{account:t}=v(),{contract:o,chainId:c}=re(),r=ie(),s=c?J[c]:void 0;return d.useCallback(async()=>{if(!t)throw new Error("Not connected");if(!c)throw new Error("No chainId");if(!o)throw new Error("vCOW contract not present");if(!s)throw new Error("vCOW token not present");const i=await o.estimateGas.swapAll({from:t}).catch(()=>o.estimateGas.swapAll().catch(u=>(console.log("[useSwapVCowCallback] Error estimating gas for swapAll. Using default gas limit "+ae.toString(),u),ae))),l="Convert vCOW to COW";return n(l),o.swapAll({from:t,gasLimit:i}).then(u=>{r({swapVCow:!0,hash:u.hash,summary:l})}).finally(a)},[t,r,c,a,n,o,s])}function an(){const n=Oe();return d.useCallback(a=>n(Ae(a)),[n])}function tn(){return Ee(n=>n.cowToken.swapVCowStatus)}function sn(n){return`<svg width="14" height="14" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M8 0H6a6 6 0 0 0-6 6v2a6 6 0 0 0 6 6h2a6 6 0 0 0 6-6V6a6 6 0 0 0-6-6Z" fill="${n?"#C9DAED":"#FFFFFF"}"/>
    <path fill="${n?"#1E385E":"#000000"}" fill-rule="evenodd" clip-rule="evenodd" d="M10.258 5.734c-.2 1.8-1.5 2.4-2.8 3-1.3.4-1.9-1.5-.6-1.8.4-.2 1.5-.8 1.4-1.2 0-.9-1-1.4-1.7-1-.29.145-.423.396-.55.638-.048.09-.095.18-.15.262-.4.6-1.4.4-1.6-.2-.4-1 .5-1.9 1.3-2.4 1.9-1.3 4.7.3 4.7 2.7Zm-3.1 3.9c-1.3 0-1.3 2 0 2 1.3-.1 1.3-2 0-2Z" />
  </svg>`}const on=Ne.div.withConfig({displayName:"HelpCircle__HelpCircleWrapper",componentId:"sc-g0gghs-0"})(["display:flex;align-items:center;> svg{opacity:0.5;transition:opacity var(",") ease-in-out;&:hover{opacity:1;}}"],Ve.ANIMATION_DURATION);function R({size:n}){const a=ye();return e.jsx(on,{children:e.jsx(L,{width:n||14,height:n||14,src:sn(a)})})}const cn=["0x00000000cc0b822819f03424dacf9077fdaa58a3","0x06d4b89475a53111e8939b1ae8af7e14804a5186","0x0f1c44076d4cf58e1458a418393e6be57f3519f9","0x1702f2d0df7c99011a690461c34e51bd81cbab48","0x1ec30dec8378e6df6988da0e8a2b49b17055f0aa","0x26404746cd2228018f86c98f580e5030b06ff3c8","0x3047fa36aa687014f3ead30e4873adc3f58467bf","0x3812364136fe59a5db130666925be092050bd8ba","0x4193e4ca2241d4d16356a94da537e3c3a600678c","0x499487f6be895b71cf57881c22d5f6d855fcb8a2","0x52077db357420b6999b6b78c46c3ab2fc596fba8","0x5aa6a1d420bf8fa45d141af73e9230e1e8c3dc16","0x61fde66b0a208be7096ffa314d7cd92f519b2352","0x6b504204a85e0231b1a1b1926b9264939f29c65e","0x7246a274656e797fab4b02eb1e0581d46f0358e2","0x79a074122be96e1fc9bdd32dba04759421d12f90","0x817a33e007afb85ec23da7de231c1902cf4686c1","0x882289186d7b1b9cd35191780761ee80975f0fd1","0x90fa3f3c3a290ee19bbc94dc539dede8e21ce28f","0x99c72eb5c22c38137541ef4b9a2fd0316c42b510","0xa1e63c0f203df1314153ad6648bd38fd99774d85","0xabe8430e3f0beca32915da84e530f81a01379953","0xb6271e5a916f3764c5d3387dff14922249d9d70f","0xbf8ab1e63a9b883a6b5a396cb5a36138af6e020a","0xc789026a0f0b15c532c77405491331997f2b2bbc","0xce57ebed9ac38402dcaa44f65a1c9b04e26b8283","0xd64c69277d2c842c9ab17683479ac063aa35d4f5","0xdfeb9c25186aadf1487979be7da312f95fd55275","0xe6f44434c052c00d280bc236c8f58d8a9e42eec8","0xee9ec3273c52ea783b86cfefab32b50b1b26fce7","0xf6330ad6f2d488f6f29cf45e8fa5bf798e3b8df3","0xff36b9cb75c9178841d8b75baf9776bfa59fbe9d"],rn=["0x00000081c22fe36e0b47a4f1c67041301f945014","0x0d78a4b2657dd319ae1f47ce5e529d03e984cef5","0x2059a96525c364560a806ca035a40c9f379ebca9","0x32ae635f5136adb181a442cc890be39263bc13c8","0x44dde9695027ca6acb7cdf3b361c37056122e4af","0x51ffd343d6fecab9e9c5640f0e6a67dec31bc76c","0x63829da9dc103b63d984391f7580eddb220ba6d9","0x773d161310d07cafc6f767ca24f43e52163b9be6","0x8642214d3cb4eb38ee618be37f78dd74a3093869","0x98b7a46a33d60f71522115ab7e2ec8f0fc294038","0xaa942b60823be690a17576207b819807891d71f6","0xbbf7bfc4d9acce27082613e2c14d9fe8d1a54a29","0xcb11673592cc6c4b9584f33bbba6c6cf07dde3f7","0xdb0b39341290a30510e46e7692195fe16097e0df","0xe91f64ca1da165ca8437686b69a022156550837b","0xf64c2e6679e089cd1c3e303ca1245d4941747700"],dn={[x.SupportedChainId.MAINNET]:rn,[x.SupportedChainId.GNOSIS_CHAIN]:cn,[x.SupportedChainId.ARBITRUM_ONE]:[],[x.SupportedChainId.BASE]:[],[x.SupportedChainId.SEPOLIA]:[]},ln={[x.SupportedChainId.MAINNET]:"mainnet",[x.SupportedChainId.GNOSIS_CHAIN]:"gnosisChain",[x.SupportedChainId.ARBITRUM_ONE]:null,[x.SupportedChainId.BASE]:null,[x.SupportedChainId.SEPOLIA]:null},un="main",we=async(n,a)=>{const t=ln[a];if(!t)return null;const o=n.toLowerCase(),c=dn[a],r=fn(c,o);return r===-1?null:(await hn(`${t}/chunk_${r}.json`))[o]||null},fn=(n,a)=>{let t=n.findIndex(o=>a<o);return t===-1&&(t=n.length),t-1},oe=new Map,hn=n=>{const a=oe.get(n)??fetch(`https://raw.githubusercontent.com/gnosis/locked-gno-cow-merkle-distro/${un}/${n}`).then(t=>t.json());return oe.set(n,a),a},Y=le[x.SupportedChainId.MAINNET],Cn=()=>de(H,Le,!0),ge=()=>de(F,De,!0),bn=()=>{const{chainId:n,account:a}=v(),t=d.useRef(N.fromRawAmount(Y,0)),[o,c]=d.useState(t.current);return d.useEffect(()=>{let r=!1;return a&&n?we(a,n).then(s=>{r||c(N.fromRawAmount(Y,(s==null?void 0:s.amount)??0))}):c(t.current),()=>{r=!0}},[n,a,t]),o},xn=()=>{const{account:n}=v(),a=bn(),t=a.multiply(Math.min(Date.now()-We,te)).divide(te),{contract:o}=ge(),{data:c,isLoading:r}=U(n&&o&&(a!=null&&a.greaterThan(0))?["useCowFromLockedGnoBalances",n,a,o]:null,async([,i,,l])=>l.balances(i)),s=d.useMemo(()=>N.fromRawAmount(Y,c?c.claimed.toString():0),[c]);return d.useMemo(()=>({allocated:a,vested:t,claimed:s,loading:r}),[a,t,s,r])};function pn({openModal:n,closeModal:a,isFirstClaim:t}){const{account:o}=v(),{contract:c,chainId:r}=Cn(),{contract:s,chainId:i}=ge(),l=ie();return d.useCallback(async()=>{if(!o)throw new Error("Not connected");if(!c||!s)throw new Error("Contract not present or not connected to any supported chain");if(r!==i)throw new Error("Contract and chainId are not on the same chain");const u=await we(o,i);if(!u)throw new Error("Trying to claim without claim data");const{index:f,proof:C,amount:T}=u,O=t?c.claim(f,T,C):s.claim(),p="Claim vested COW";return n(p),O.then(b=>(l({swapLockedGNOvCow:!0,hash:b.hash,summary:p}),b)).finally(a)},[o,l,a,n,t,c,s,r,i])}var ce;(function(n){n[n.INITIAL=0]="INITIAL",n[n.ATTEMPTING=1]="ATTEMPTING",n[n.SUBMITTED=2]="SUBMITTED",n[n.CONFIRMED=3]="CONFIRMED"})(ce||(ce={}));const mn=({openModal:n,closeModal:a,vested:t,allocated:o,claimed:c,loading:r})=>{const{chainId:s=x.SupportedChainId.MAINNET,account:i}=v(),[l,u]=d.useState(0),f=o.subtract(t),C=ue(i),T=!r&&f.greaterThan(0)&&l===0&&H[s]&&F[s],O=l===2,{handleSetError:p,handleCloseError:b,ErrorModal:_}=me(),V=c.equalTo(0),I=pn({openModal:n,closeModal:a,isFirstClaim:V}),A=V?H[s]:F[s],E=Me(),S=d.useCallback(h=>{E.sendEvent({category:Re.CLAIM_COW_FOR_LOCKED_GNO,action:h,label:"GNO"})},[E]),B=d.useCallback(async()=>{b(),I&&(u(1),S("Claim"),I().then(h=>(S("Sign"),u(2),h.wait())).then(h=>{const m=h.status===1;u(m?3:0),setTimeout(()=>{u(0)},5e3)}).catch(h=>{let m;const g=_e(h);g?m="User rejected signing COW claim transaction":(m=fe(h),console.error("Error Signing locked GNO COW claiming",h)),console.error("[Profile::LockedGnoVesting::index::claimCallback]::error",m),u(0),S(g?"Reject":"Error"),p(m)}))},[b,p,I,S]);return d.useEffect(()=>{i&&C&&i!==C&&l!==0&&u(0)},[i,C,l]),o.equalTo(0)?null:e.jsxs(e.Fragment,{children:[e.jsxs(D,{showLoader:r||O,children:[e.jsxs(y,{hAlign:"left",children:[e.jsx("img",{src:he,alt:"COW token",width:"56",height:"56"}),e.jsxs("span",{children:[e.jsx("i",{children:"COW vesting from locked GNO"}),e.jsxs("b",{children:[e.jsx(j,{amount:o,defaultValue:"0",tokenSymbol:o.currency}),e.jsx(M,{wrapInContainer:!0,content:e.jsxs(Ce,{children:[e.jsxs("span",{children:[e.jsx("i",{children:"Unvested"})," ",e.jsx("p",{children:e.jsx(j,{amount:f,defaultValue:"0",tokenSymbol:f.currency})})]}),e.jsxs("span",{children:[e.jsx("i",{children:"Vested"})," ",e.jsx("p",{children:e.jsx(j,{amount:t,defaultValue:"0",tokenSymbol:t.currency})})]})]}),children:e.jsx(R,{size:14})})]})]})]}),e.jsxs(be,{children:[e.jsxs(y,{titleSize:18,altColor:!0,children:[e.jsxs("i",{children:["Claimable"," ",e.jsx(M,{wrapInContainer:!0,content:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"COW vesting from the GNO lock"})," is vested linearly over four years, starting on"," ",Be(Pe),"."]}),e.jsx("p",{children:"Each time you claim, you will receive the entire claimable amount."})]}),children:e.jsx(R,{size:14})})]}),e.jsx("b",{children:e.jsx(j,{amount:t.subtract(c),defaultValue:"0"})})]}),l===3?e.jsx(z,{disabled:!0,children:e.jsx(xe,{id:"lEfkow"})}):e.jsx(z,{buttonSize:Ge.SMALL,onClick:B,disabled:!T,children:O?"Claiming COW...":e.jsxs(e.Fragment,{children:["Claim COW ",e.jsx(L,{src:pe})]})})]}),e.jsxs($,{children:[e.jsx(K,{href:q(s,"address",A),children:"View contract ↗"}),e.jsx(Z,{toCopy:A,children:e.jsx("div",{title:"Click to copy contract address",children:"Copy contract"})})]})]}),e.jsx(_,{})]})},wn=2;function An(){const n=Ue(),{account:a,chainId:t}=v(),o=ue(a),c=Fe(),r=He(),[s,i]=d.useState(void 0),[l,u]=d.useState(!1),f=an(),C=tn(),{loading:T,...O}=xn(),p=le[t],b=J[t],_=ze(t?p:void 0)||N.fromRawAmount(p,0),{unvested:V,vested:I,total:A,isLoading:E}=en(),S=I&&!I.equalTo(0),B=A&&!A.equalTo(0),h=C===k.SUBMITTED,m=C===k.INITIAL,g=C===k.CONFIRMED,je=!!(!S||!m||h||g||l),Ie=d.useMemo(()=>{let w=E||T||!n;return setTimeout(()=>{w=!1},5e3),w},[T,E,n]),{handleSetError:Q,handleCloseError:X,ErrorModal:Se}=me(),{isModalOpen:ke,openModal:ee,closeModal:W}=$e(),G=nn({openModal:ee,closeModal:W}),ve=d.useCallback(async()=>{X(),G&&(f(k.ATTEMPTING),G().then(()=>{f(k.SUBMITTED)}).catch(w=>{console.error("[Profile::index::swapVCowCallback]::error",w),f(k.INITIAL),Q(fe(w))}))},[X,Q,f,G]),ne={balanceBreakdown:e.jsxs(Ce,{children:[e.jsxs("span",{children:[e.jsx("i",{children:"Unvested"})," ",e.jsx("p",{children:e.jsx(j,{amount:V,defaultValue:"0",tokenSymbol:b})})]}),e.jsxs("span",{children:[e.jsx("i",{children:"Vested"})," ",e.jsx("p",{children:e.jsx(j,{amount:l?void 0:I,defaultValue:"0",tokenSymbol:b})})]})]}),vested:e.jsxs("div",{children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Vested vCOW"})," is the portion of your vCOW token balance, which is fully available to convert to COW token."]}),e.jsxs("p",{children:["This includes any vCOW received through an ",e.jsx("strong",{children:"airdrop."})]}),e.jsx("p",{children:"When converting your vested vCOW balance to COW, your entire vested balance will be converted."})]})},Te=d.useCallback(()=>{let w=null;return h?w=e.jsx("span",{children:"Converting vCOW..."}):g?w=e.jsx("span",{children:"Successfully converted!"}):w=e.jsxs(e.Fragment,{children:["Convert to COW ",e.jsx(L,{src:pe})]}),w},[g,h]);return d.useEffect(()=>{g&&!s&&(i(r),u(!0)),!(!s||!r)&&g&&r-s>wn&&S&&(f(k.INITIAL),i(void 0),u(!1))},[r,s,S,g,f,l]),d.useEffect(()=>{a&&o&&a!==o&&!m&&f(k.INITIAL)},[a,m,o,f]),e.jsxs(e.Fragment,{children:[e.jsx(Ke,{isOpen:ke,onDismiss:W,children:e.jsx(qe,{modalMode:!0,onDismiss:W,title:"Convert vCOW to COW",description:"Converting vCOW to COW",operationLabel:"vCOW conversion"})}),e.jsx(Se,{}),Ie&&!c?e.jsx(D,{children:e.jsx(Ze,{children:e.jsx(Ye,{size:"42px"})})}):e.jsxs(e.Fragment,{children:[B&&b&&e.jsxs(D,{showLoader:E||h,children:[e.jsxs(y,{hAlign:"left",children:[e.jsx(L,{src:Xe,title:"vCOW token",width:"56",height:"56"}),e.jsxs("span",{children:[e.jsx("i",{children:e.jsx(xe,{id:"7Wv4za"})}),e.jsxs("b",{children:[e.jsx(j,{amount:A,defaultValue:"0",tokenSymbol:b})," ",e.jsx(M,{content:ne.balanceBreakdown,wrapInContainer:!0,children:e.jsx(R,{size:14})})]})]})]}),e.jsxs(be,{children:[e.jsxs(y,{titleSize:18,altColor:!0,children:[e.jsxs("i",{children:["Vested"," ",e.jsx(M,{content:ne.vested,wrapInContainer:!0,children:e.jsx(R,{size:14})})]}),e.jsx("b",{children:e.jsx(j,{amount:l?void 0:I,defaultValue:"0"})})]}),e.jsx(z,{onClick:ve,disabled:je,children:Te()})]}),e.jsxs($,{children:[e.jsx(K,{href:q(t,"token",b.address),children:"View contract ↗"}),e.jsx(Z,{toCopy:b.address,children:e.jsx("div",{title:"Click to copy token contract address",children:"Copy contract"})})]})]}),e.jsxs(D,{children:[e.jsxs(y,{titleSize:26,children:[e.jsx("img",{src:he,alt:"Cow Balance",height:"80",width:"80"}),e.jsxs("span",{children:[e.jsx("i",{children:"Available COW balance"}),e.jsx("b",{children:!c&&e.jsx(j,{amount:_,defaultValue:"0",tokenSymbol:p})})]})]}),e.jsxs($,{children:[e.jsx(K,{title:"View contract",href:q(t,"token",P[t]),children:"View contract ↗"}),e.jsx(Je,{shortLabel:!0,currency:p,fallback:e.jsx(Z,{toCopy:P[t],children:e.jsx("div",{title:"Click to copy token contract address",children:"Copy contract"})})}),e.jsx(Qe,{to:`/swap?outputCurrency=${P[t]}`,children:"Buy COW"})]})]}),e.jsx(mn,{...O,loading:T,openModal:ee,closeModal:W})]})]})}export{An as default};
