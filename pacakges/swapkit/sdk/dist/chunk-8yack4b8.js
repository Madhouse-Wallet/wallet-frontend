import{k as T}from"./chunk-44jnda8d.js";import{n as k}from"./chunk-66qyczwb.js";import{Te as O}from"./chunk-trjbmn7w.js";var G=O(T(),1);var Y=function(F,J,V,q){function w(Q){return Q instanceof V?Q:new V(function(X){X(Q)})}return new(V||(V=Promise))(function(Q,X){function $(B){try{z(q.next(B))}catch(H){X(H)}}function M(B){try{z(q.throw(B))}catch(H){X(H)}}function z(B){B.done?Q(B.value):w(B.value).then($,M)}z((q=q.apply(F,J||[])).next())})},W=250,Z=85,m="CSM",x=0,L=2,N=4,j=0,K=1,y=2,U=36864,I=27014;class R{constructor(F,J=m){this.transport=F,F.decorateAppAPIMethods(this,["getAddress","sign","getAppConfiguration"],J)}getAppConfiguration(){return this.transport.send(Z,x,0,0).then((F)=>{return{test_mode:F[0]!==0,version:""+F[1]+"."+F[2]+"."+F[3],device_locked:F[4]===1,major:F[1]}})}serializePath(F){let J=Buffer.alloc(20);return J.writeUInt32LE((2147483648|F[0])>>>0,0),J.writeUInt32LE((2147483648|F[1])>>>0,4),J.writeUInt32LE((2147483648|F[2])>>>0,8),J.writeUInt32LE(F[3],12),J.writeUInt32LE(F[4],16),J}serializeHRP(F){if(F==null||F.length===0||F.length>83)throw new Error("Invalid HRP");let J=Buffer.alloc(1+F.length);return J.writeUInt8(F.length,0),J.write(F,1),J}getAddress(F,J,V){let q=G.default.fromString(F).toPathArray(),w=this.serializePath(q),Q=Buffer.concat([this.serializeHRP(J),w]);return this.transport.send(Z,N,V?1:0,0,Q,[U]).then((X)=>{let $=Buffer.from(X.slice(33,-2)).toString(),M=Buffer.from(X.slice(0,33)).toString("hex");return{address:$,publicKey:M}})}foreach(F,J){function V(q,w,Q){if(q>=w.length)return Q;else return J(w[q],q).then(function(X){return Q.push(X),V(q+1,w,Q)})}return Promise.resolve().then(()=>V(0,F,[]))}sign(F,J){return Y(this,void 0,void 0,function*(){let V=G.default.fromString(F).toPathArray(),q=this.serializePath(V),w=[];w.push(q);let Q=Buffer.from(J);for(let $=0;$<Q.length;$+=W){let M=$+W;if($>Q.length)M=Q.length;w.push(Q.slice($,M))}let X={};return this.foreach(w,($,M)=>this.transport.send(Z,L,M===0?j:M+1===w.length?y:K,0,$,[U,I]).then((z)=>X=z)).then(()=>{let $=X.slice(-2),M=$[0]*256+$[1],z=null;if(X.length>2)z=X.slice(0,X.length-2);if(M===27014)throw new k;return{signature:z,return_code:M}})})}}export{R as default};

//# debugId=35CE06B576C99D5364756E2164756E21
