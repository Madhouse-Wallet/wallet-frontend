import{k as WV}from"./chunk-44jnda8d.js";import{v as fQ}from"./chunk-kgqa29h3.js";import{Tb as oV}from"./chunk-1pwb5qtb.js";import{qc as HX}from"./chunk-tzfbp3ts.js";import{Hc as l0,Ic as qQ,Jc as K5,Kc as E5,Lc as R5,Mc as hX,Nc as XX,Oc as z5,Pc as A$,Qc as hQ,Rc as mq,Sc as CX}from"./chunk-5mw7fer5.js";import{Yc as KV,Zc as gZ}from"./chunk-pfkp8gk3.js";import"./chunk-a17sebxb.js";import"./chunk-yqytx8zs.js";import"./chunk-mfdk3wj1.js";import{Gd as D9}from"./chunk-4fexcgd8.js";import{de as VX,ee as OX}from"./chunk-bxvsg55z.js";import{Te as d0,Ue as GX,Ve as x}from"./chunk-trjbmn7w.js";var YX=x((UX)=>{Object.defineProperty(UX,"__esModule",{value:!0});var cQ=XX(),zO=hQ();function DO(J){let $=cQ("sha256").update(J).digest();try{return cQ("rmd160").update($).digest()}catch(Z){return cQ("ripemd160").update($).digest()}}UX.hash160=DO;function LO(J,$){return zO("sha512",J).update($).digest()}UX.hmacSHA512=LO});var qX=x((AX,bQ)=>{(function(J,$){function Z(W,Q){if(!W)throw new Error(Q||"Assertion failed")}function G(W,Q){W.super_=Q;var Y=function(){};Y.prototype=Q.prototype,W.prototype=new Y,W.prototype.constructor=W}function U(W,Q,Y){if(U.isBN(W))return W;if(this.negative=0,this.words=null,this.length=0,this.red=null,W!==null){if(Q==="le"||Q==="be")Y=Q,Q=10;this._init(W||0,Q||10,Y||"be")}}if(typeof J==="object")J.exports=U;else $.BN=U;U.BN=U,U.wordSize=26;var O;try{if(typeof window!=="undefined"&&typeof window.Buffer!=="undefined")O=window.Buffer;else O=(OX(),GX(VX)).Buffer}catch(W){}U.isBN=function W(Q){if(Q instanceof U)return!0;return Q!==null&&typeof Q==="object"&&Q.constructor.wordSize===U.wordSize&&Array.isArray(Q.words)},U.max=function W(Q,Y){if(Q.cmp(Y)>0)return Q;return Y},U.min=function W(Q,Y){if(Q.cmp(Y)<0)return Q;return Y},U.prototype._init=function W(Q,Y,V){if(typeof Q==="number")return this._initNumber(Q,Y,V);if(typeof Q==="object")return this._initArray(Q,Y,V);if(Y==="hex")Y=16;Z(Y===(Y|0)&&Y>=2&&Y<=36),Q=Q.toString().replace(/\s+/g,"");var A=0;if(Q[0]==="-")A++,this.negative=1;if(A<Q.length){if(Y===16)this._parseHex(Q,A,V);else if(this._parseBase(Q,Y,A),V==="le")this._initArray(this.toArray(),Y,V)}},U.prototype._initNumber=function W(Q,Y,V){if(Q<0)this.negative=1,Q=-Q;if(Q<67108864)this.words=[Q&67108863],this.length=1;else if(Q<4503599627370496)this.words=[Q&67108863,Q/67108864&67108863],this.length=2;else Z(Q<9007199254740992),this.words=[Q&67108863,Q/67108864&67108863,1],this.length=3;if(V!=="le")return;this._initArray(this.toArray(),Y,V)},U.prototype._initArray=function W(Q,Y,V){if(Z(typeof Q.length==="number"),Q.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(Q.length/3),this.words=new Array(this.length);for(var A=0;A<this.length;A++)this.words[A]=0;var L,H,M=0;if(V==="be"){for(A=Q.length-1,L=0;A>=0;A-=3)if(H=Q[A]|Q[A-1]<<8|Q[A-2]<<16,this.words[L]|=H<<M&67108863,this.words[L+1]=H>>>26-M&67108863,M+=24,M>=26)M-=26,L++}else if(V==="le"){for(A=0,L=0;A<Q.length;A+=3)if(H=Q[A]|Q[A+1]<<8|Q[A+2]<<16,this.words[L]|=H<<M&67108863,this.words[L+1]=H>>>26-M&67108863,M+=24,M>=26)M-=26,L++}return this.strip()};function D(W,Q){var Y=W.charCodeAt(Q);if(Y>=65&&Y<=70)return Y-55;else if(Y>=97&&Y<=102)return Y-87;else return Y-48&15}function F(W,Q,Y){var V=D(W,Y);if(Y-1>=Q)V|=D(W,Y-1)<<4;return V}U.prototype._parseHex=function W(Q,Y,V){this.length=Math.ceil((Q.length-Y)/6),this.words=new Array(this.length);for(var A=0;A<this.length;A++)this.words[A]=0;var L=0,H=0,M;if(V==="be")for(A=Q.length-1;A>=Y;A-=2)if(M=F(Q,Y,A)<<L,this.words[H]|=M&67108863,L>=18)L-=18,H+=1,this.words[H]|=M>>>26;else L+=8;else{var q=Q.length-Y;for(A=q%2===0?Y+1:Y;A<Q.length;A+=2)if(M=F(Q,Y,A)<<L,this.words[H]|=M&67108863,L>=18)L-=18,H+=1,this.words[H]|=M>>>26;else L+=8}this.strip()};function K(W,Q,Y,V){var A=0,L=Math.min(W.length,Y);for(var H=Q;H<L;H++){var M=W.charCodeAt(H)-48;if(A*=V,M>=49)A+=M-49+10;else if(M>=17)A+=M-17+10;else A+=M}return A}U.prototype._parseBase=function W(Q,Y,V){this.words=[0],this.length=1;for(var A=0,L=1;L<=67108863;L*=Y)A++;A--,L=L/Y|0;var H=Q.length-V,M=H%A,q=Math.min(H,H-M)+V,X=0;for(var z=V;z<q;z+=A)if(X=K(Q,z,z+A,Y),this.imuln(L),this.words[0]+X<67108864)this.words[0]+=X;else this._iaddn(X);if(M!==0){var _=1;X=K(Q,z,Q.length,Y);for(z=0;z<M;z++)_*=Y;if(this.imuln(_),this.words[0]+X<67108864)this.words[0]+=X;else this._iaddn(X)}this.strip()},U.prototype.copy=function W(Q){Q.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)Q.words[Y]=this.words[Y];Q.length=this.length,Q.negative=this.negative,Q.red=this.red},U.prototype.clone=function W(){var Q=new U(null);return this.copy(Q),Q},U.prototype._expand=function W(Q){while(this.length<Q)this.words[this.length++]=0;return this},U.prototype.strip=function W(){while(this.length>1&&this.words[this.length-1]===0)this.length--;return this._normSign()},U.prototype._normSign=function W(){if(this.length===1&&this.words[0]===0)this.negative=0;return this},U.prototype.inspect=function W(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var E=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],R=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],C=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64000000,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,24300000,28629151,33554432,39135393,45435424,52521875,60466176];if(U.prototype.toString=function W(Q,Y){Q=Q||10,Y=Y|0||1;var V;if(Q===16||Q==="hex"){V="";var A=0,L=0;for(var H=0;H<this.length;H++){var M=this.words[H],q=((M<<A|L)&16777215).toString(16);if(L=M>>>24-A&16777215,A+=2,A>=26)A-=26,H--;if(L!==0||H!==this.length-1)V=E[6-q.length]+q+V;else V=q+V}if(L!==0)V=L.toString(16)+V;while(V.length%Y!==0)V="0"+V;if(this.negative!==0)V="-"+V;return V}if(Q===(Q|0)&&Q>=2&&Q<=36){var X=R[Q],z=C[Q];V="";var _=this.clone();_.negative=0;while(!_.isZero()){var N=_.modn(z).toString(Q);if(_=_.idivn(z),!_.isZero())V=E[X-N.length]+N+V;else V=N+V}if(this.isZero())V="0"+V;while(V.length%Y!==0)V="0"+V;if(this.negative!==0)V="-"+V;return V}Z(!1,"Base should be between 2 and 36")},U.prototype.toNumber=function W(){var Q=this.words[0];if(this.length===2)Q+=this.words[1]*67108864;else if(this.length===3&&this.words[2]===1)Q+=4503599627370496+this.words[1]*67108864;else if(this.length>2)Z(!1,"Number can only safely store up to 53 bits");return this.negative!==0?-Q:Q},U.prototype.toJSON=function W(){return this.toString(16)},U.prototype.toBuffer=function W(Q,Y){return Z(typeof O!=="undefined"),this.toArrayLike(O,Q,Y)},U.prototype.toArray=function W(Q,Y){return this.toArrayLike(Array,Q,Y)},U.prototype.toArrayLike=function W(Q,Y,V){var A=this.byteLength(),L=V||Math.max(1,A);Z(A<=L,"byte array longer than desired length"),Z(L>0,"Requested array length <= 0"),this.strip();var H=Y==="le",M=new Q(L),q,X,z=this.clone();if(!H){for(X=0;X<L-A;X++)M[X]=0;for(X=0;!z.isZero();X++)q=z.andln(255),z.iushrn(8),M[L-X-1]=q}else{for(X=0;!z.isZero();X++)q=z.andln(255),z.iushrn(8),M[X]=q;for(;X<L;X++)M[X]=0}return M},Math.clz32)U.prototype._countBits=function W(Q){return 32-Math.clz32(Q)};else U.prototype._countBits=function W(Q){var Y=Q,V=0;if(Y>=4096)V+=13,Y>>>=13;if(Y>=64)V+=7,Y>>>=7;if(Y>=8)V+=4,Y>>>=4;if(Y>=2)V+=2,Y>>>=2;return V+Y};U.prototype._zeroBits=function W(Q){if(Q===0)return 26;var Y=Q,V=0;if((Y&8191)===0)V+=13,Y>>>=13;if((Y&127)===0)V+=7,Y>>>=7;if((Y&15)===0)V+=4,Y>>>=4;if((Y&3)===0)V+=2,Y>>>=2;if((Y&1)===0)V++;return V},U.prototype.bitLength=function W(){var Q=this.words[this.length-1],Y=this._countBits(Q);return(this.length-1)*26+Y};function v(W){var Q=new Array(W.bitLength());for(var Y=0;Y<Q.length;Y++){var V=Y/26|0,A=Y%26;Q[Y]=(W.words[V]&1<<A)>>>A}return Q}U.prototype.zeroBits=function W(){if(this.isZero())return 0;var Q=0;for(var Y=0;Y<this.length;Y++){var V=this._zeroBits(this.words[Y]);if(Q+=V,V!==26)break}return Q},U.prototype.byteLength=function W(){return Math.ceil(this.bitLength()/8)},U.prototype.toTwos=function W(Q){if(this.negative!==0)return this.abs().inotn(Q).iaddn(1);return this.clone()},U.prototype.fromTwos=function W(Q){if(this.testn(Q-1))return this.notn(Q).iaddn(1).ineg();return this.clone()},U.prototype.isNeg=function W(){return this.negative!==0},U.prototype.neg=function W(){return this.clone().ineg()},U.prototype.ineg=function W(){if(!this.isZero())this.negative^=1;return this},U.prototype.iuor=function W(Q){while(this.length<Q.length)this.words[this.length++]=0;for(var Y=0;Y<Q.length;Y++)this.words[Y]=this.words[Y]|Q.words[Y];return this.strip()},U.prototype.ior=function W(Q){return Z((this.negative|Q.negative)===0),this.iuor(Q)},U.prototype.or=function W(Q){if(this.length>Q.length)return this.clone().ior(Q);return Q.clone().ior(this)},U.prototype.uor=function W(Q){if(this.length>Q.length)return this.clone().iuor(Q);return Q.clone().iuor(this)},U.prototype.iuand=function W(Q){var Y;if(this.length>Q.length)Y=Q;else Y=this;for(var V=0;V<Y.length;V++)this.words[V]=this.words[V]&Q.words[V];return this.length=Y.length,this.strip()},U.prototype.iand=function W(Q){return Z((this.negative|Q.negative)===0),this.iuand(Q)},U.prototype.and=function W(Q){if(this.length>Q.length)return this.clone().iand(Q);return Q.clone().iand(this)},U.prototype.uand=function W(Q){if(this.length>Q.length)return this.clone().iuand(Q);return Q.clone().iuand(this)},U.prototype.iuxor=function W(Q){var Y,V;if(this.length>Q.length)Y=this,V=Q;else Y=Q,V=this;for(var A=0;A<V.length;A++)this.words[A]=Y.words[A]^V.words[A];if(this!==Y)for(;A<Y.length;A++)this.words[A]=Y.words[A];return this.length=Y.length,this.strip()},U.prototype.ixor=function W(Q){return Z((this.negative|Q.negative)===0),this.iuxor(Q)},U.prototype.xor=function W(Q){if(this.length>Q.length)return this.clone().ixor(Q);return Q.clone().ixor(this)},U.prototype.uxor=function W(Q){if(this.length>Q.length)return this.clone().iuxor(Q);return Q.clone().iuxor(this)},U.prototype.inotn=function W(Q){Z(typeof Q==="number"&&Q>=0);var Y=Math.ceil(Q/26)|0,V=Q%26;if(this._expand(Y),V>0)Y--;for(var A=0;A<Y;A++)this.words[A]=~this.words[A]&67108863;if(V>0)this.words[A]=~this.words[A]&67108863>>26-V;return this.strip()},U.prototype.notn=function W(Q){return this.clone().inotn(Q)},U.prototype.setn=function W(Q,Y){Z(typeof Q==="number"&&Q>=0);var V=Q/26|0,A=Q%26;if(this._expand(V+1),Y)this.words[V]=this.words[V]|1<<A;else this.words[V]=this.words[V]&~(1<<A);return this.strip()},U.prototype.iadd=function W(Q){var Y;if(this.negative!==0&&Q.negative===0)return this.negative=0,Y=this.isub(Q),this.negative^=1,this._normSign();else if(this.negative===0&&Q.negative!==0)return Q.negative=0,Y=this.isub(Q),Q.negative=1,Y._normSign();var V,A;if(this.length>Q.length)V=this,A=Q;else V=Q,A=this;var L=0;for(var H=0;H<A.length;H++)Y=(V.words[H]|0)+(A.words[H]|0)+L,this.words[H]=Y&67108863,L=Y>>>26;for(;L!==0&&H<V.length;H++)Y=(V.words[H]|0)+L,this.words[H]=Y&67108863,L=Y>>>26;if(this.length=V.length,L!==0)this.words[this.length]=L,this.length++;else if(V!==this)for(;H<V.length;H++)this.words[H]=V.words[H];return this},U.prototype.add=function W(Q){var Y;if(Q.negative!==0&&this.negative===0)return Q.negative=0,Y=this.sub(Q),Q.negative^=1,Y;else if(Q.negative===0&&this.negative!==0)return this.negative=0,Y=Q.sub(this),this.negative=1,Y;if(this.length>Q.length)return this.clone().iadd(Q);return Q.clone().iadd(this)},U.prototype.isub=function W(Q){if(Q.negative!==0){Q.negative=0;var Y=this.iadd(Q);return Q.negative=1,Y._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(Q),this.negative=1,this._normSign();var V=this.cmp(Q);if(V===0)return this.negative=0,this.length=1,this.words[0]=0,this;var A,L;if(V>0)A=this,L=Q;else A=Q,L=this;var H=0;for(var M=0;M<L.length;M++)Y=(A.words[M]|0)-(L.words[M]|0)+H,H=Y>>26,this.words[M]=Y&67108863;for(;H!==0&&M<A.length;M++)Y=(A.words[M]|0)+H,H=Y>>26,this.words[M]=Y&67108863;if(H===0&&M<A.length&&A!==this)for(;M<A.length;M++)this.words[M]=A.words[M];if(this.length=Math.max(this.length,M),A!==this)this.negative=1;return this.strip()},U.prototype.sub=function W(Q){return this.clone().isub(Q)};function c(W,Q,Y){Y.negative=Q.negative^W.negative;var V=W.length+Q.length|0;Y.length=V,V=V-1|0;var A=W.words[0]|0,L=Q.words[0]|0,H=A*L,M=H&67108863,q=H/67108864|0;Y.words[0]=M;for(var X=1;X<V;X++){var z=q>>>26,_=q&67108863,N=Math.min(X,Q.length-1);for(var j=Math.max(0,X-W.length+1);j<=N;j++){var P=X-j|0;A=W.words[P]|0,L=Q.words[j]|0,H=A*L+_,z+=H/67108864|0,_=H&67108863}Y.words[X]=_|0,q=z|0}if(q!==0)Y.words[X]=q|0;else Y.length--;return Y.strip()}var N0=function W(Q,Y,V){var A=Q.words,L=Y.words,H=V.words,M=0,q,X,z,_=A[0]|0,N=_&8191,j=_>>>13,P=A[1]|0,B=P&8191,I=P>>>13,y0=A[2]|0,g=y0&8191,y=y0>>>13,pJ=A[3]|0,d=pJ&8191,l=pJ>>>13,uJ=A[4]|0,m=uJ&8191,o=uJ>>>13,rJ=A[5]|0,p=rJ&8191,u=rJ>>>13,nJ=A[6]|0,r=nJ&8191,n=nJ>>>13,sJ=A[7]|0,s=sJ&8191,a=sJ>>>13,aJ=A[8]|0,i=aJ&8191,t=aJ>>>13,iJ=A[9]|0,e=iJ&8191,J0=iJ>>>13,tJ=L[0]|0,$0=tJ&8191,Q0=tJ>>>13,eJ=L[1]|0,Z0=eJ&8191,X0=eJ>>>13,J$=L[2]|0,U0=J$&8191,Y0=J$>>>13,$$=L[3]|0,G0=$$&8191,V0=$$>>>13,Q$=L[4]|0,O0=Q$&8191,A0=Q$>>>13,Z$=L[5]|0,q0=Z$&8191,z0=Z$>>>13,X$=L[6]|0,D0=X$&8191,L0=X$>>>13,U$=L[7]|0,W0=U$&8191,H0=U$>>>13,Y$=L[8]|0,F0=Y$&8191,M0=Y$>>>13,G$=L[9]|0,K0=G$&8191,E0=G$>>>13;V.negative=Q.negative^Y.negative,V.length=19,q=Math.imul(N,$0),X=Math.imul(N,Q0),X=X+Math.imul(j,$0)|0,z=Math.imul(j,Q0);var l1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(l1>>>26)|0,l1&=67108863,q=Math.imul(B,$0),X=Math.imul(B,Q0),X=X+Math.imul(I,$0)|0,z=Math.imul(I,Q0),q=q+Math.imul(N,Z0)|0,X=X+Math.imul(N,X0)|0,X=X+Math.imul(j,Z0)|0,z=z+Math.imul(j,X0)|0;var m1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(m1>>>26)|0,m1&=67108863,q=Math.imul(g,$0),X=Math.imul(g,Q0),X=X+Math.imul(y,$0)|0,z=Math.imul(y,Q0),q=q+Math.imul(B,Z0)|0,X=X+Math.imul(B,X0)|0,X=X+Math.imul(I,Z0)|0,z=z+Math.imul(I,X0)|0,q=q+Math.imul(N,U0)|0,X=X+Math.imul(N,Y0)|0,X=X+Math.imul(j,U0)|0,z=z+Math.imul(j,Y0)|0;var o1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(o1>>>26)|0,o1&=67108863,q=Math.imul(d,$0),X=Math.imul(d,Q0),X=X+Math.imul(l,$0)|0,z=Math.imul(l,Q0),q=q+Math.imul(g,Z0)|0,X=X+Math.imul(g,X0)|0,X=X+Math.imul(y,Z0)|0,z=z+Math.imul(y,X0)|0,q=q+Math.imul(B,U0)|0,X=X+Math.imul(B,Y0)|0,X=X+Math.imul(I,U0)|0,z=z+Math.imul(I,Y0)|0,q=q+Math.imul(N,G0)|0,X=X+Math.imul(N,V0)|0,X=X+Math.imul(j,G0)|0,z=z+Math.imul(j,V0)|0;var p1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(p1>>>26)|0,p1&=67108863,q=Math.imul(m,$0),X=Math.imul(m,Q0),X=X+Math.imul(o,$0)|0,z=Math.imul(o,Q0),q=q+Math.imul(d,Z0)|0,X=X+Math.imul(d,X0)|0,X=X+Math.imul(l,Z0)|0,z=z+Math.imul(l,X0)|0,q=q+Math.imul(g,U0)|0,X=X+Math.imul(g,Y0)|0,X=X+Math.imul(y,U0)|0,z=z+Math.imul(y,Y0)|0,q=q+Math.imul(B,G0)|0,X=X+Math.imul(B,V0)|0,X=X+Math.imul(I,G0)|0,z=z+Math.imul(I,V0)|0,q=q+Math.imul(N,O0)|0,X=X+Math.imul(N,A0)|0,X=X+Math.imul(j,O0)|0,z=z+Math.imul(j,A0)|0;var u1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(u1>>>26)|0,u1&=67108863,q=Math.imul(p,$0),X=Math.imul(p,Q0),X=X+Math.imul(u,$0)|0,z=Math.imul(u,Q0),q=q+Math.imul(m,Z0)|0,X=X+Math.imul(m,X0)|0,X=X+Math.imul(o,Z0)|0,z=z+Math.imul(o,X0)|0,q=q+Math.imul(d,U0)|0,X=X+Math.imul(d,Y0)|0,X=X+Math.imul(l,U0)|0,z=z+Math.imul(l,Y0)|0,q=q+Math.imul(g,G0)|0,X=X+Math.imul(g,V0)|0,X=X+Math.imul(y,G0)|0,z=z+Math.imul(y,V0)|0,q=q+Math.imul(B,O0)|0,X=X+Math.imul(B,A0)|0,X=X+Math.imul(I,O0)|0,z=z+Math.imul(I,A0)|0,q=q+Math.imul(N,q0)|0,X=X+Math.imul(N,z0)|0,X=X+Math.imul(j,q0)|0,z=z+Math.imul(j,z0)|0;var r1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(r1>>>26)|0,r1&=67108863,q=Math.imul(r,$0),X=Math.imul(r,Q0),X=X+Math.imul(n,$0)|0,z=Math.imul(n,Q0),q=q+Math.imul(p,Z0)|0,X=X+Math.imul(p,X0)|0,X=X+Math.imul(u,Z0)|0,z=z+Math.imul(u,X0)|0,q=q+Math.imul(m,U0)|0,X=X+Math.imul(m,Y0)|0,X=X+Math.imul(o,U0)|0,z=z+Math.imul(o,Y0)|0,q=q+Math.imul(d,G0)|0,X=X+Math.imul(d,V0)|0,X=X+Math.imul(l,G0)|0,z=z+Math.imul(l,V0)|0,q=q+Math.imul(g,O0)|0,X=X+Math.imul(g,A0)|0,X=X+Math.imul(y,O0)|0,z=z+Math.imul(y,A0)|0,q=q+Math.imul(B,q0)|0,X=X+Math.imul(B,z0)|0,X=X+Math.imul(I,q0)|0,z=z+Math.imul(I,z0)|0,q=q+Math.imul(N,D0)|0,X=X+Math.imul(N,L0)|0,X=X+Math.imul(j,D0)|0,z=z+Math.imul(j,L0)|0;var n1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(n1>>>26)|0,n1&=67108863,q=Math.imul(s,$0),X=Math.imul(s,Q0),X=X+Math.imul(a,$0)|0,z=Math.imul(a,Q0),q=q+Math.imul(r,Z0)|0,X=X+Math.imul(r,X0)|0,X=X+Math.imul(n,Z0)|0,z=z+Math.imul(n,X0)|0,q=q+Math.imul(p,U0)|0,X=X+Math.imul(p,Y0)|0,X=X+Math.imul(u,U0)|0,z=z+Math.imul(u,Y0)|0,q=q+Math.imul(m,G0)|0,X=X+Math.imul(m,V0)|0,X=X+Math.imul(o,G0)|0,z=z+Math.imul(o,V0)|0,q=q+Math.imul(d,O0)|0,X=X+Math.imul(d,A0)|0,X=X+Math.imul(l,O0)|0,z=z+Math.imul(l,A0)|0,q=q+Math.imul(g,q0)|0,X=X+Math.imul(g,z0)|0,X=X+Math.imul(y,q0)|0,z=z+Math.imul(y,z0)|0,q=q+Math.imul(B,D0)|0,X=X+Math.imul(B,L0)|0,X=X+Math.imul(I,D0)|0,z=z+Math.imul(I,L0)|0,q=q+Math.imul(N,W0)|0,X=X+Math.imul(N,H0)|0,X=X+Math.imul(j,W0)|0,z=z+Math.imul(j,H0)|0;var s1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(s1>>>26)|0,s1&=67108863,q=Math.imul(i,$0),X=Math.imul(i,Q0),X=X+Math.imul(t,$0)|0,z=Math.imul(t,Q0),q=q+Math.imul(s,Z0)|0,X=X+Math.imul(s,X0)|0,X=X+Math.imul(a,Z0)|0,z=z+Math.imul(a,X0)|0,q=q+Math.imul(r,U0)|0,X=X+Math.imul(r,Y0)|0,X=X+Math.imul(n,U0)|0,z=z+Math.imul(n,Y0)|0,q=q+Math.imul(p,G0)|0,X=X+Math.imul(p,V0)|0,X=X+Math.imul(u,G0)|0,z=z+Math.imul(u,V0)|0,q=q+Math.imul(m,O0)|0,X=X+Math.imul(m,A0)|0,X=X+Math.imul(o,O0)|0,z=z+Math.imul(o,A0)|0,q=q+Math.imul(d,q0)|0,X=X+Math.imul(d,z0)|0,X=X+Math.imul(l,q0)|0,z=z+Math.imul(l,z0)|0,q=q+Math.imul(g,D0)|0,X=X+Math.imul(g,L0)|0,X=X+Math.imul(y,D0)|0,z=z+Math.imul(y,L0)|0,q=q+Math.imul(B,W0)|0,X=X+Math.imul(B,H0)|0,X=X+Math.imul(I,W0)|0,z=z+Math.imul(I,H0)|0,q=q+Math.imul(N,F0)|0,X=X+Math.imul(N,M0)|0,X=X+Math.imul(j,F0)|0,z=z+Math.imul(j,M0)|0;var a1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(a1>>>26)|0,a1&=67108863,q=Math.imul(e,$0),X=Math.imul(e,Q0),X=X+Math.imul(J0,$0)|0,z=Math.imul(J0,Q0),q=q+Math.imul(i,Z0)|0,X=X+Math.imul(i,X0)|0,X=X+Math.imul(t,Z0)|0,z=z+Math.imul(t,X0)|0,q=q+Math.imul(s,U0)|0,X=X+Math.imul(s,Y0)|0,X=X+Math.imul(a,U0)|0,z=z+Math.imul(a,Y0)|0,q=q+Math.imul(r,G0)|0,X=X+Math.imul(r,V0)|0,X=X+Math.imul(n,G0)|0,z=z+Math.imul(n,V0)|0,q=q+Math.imul(p,O0)|0,X=X+Math.imul(p,A0)|0,X=X+Math.imul(u,O0)|0,z=z+Math.imul(u,A0)|0,q=q+Math.imul(m,q0)|0,X=X+Math.imul(m,z0)|0,X=X+Math.imul(o,q0)|0,z=z+Math.imul(o,z0)|0,q=q+Math.imul(d,D0)|0,X=X+Math.imul(d,L0)|0,X=X+Math.imul(l,D0)|0,z=z+Math.imul(l,L0)|0,q=q+Math.imul(g,W0)|0,X=X+Math.imul(g,H0)|0,X=X+Math.imul(y,W0)|0,z=z+Math.imul(y,H0)|0,q=q+Math.imul(B,F0)|0,X=X+Math.imul(B,M0)|0,X=X+Math.imul(I,F0)|0,z=z+Math.imul(I,M0)|0,q=q+Math.imul(N,K0)|0,X=X+Math.imul(N,E0)|0,X=X+Math.imul(j,K0)|0,z=z+Math.imul(j,E0)|0;var i1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(i1>>>26)|0,i1&=67108863,q=Math.imul(e,Z0),X=Math.imul(e,X0),X=X+Math.imul(J0,Z0)|0,z=Math.imul(J0,X0),q=q+Math.imul(i,U0)|0,X=X+Math.imul(i,Y0)|0,X=X+Math.imul(t,U0)|0,z=z+Math.imul(t,Y0)|0,q=q+Math.imul(s,G0)|0,X=X+Math.imul(s,V0)|0,X=X+Math.imul(a,G0)|0,z=z+Math.imul(a,V0)|0,q=q+Math.imul(r,O0)|0,X=X+Math.imul(r,A0)|0,X=X+Math.imul(n,O0)|0,z=z+Math.imul(n,A0)|0,q=q+Math.imul(p,q0)|0,X=X+Math.imul(p,z0)|0,X=X+Math.imul(u,q0)|0,z=z+Math.imul(u,z0)|0,q=q+Math.imul(m,D0)|0,X=X+Math.imul(m,L0)|0,X=X+Math.imul(o,D0)|0,z=z+Math.imul(o,L0)|0,q=q+Math.imul(d,W0)|0,X=X+Math.imul(d,H0)|0,X=X+Math.imul(l,W0)|0,z=z+Math.imul(l,H0)|0,q=q+Math.imul(g,F0)|0,X=X+Math.imul(g,M0)|0,X=X+Math.imul(y,F0)|0,z=z+Math.imul(y,M0)|0,q=q+Math.imul(B,K0)|0,X=X+Math.imul(B,E0)|0,X=X+Math.imul(I,K0)|0,z=z+Math.imul(I,E0)|0;var t1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(t1>>>26)|0,t1&=67108863,q=Math.imul(e,U0),X=Math.imul(e,Y0),X=X+Math.imul(J0,U0)|0,z=Math.imul(J0,Y0),q=q+Math.imul(i,G0)|0,X=X+Math.imul(i,V0)|0,X=X+Math.imul(t,G0)|0,z=z+Math.imul(t,V0)|0,q=q+Math.imul(s,O0)|0,X=X+Math.imul(s,A0)|0,X=X+Math.imul(a,O0)|0,z=z+Math.imul(a,A0)|0,q=q+Math.imul(r,q0)|0,X=X+Math.imul(r,z0)|0,X=X+Math.imul(n,q0)|0,z=z+Math.imul(n,z0)|0,q=q+Math.imul(p,D0)|0,X=X+Math.imul(p,L0)|0,X=X+Math.imul(u,D0)|0,z=z+Math.imul(u,L0)|0,q=q+Math.imul(m,W0)|0,X=X+Math.imul(m,H0)|0,X=X+Math.imul(o,W0)|0,z=z+Math.imul(o,H0)|0,q=q+Math.imul(d,F0)|0,X=X+Math.imul(d,M0)|0,X=X+Math.imul(l,F0)|0,z=z+Math.imul(l,M0)|0,q=q+Math.imul(g,K0)|0,X=X+Math.imul(g,E0)|0,X=X+Math.imul(y,K0)|0,z=z+Math.imul(y,E0)|0;var e1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(e1>>>26)|0,e1&=67108863,q=Math.imul(e,G0),X=Math.imul(e,V0),X=X+Math.imul(J0,G0)|0,z=Math.imul(J0,V0),q=q+Math.imul(i,O0)|0,X=X+Math.imul(i,A0)|0,X=X+Math.imul(t,O0)|0,z=z+Math.imul(t,A0)|0,q=q+Math.imul(s,q0)|0,X=X+Math.imul(s,z0)|0,X=X+Math.imul(a,q0)|0,z=z+Math.imul(a,z0)|0,q=q+Math.imul(r,D0)|0,X=X+Math.imul(r,L0)|0,X=X+Math.imul(n,D0)|0,z=z+Math.imul(n,L0)|0,q=q+Math.imul(p,W0)|0,X=X+Math.imul(p,H0)|0,X=X+Math.imul(u,W0)|0,z=z+Math.imul(u,H0)|0,q=q+Math.imul(m,F0)|0,X=X+Math.imul(m,M0)|0,X=X+Math.imul(o,F0)|0,z=z+Math.imul(o,M0)|0,q=q+Math.imul(d,K0)|0,X=X+Math.imul(d,E0)|0,X=X+Math.imul(l,K0)|0,z=z+Math.imul(l,E0)|0;var JJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(JJ>>>26)|0,JJ&=67108863,q=Math.imul(e,O0),X=Math.imul(e,A0),X=X+Math.imul(J0,O0)|0,z=Math.imul(J0,A0),q=q+Math.imul(i,q0)|0,X=X+Math.imul(i,z0)|0,X=X+Math.imul(t,q0)|0,z=z+Math.imul(t,z0)|0,q=q+Math.imul(s,D0)|0,X=X+Math.imul(s,L0)|0,X=X+Math.imul(a,D0)|0,z=z+Math.imul(a,L0)|0,q=q+Math.imul(r,W0)|0,X=X+Math.imul(r,H0)|0,X=X+Math.imul(n,W0)|0,z=z+Math.imul(n,H0)|0,q=q+Math.imul(p,F0)|0,X=X+Math.imul(p,M0)|0,X=X+Math.imul(u,F0)|0,z=z+Math.imul(u,M0)|0,q=q+Math.imul(m,K0)|0,X=X+Math.imul(m,E0)|0,X=X+Math.imul(o,K0)|0,z=z+Math.imul(o,E0)|0;var $J=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+($J>>>26)|0,$J&=67108863,q=Math.imul(e,q0),X=Math.imul(e,z0),X=X+Math.imul(J0,q0)|0,z=Math.imul(J0,z0),q=q+Math.imul(i,D0)|0,X=X+Math.imul(i,L0)|0,X=X+Math.imul(t,D0)|0,z=z+Math.imul(t,L0)|0,q=q+Math.imul(s,W0)|0,X=X+Math.imul(s,H0)|0,X=X+Math.imul(a,W0)|0,z=z+Math.imul(a,H0)|0,q=q+Math.imul(r,F0)|0,X=X+Math.imul(r,M0)|0,X=X+Math.imul(n,F0)|0,z=z+Math.imul(n,M0)|0,q=q+Math.imul(p,K0)|0,X=X+Math.imul(p,E0)|0,X=X+Math.imul(u,K0)|0,z=z+Math.imul(u,E0)|0;var QJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(QJ>>>26)|0,QJ&=67108863,q=Math.imul(e,D0),X=Math.imul(e,L0),X=X+Math.imul(J0,D0)|0,z=Math.imul(J0,L0),q=q+Math.imul(i,W0)|0,X=X+Math.imul(i,H0)|0,X=X+Math.imul(t,W0)|0,z=z+Math.imul(t,H0)|0,q=q+Math.imul(s,F0)|0,X=X+Math.imul(s,M0)|0,X=X+Math.imul(a,F0)|0,z=z+Math.imul(a,M0)|0,q=q+Math.imul(r,K0)|0,X=X+Math.imul(r,E0)|0,X=X+Math.imul(n,K0)|0,z=z+Math.imul(n,E0)|0;var ZJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(ZJ>>>26)|0,ZJ&=67108863,q=Math.imul(e,W0),X=Math.imul(e,H0),X=X+Math.imul(J0,W0)|0,z=Math.imul(J0,H0),q=q+Math.imul(i,F0)|0,X=X+Math.imul(i,M0)|0,X=X+Math.imul(t,F0)|0,z=z+Math.imul(t,M0)|0,q=q+Math.imul(s,K0)|0,X=X+Math.imul(s,E0)|0,X=X+Math.imul(a,K0)|0,z=z+Math.imul(a,E0)|0;var XJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(XJ>>>26)|0,XJ&=67108863,q=Math.imul(e,F0),X=Math.imul(e,M0),X=X+Math.imul(J0,F0)|0,z=Math.imul(J0,M0),q=q+Math.imul(i,K0)|0,X=X+Math.imul(i,E0)|0,X=X+Math.imul(t,K0)|0,z=z+Math.imul(t,E0)|0;var UJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(UJ>>>26)|0,UJ&=67108863,q=Math.imul(e,K0),X=Math.imul(e,E0),X=X+Math.imul(J0,K0)|0,z=Math.imul(J0,E0);var YJ=(M+q|0)+((X&8191)<<13)|0;if(M=(z+(X>>>13)|0)+(YJ>>>26)|0,YJ&=67108863,H[0]=l1,H[1]=m1,H[2]=o1,H[3]=p1,H[4]=u1,H[5]=r1,H[6]=n1,H[7]=s1,H[8]=a1,H[9]=i1,H[10]=t1,H[11]=e1,H[12]=JJ,H[13]=$J,H[14]=QJ,H[15]=ZJ,H[16]=XJ,H[17]=UJ,H[18]=YJ,M!==0)H[19]=M,V.length++;return V};if(!Math.imul)N0=c;function C0(W,Q,Y){Y.negative=Q.negative^W.negative,Y.length=W.length+Q.length;var V=0,A=0;for(var L=0;L<Y.length-1;L++){var H=A;A=0;var M=V&67108863,q=Math.min(L,Q.length-1);for(var X=Math.max(0,L-W.length+1);X<=q;X++){var z=L-X,_=W.words[z]|0,N=Q.words[X]|0,j=_*N,P=j&67108863;H=H+(j/67108864|0)|0,P=P+M|0,M=P&67108863,H=H+(P>>>26)|0,A+=H>>>26,H&=67108863}Y.words[L]=M,V=H,H=A}if(V!==0)Y.words[L]=V;else Y.length--;return Y.strip()}function _0(W,Q,Y){var V=new f;return V.mulp(W,Q,Y)}U.prototype.mulTo=function W(Q,Y){var V,A=this.length+Q.length;if(this.length===10&&Q.length===10)V=N0(this,Q,Y);else if(A<63)V=c(this,Q,Y);else if(A<1024)V=C0(this,Q,Y);else V=_0(this,Q,Y);return V};function f(W,Q){this.x=W,this.y=Q}f.prototype.makeRBT=function W(Q){var Y=new Array(Q),V=U.prototype._countBits(Q)-1;for(var A=0;A<Q;A++)Y[A]=this.revBin(A,V,Q);return Y},f.prototype.revBin=function W(Q,Y,V){if(Q===0||Q===V-1)return Q;var A=0;for(var L=0;L<Y;L++)A|=(Q&1)<<Y-L-1,Q>>=1;return A},f.prototype.permute=function W(Q,Y,V,A,L,H){for(var M=0;M<H;M++)A[M]=Y[Q[M]],L[M]=V[Q[M]]},f.prototype.transform=function W(Q,Y,V,A,L,H){this.permute(H,Q,Y,V,A,L);for(var M=1;M<L;M<<=1){var q=M<<1,X=Math.cos(2*Math.PI/q),z=Math.sin(2*Math.PI/q);for(var _=0;_<L;_+=q){var N=X,j=z;for(var P=0;P<M;P++){var B=V[_+P],I=A[_+P],y0=V[_+P+M],g=A[_+P+M],y=N*y0-j*g;if(g=N*g+j*y0,y0=y,V[_+P]=B+y0,A[_+P]=I+g,V[_+P+M]=B-y0,A[_+P+M]=I-g,P!==q)y=X*N-z*j,j=X*j+z*N,N=y}}}},f.prototype.guessLen13b=function W(Q,Y){var V=Math.max(Y,Q)|1,A=V&1,L=0;for(V=V/2|0;V;V=V>>>1)L++;return 1<<L+1+A},f.prototype.conjugate=function W(Q,Y,V){if(V<=1)return;for(var A=0;A<V/2;A++){var L=Q[A];Q[A]=Q[V-A-1],Q[V-A-1]=L,L=Y[A],Y[A]=-Y[V-A-1],Y[V-A-1]=-L}},f.prototype.normalize13b=function W(Q,Y){var V=0;for(var A=0;A<Y/2;A++){var L=Math.round(Q[2*A+1]/Y)*8192+Math.round(Q[2*A]/Y)+V;if(Q[A]=L&67108863,L<67108864)V=0;else V=L/67108864|0}return Q},f.prototype.convert13b=function W(Q,Y,V,A){var L=0;for(var H=0;H<Y;H++)L=L+(Q[H]|0),V[2*H]=L&8191,L=L>>>13,V[2*H+1]=L&8191,L=L>>>13;for(H=2*Y;H<A;++H)V[H]=0;Z(L===0),Z((L&-8192)===0)},f.prototype.stub=function W(Q){var Y=new Array(Q);for(var V=0;V<Q;V++)Y[V]=0;return Y},f.prototype.mulp=function W(Q,Y,V){var A=2*this.guessLen13b(Q.length,Y.length),L=this.makeRBT(A),H=this.stub(A),M=new Array(A),q=new Array(A),X=new Array(A),z=new Array(A),_=new Array(A),N=new Array(A),j=V.words;j.length=A,this.convert13b(Q.words,Q.length,M,A),this.convert13b(Y.words,Y.length,z,A),this.transform(M,H,q,X,A,L),this.transform(z,H,_,N,A,L);for(var P=0;P<A;P++){var B=q[P]*_[P]-X[P]*N[P];X[P]=q[P]*N[P]+X[P]*_[P],q[P]=B}return this.conjugate(q,X,A),this.transform(q,X,j,H,A,L),this.conjugate(j,H,A),this.normalize13b(j,A),V.negative=Q.negative^Y.negative,V.length=Q.length+Y.length,V.strip()},U.prototype.mul=function W(Q){var Y=new U(null);return Y.words=new Array(this.length+Q.length),this.mulTo(Q,Y)},U.prototype.mulf=function W(Q){var Y=new U(null);return Y.words=new Array(this.length+Q.length),_0(this,Q,Y)},U.prototype.imul=function W(Q){return this.clone().mulTo(Q,this)},U.prototype.imuln=function W(Q){Z(typeof Q==="number"),Z(Q<67108864);var Y=0;for(var V=0;V<this.length;V++){var A=(this.words[V]|0)*Q,L=(A&67108863)+(Y&67108863);Y>>=26,Y+=A/67108864|0,Y+=L>>>26,this.words[V]=L&67108863}if(Y!==0)this.words[V]=Y,this.length++;return this},U.prototype.muln=function W(Q){return this.clone().imuln(Q)},U.prototype.sqr=function W(){return this.mul(this)},U.prototype.isqr=function W(){return this.imul(this.clone())},U.prototype.pow=function W(Q){var Y=v(Q);if(Y.length===0)return new U(1);var V=this;for(var A=0;A<Y.length;A++,V=V.sqr())if(Y[A]!==0)break;if(++A<Y.length)for(var L=V.sqr();A<Y.length;A++,L=L.sqr()){if(Y[A]===0)continue;V=V.mul(L)}return V},U.prototype.iushln=function W(Q){Z(typeof Q==="number"&&Q>=0);var Y=Q%26,V=(Q-Y)/26,A=67108863>>>26-Y<<26-Y,L;if(Y!==0){var H=0;for(L=0;L<this.length;L++){var M=this.words[L]&A,q=(this.words[L]|0)-M<<Y;this.words[L]=q|H,H=M>>>26-Y}if(H)this.words[L]=H,this.length++}if(V!==0){for(L=this.length-1;L>=0;L--)this.words[L+V]=this.words[L];for(L=0;L<V;L++)this.words[L]=0;this.length+=V}return this.strip()},U.prototype.ishln=function W(Q){return Z(this.negative===0),this.iushln(Q)},U.prototype.iushrn=function W(Q,Y,V){Z(typeof Q==="number"&&Q>=0);var A;if(Y)A=(Y-Y%26)/26;else A=0;var L=Q%26,H=Math.min((Q-L)/26,this.length),M=67108863^67108863>>>L<<L,q=V;if(A-=H,A=Math.max(0,A),q){for(var X=0;X<H;X++)q.words[X]=this.words[X];q.length=H}if(H===0);else if(this.length>H){this.length-=H;for(X=0;X<this.length;X++)this.words[X]=this.words[X+H]}else this.words[0]=0,this.length=1;var z=0;for(X=this.length-1;X>=0&&(z!==0||X>=A);X--){var _=this.words[X]|0;this.words[X]=z<<26-L|_>>>L,z=_&M}if(q&&z!==0)q.words[q.length++]=z;if(this.length===0)this.words[0]=0,this.length=1;return this.strip()},U.prototype.ishrn=function W(Q,Y,V){return Z(this.negative===0),this.iushrn(Q,Y,V)},U.prototype.shln=function W(Q){return this.clone().ishln(Q)},U.prototype.ushln=function W(Q){return this.clone().iushln(Q)},U.prototype.shrn=function W(Q){return this.clone().ishrn(Q)},U.prototype.ushrn=function W(Q){return this.clone().iushrn(Q)},U.prototype.testn=function W(Q){Z(typeof Q==="number"&&Q>=0);var Y=Q%26,V=(Q-Y)/26,A=1<<Y;if(this.length<=V)return!1;var L=this.words[V];return!!(L&A)},U.prototype.imaskn=function W(Q){Z(typeof Q==="number"&&Q>=0);var Y=Q%26,V=(Q-Y)/26;if(Z(this.negative===0,"imaskn works only with positive numbers"),this.length<=V)return this;if(Y!==0)V++;if(this.length=Math.min(V,this.length),Y!==0){var A=67108863^67108863>>>Y<<Y;this.words[this.length-1]&=A}return this.strip()},U.prototype.maskn=function W(Q){return this.clone().imaskn(Q)},U.prototype.iaddn=function W(Q){if(Z(typeof Q==="number"),Z(Q<67108864),Q<0)return this.isubn(-Q);if(this.negative!==0){if(this.length===1&&(this.words[0]|0)<Q)return this.words[0]=Q-(this.words[0]|0),this.negative=0,this;return this.negative=0,this.isubn(Q),this.negative=1,this}return this._iaddn(Q)},U.prototype._iaddn=function W(Q){this.words[0]+=Q;for(var Y=0;Y<this.length&&this.words[Y]>=67108864;Y++)if(this.words[Y]-=67108864,Y===this.length-1)this.words[Y+1]=1;else this.words[Y+1]++;return this.length=Math.max(this.length,Y+1),this},U.prototype.isubn=function W(Q){if(Z(typeof Q==="number"),Z(Q<67108864),Q<0)return this.iaddn(-Q);if(this.negative!==0)return this.negative=0,this.iaddn(Q),this.negative=1,this;if(this.words[0]-=Q,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var Y=0;Y<this.length&&this.words[Y]<0;Y++)this.words[Y]+=67108864,this.words[Y+1]-=1;return this.strip()},U.prototype.addn=function W(Q){return this.clone().iaddn(Q)},U.prototype.subn=function W(Q){return this.clone().isubn(Q)},U.prototype.iabs=function W(){return this.negative=0,this},U.prototype.abs=function W(){return this.clone().iabs()},U.prototype._ishlnsubmul=function W(Q,Y,V){var A=Q.length+V,L;this._expand(A);var H,M=0;for(L=0;L<Q.length;L++){H=(this.words[L+V]|0)+M;var q=(Q.words[L]|0)*Y;H-=q&67108863,M=(H>>26)-(q/67108864|0),this.words[L+V]=H&67108863}for(;L<this.length-V;L++)H=(this.words[L+V]|0)+M,M=H>>26,this.words[L+V]=H&67108863;if(M===0)return this.strip();Z(M===-1),M=0;for(L=0;L<this.length;L++)H=-(this.words[L]|0)+M,M=H>>26,this.words[L]=H&67108863;return this.negative=1,this.strip()},U.prototype._wordDiv=function W(Q,Y){var V=this.length-Q.length,A=this.clone(),L=Q,H=L.words[L.length-1]|0,M=this._countBits(H);if(V=26-M,V!==0)L=L.ushln(V),A.iushln(V),H=L.words[L.length-1]|0;var q=A.length-L.length,X;if(Y!=="mod"){X=new U(null),X.length=q+1,X.words=new Array(X.length);for(var z=0;z<X.length;z++)X.words[z]=0}var _=A.clone()._ishlnsubmul(L,1,q);if(_.negative===0){if(A=_,X)X.words[q]=1}for(var N=q-1;N>=0;N--){var j=(A.words[L.length+N]|0)*67108864+(A.words[L.length+N-1]|0);j=Math.min(j/H|0,67108863),A._ishlnsubmul(L,j,N);while(A.negative!==0)if(j--,A.negative=0,A._ishlnsubmul(L,1,N),!A.isZero())A.negative^=1;if(X)X.words[N]=j}if(X)X.strip();if(A.strip(),Y!=="div"&&V!==0)A.iushrn(V);return{div:X||null,mod:A}},U.prototype.divmod=function W(Q,Y,V){if(Z(!Q.isZero()),this.isZero())return{div:new U(0),mod:new U(0)};var A,L,H;if(this.negative!==0&&Q.negative===0){if(H=this.neg().divmod(Q,Y),Y!=="mod")A=H.div.neg();if(Y!=="div"){if(L=H.mod.neg(),V&&L.negative!==0)L.iadd(Q)}return{div:A,mod:L}}if(this.negative===0&&Q.negative!==0){if(H=this.divmod(Q.neg(),Y),Y!=="mod")A=H.div.neg();return{div:A,mod:H.mod}}if((this.negative&Q.negative)!==0){if(H=this.neg().divmod(Q.neg(),Y),Y!=="div"){if(L=H.mod.neg(),V&&L.negative!==0)L.isub(Q)}return{div:H.div,mod:L}}if(Q.length>this.length||this.cmp(Q)<0)return{div:new U(0),mod:this};if(Q.length===1){if(Y==="div")return{div:this.divn(Q.words[0]),mod:null};if(Y==="mod")return{div:null,mod:new U(this.modn(Q.words[0]))};return{div:this.divn(Q.words[0]),mod:new U(this.modn(Q.words[0]))}}return this._wordDiv(Q,Y)},U.prototype.div=function W(Q){return this.divmod(Q,"div",!1).div},U.prototype.mod=function W(Q){return this.divmod(Q,"mod",!1).mod},U.prototype.umod=function W(Q){return this.divmod(Q,"mod",!0).mod},U.prototype.divRound=function W(Q){var Y=this.divmod(Q);if(Y.mod.isZero())return Y.div;var V=Y.div.negative!==0?Y.mod.isub(Q):Y.mod,A=Q.ushrn(1),L=Q.andln(1),H=V.cmp(A);if(H<0||L===1&&H===0)return Y.div;return Y.div.negative!==0?Y.div.isubn(1):Y.div.iaddn(1)},U.prototype.modn=function W(Q){Z(Q<=67108863);var Y=67108864%Q,V=0;for(var A=this.length-1;A>=0;A--)V=(Y*V+(this.words[A]|0))%Q;return V},U.prototype.idivn=function W(Q){Z(Q<=67108863);var Y=0;for(var V=this.length-1;V>=0;V--){var A=(this.words[V]|0)+Y*67108864;this.words[V]=A/Q|0,Y=A%Q}return this.strip()},U.prototype.divn=function W(Q){return this.clone().idivn(Q)},U.prototype.egcd=function W(Q){Z(Q.negative===0),Z(!Q.isZero());var Y=this,V=Q.clone();if(Y.negative!==0)Y=Y.umod(Q);else Y=Y.clone();var A=new U(1),L=new U(0),H=new U(0),M=new U(1),q=0;while(Y.isEven()&&V.isEven())Y.iushrn(1),V.iushrn(1),++q;var X=V.clone(),z=Y.clone();while(!Y.isZero()){for(var _=0,N=1;(Y.words[0]&N)===0&&_<26;++_,N<<=1);if(_>0){Y.iushrn(_);while(_-- >0){if(A.isOdd()||L.isOdd())A.iadd(X),L.isub(z);A.iushrn(1),L.iushrn(1)}}for(var j=0,P=1;(V.words[0]&P)===0&&j<26;++j,P<<=1);if(j>0){V.iushrn(j);while(j-- >0){if(H.isOdd()||M.isOdd())H.iadd(X),M.isub(z);H.iushrn(1),M.iushrn(1)}}if(Y.cmp(V)>=0)Y.isub(V),A.isub(H),L.isub(M);else V.isub(Y),H.isub(A),M.isub(L)}return{a:H,b:M,gcd:V.iushln(q)}},U.prototype._invmp=function W(Q){Z(Q.negative===0),Z(!Q.isZero());var Y=this,V=Q.clone();if(Y.negative!==0)Y=Y.umod(Q);else Y=Y.clone();var A=new U(1),L=new U(0),H=V.clone();while(Y.cmpn(1)>0&&V.cmpn(1)>0){for(var M=0,q=1;(Y.words[0]&q)===0&&M<26;++M,q<<=1);if(M>0){Y.iushrn(M);while(M-- >0){if(A.isOdd())A.iadd(H);A.iushrn(1)}}for(var X=0,z=1;(V.words[0]&z)===0&&X<26;++X,z<<=1);if(X>0){V.iushrn(X);while(X-- >0){if(L.isOdd())L.iadd(H);L.iushrn(1)}}if(Y.cmp(V)>=0)Y.isub(V),A.isub(L);else V.isub(Y),L.isub(A)}var _;if(Y.cmpn(1)===0)_=A;else _=L;if(_.cmpn(0)<0)_.iadd(Q);return _},U.prototype.gcd=function W(Q){if(this.isZero())return Q.abs();if(Q.isZero())return this.abs();var Y=this.clone(),V=Q.clone();Y.negative=0,V.negative=0;for(var A=0;Y.isEven()&&V.isEven();A++)Y.iushrn(1),V.iushrn(1);do{while(Y.isEven())Y.iushrn(1);while(V.isEven())V.iushrn(1);var L=Y.cmp(V);if(L<0){var H=Y;Y=V,V=H}else if(L===0||V.cmpn(1)===0)break;Y.isub(V)}while(!0);return V.iushln(A)},U.prototype.invm=function W(Q){return this.egcd(Q).a.umod(Q)},U.prototype.isEven=function W(){return(this.words[0]&1)===0},U.prototype.isOdd=function W(){return(this.words[0]&1)===1},U.prototype.andln=function W(Q){return this.words[0]&Q},U.prototype.bincn=function W(Q){Z(typeof Q==="number");var Y=Q%26,V=(Q-Y)/26,A=1<<Y;if(this.length<=V)return this._expand(V+1),this.words[V]|=A,this;var L=A;for(var H=V;L!==0&&H<this.length;H++){var M=this.words[H]|0;M+=L,L=M>>>26,M&=67108863,this.words[H]=M}if(L!==0)this.words[H]=L,this.length++;return this},U.prototype.isZero=function W(){return this.length===1&&this.words[0]===0},U.prototype.cmpn=function W(Q){var Y=Q<0;if(this.negative!==0&&!Y)return-1;if(this.negative===0&&Y)return 1;this.strip();var V;if(this.length>1)V=1;else{if(Y)Q=-Q;Z(Q<=67108863,"Number is too big");var A=this.words[0]|0;V=A===Q?0:A<Q?-1:1}if(this.negative!==0)return-V|0;return V},U.prototype.cmp=function W(Q){if(this.negative!==0&&Q.negative===0)return-1;if(this.negative===0&&Q.negative!==0)return 1;var Y=this.ucmp(Q);if(this.negative!==0)return-Y|0;return Y},U.prototype.ucmp=function W(Q){if(this.length>Q.length)return 1;if(this.length<Q.length)return-1;var Y=0;for(var V=this.length-1;V>=0;V--){var A=this.words[V]|0,L=Q.words[V]|0;if(A===L)continue;if(A<L)Y=-1;else if(A>L)Y=1;break}return Y},U.prototype.gtn=function W(Q){return this.cmpn(Q)===1},U.prototype.gt=function W(Q){return this.cmp(Q)===1},U.prototype.gten=function W(Q){return this.cmpn(Q)>=0},U.prototype.gte=function W(Q){return this.cmp(Q)>=0},U.prototype.ltn=function W(Q){return this.cmpn(Q)===-1},U.prototype.lt=function W(Q){return this.cmp(Q)===-1},U.prototype.lten=function W(Q){return this.cmpn(Q)<=0},U.prototype.lte=function W(Q){return this.cmp(Q)<=0},U.prototype.eqn=function W(Q){return this.cmpn(Q)===0},U.prototype.eq=function W(Q){return this.cmp(Q)===0},U.red=function W(Q){return new T(Q)},U.prototype.toRed=function W(Q){return Z(!this.red,"Already a number in reduction context"),Z(this.negative===0,"red works only with positives"),Q.convertTo(this)._forceRed(Q)},U.prototype.fromRed=function W(){return Z(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},U.prototype._forceRed=function W(Q){return this.red=Q,this},U.prototype.forceRed=function W(Q){return Z(!this.red,"Already a number in reduction context"),this._forceRed(Q)},U.prototype.redAdd=function W(Q){return Z(this.red,"redAdd works only with red numbers"),this.red.add(this,Q)},U.prototype.redIAdd=function W(Q){return Z(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,Q)},U.prototype.redSub=function W(Q){return Z(this.red,"redSub works only with red numbers"),this.red.sub(this,Q)},U.prototype.redISub=function W(Q){return Z(this.red,"redISub works only with red numbers"),this.red.isub(this,Q)},U.prototype.redShl=function W(Q){return Z(this.red,"redShl works only with red numbers"),this.red.shl(this,Q)},U.prototype.redMul=function W(Q){return Z(this.red,"redMul works only with red numbers"),this.red._verify2(this,Q),this.red.mul(this,Q)},U.prototype.redIMul=function W(Q){return Z(this.red,"redMul works only with red numbers"),this.red._verify2(this,Q),this.red.imul(this,Q)},U.prototype.redSqr=function W(){return Z(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},U.prototype.redISqr=function W(){return Z(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},U.prototype.redSqrt=function W(){return Z(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},U.prototype.redInvm=function W(){return Z(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},U.prototype.redNeg=function W(){return Z(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},U.prototype.redPow=function W(Q){return Z(this.red&&!Q.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,Q)};var w={k256:null,p224:null,p192:null,p25519:null};function k(W,Q){this.name=W,this.p=new U(Q,16),this.n=this.p.bitLength(),this.k=new U(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}k.prototype._tmp=function W(){var Q=new U(null);return Q.words=new Array(Math.ceil(this.n/13)),Q},k.prototype.ireduce=function W(Q){var Y=Q,V;do this.split(Y,this.tmp),Y=this.imulK(Y),Y=Y.iadd(this.tmp),V=Y.bitLength();while(V>this.n);var A=V<this.n?-1:Y.ucmp(this.p);if(A===0)Y.words[0]=0,Y.length=1;else if(A>0)Y.isub(this.p);else if(Y.strip!==void 0)Y.strip();else Y._strip();return Y},k.prototype.split=function W(Q,Y){Q.iushrn(this.n,0,Y)},k.prototype.imulK=function W(Q){return Q.imul(this.k)};function S(){k.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}G(S,k),S.prototype.split=function W(Q,Y){var V=4194303,A=Math.min(Q.length,9);for(var L=0;L<A;L++)Y.words[L]=Q.words[L];if(Y.length=A,Q.length<=9){Q.words[0]=0,Q.length=1;return}var H=Q.words[9];Y.words[Y.length++]=H&V;for(L=10;L<Q.length;L++){var M=Q.words[L]|0;Q.words[L-10]=(M&V)<<4|H>>>22,H=M}if(H>>>=22,Q.words[L-10]=H,H===0&&Q.length>10)Q.length-=10;else Q.length-=9},S.prototype.imulK=function W(Q){Q.words[Q.length]=0,Q.words[Q.length+1]=0,Q.length+=2;var Y=0;for(var V=0;V<Q.length;V++){var A=Q.words[V]|0;Y+=A*977,Q.words[V]=Y&67108863,Y=A*64+(Y/67108864|0)}if(Q.words[Q.length-1]===0){if(Q.length--,Q.words[Q.length-1]===0)Q.length--}return Q};function P0(){k.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}G(P0,k);function h(){k.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}G(h,k);function S0(){k.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}G(S0,k),S0.prototype.imulK=function W(Q){var Y=0;for(var V=0;V<Q.length;V++){var A=(Q.words[V]|0)*19+Y,L=A&67108863;A>>>=26,Q.words[V]=L,Y=A}if(Y!==0)Q.words[Q.length++]=Y;return Q},U._prime=function W(Q){if(w[Q])return w[Q];var Y;if(Q==="k256")Y=new S;else if(Q==="p224")Y=new P0;else if(Q==="p192")Y=new h;else if(Q==="p25519")Y=new S0;else throw new Error("Unknown prime "+Q);return w[Q]=Y,Y};function T(W){if(typeof W==="string"){var Q=U._prime(W);this.m=Q.p,this.prime=Q}else Z(W.gtn(1),"modulus must be greater than 1"),this.m=W,this.prime=null}T.prototype._verify1=function W(Q){Z(Q.negative===0,"red works only with positives"),Z(Q.red,"red works only with red numbers")},T.prototype._verify2=function W(Q,Y){Z((Q.negative|Y.negative)===0,"red works only with positives"),Z(Q.red&&Q.red===Y.red,"red works only with red numbers")},T.prototype.imod=function W(Q){if(this.prime)return this.prime.ireduce(Q)._forceRed(this);return Q.umod(this.m)._forceRed(this)},T.prototype.neg=function W(Q){if(Q.isZero())return Q.clone();return this.m.sub(Q)._forceRed(this)},T.prototype.add=function W(Q,Y){this._verify2(Q,Y);var V=Q.add(Y);if(V.cmp(this.m)>=0)V.isub(this.m);return V._forceRed(this)},T.prototype.iadd=function W(Q,Y){this._verify2(Q,Y);var V=Q.iadd(Y);if(V.cmp(this.m)>=0)V.isub(this.m);return V},T.prototype.sub=function W(Q,Y){this._verify2(Q,Y);var V=Q.sub(Y);if(V.cmpn(0)<0)V.iadd(this.m);return V._forceRed(this)},T.prototype.isub=function W(Q,Y){this._verify2(Q,Y);var V=Q.isub(Y);if(V.cmpn(0)<0)V.iadd(this.m);return V},T.prototype.shl=function W(Q,Y){return this._verify1(Q),this.imod(Q.ushln(Y))},T.prototype.imul=function W(Q,Y){return this._verify2(Q,Y),this.imod(Q.imul(Y))},T.prototype.mul=function W(Q,Y){return this._verify2(Q,Y),this.imod(Q.mul(Y))},T.prototype.isqr=function W(Q){return this.imul(Q,Q.clone())},T.prototype.sqr=function W(Q){return this.mul(Q,Q)},T.prototype.sqrt=function W(Q){if(Q.isZero())return Q.clone();var Y=this.m.andln(3);if(Z(Y%2===1),Y===3){var V=this.m.add(new U(1)).iushrn(2);return this.pow(Q,V)}var A=this.m.subn(1),L=0;while(!A.isZero()&&A.andln(1)===0)L++,A.iushrn(1);Z(!A.isZero());var H=new U(1).toRed(this),M=H.redNeg(),q=this.m.subn(1).iushrn(1),X=this.m.bitLength();X=new U(2*X*X).toRed(this);while(this.pow(X,q).cmp(M)!==0)X.redIAdd(M);var z=this.pow(X,A),_=this.pow(Q,A.addn(1).iushrn(1)),N=this.pow(Q,A),j=L;while(N.cmp(H)!==0){var P=N;for(var B=0;P.cmp(H)!==0;B++)P=P.redSqr();Z(B<j);var I=this.pow(z,new U(1).iushln(j-B-1));_=_.redMul(I),z=I.redSqr(),N=N.redMul(z),j=B}return _},T.prototype.invm=function W(Q){var Y=Q._invmp(this.m);if(Y.negative!==0)return Y.negative=0,this.imod(Y).redNeg();else return this.imod(Y)},T.prototype.pow=function W(Q,Y){if(Y.isZero())return new U(1).toRed(this);if(Y.cmpn(1)===0)return Q.clone();var V=4,A=new Array(1<<V);A[0]=new U(1).toRed(this),A[1]=Q;for(var L=2;L<A.length;L++)A[L]=this.mul(A[L-1],Q);var H=A[0],M=0,q=0,X=Y.bitLength()%26;if(X===0)X=26;for(L=Y.length-1;L>=0;L--){var z=Y.words[L];for(var _=X-1;_>=0;_--){var N=z>>_&1;if(H!==A[0])H=this.sqr(H);if(N===0&&M===0){q=0;continue}if(M<<=1,M|=N,q++,q!==V&&(L!==0||_!==0))continue;H=this.mul(H,A[M]),q=0,M=0}X=26}return H},T.prototype.convertTo=function W(Q){var Y=Q.umod(this.m);return Y===Q?Y.clone():Y},T.prototype.convertFrom=function W(Q){var Y=Q.clone();return Y.red=null,Y},U.mont=function W(Q){return new T0(Q)};function T0(W){if(T.call(this,W),this.shift=this.m.bitLength(),this.shift%26!==0)this.shift+=26-this.shift%26;this.r=new U(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}G(T0,T),T0.prototype.convertTo=function W(Q){return this.imod(Q.ushln(this.shift))},T0.prototype.convertFrom=function W(Q){var Y=this.imod(Q.mul(this.rinv));return Y.red=null,Y},T0.prototype.imul=function W(Q,Y){if(Q.isZero()||Y.isZero())return Q.words[0]=0,Q.length=1,Q;var V=Q.imul(Y),A=V.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),L=V.isub(A).iushrn(this.shift),H=L;if(L.cmp(this.m)>=0)H=L.isub(this.m);else if(L.cmpn(0)<0)H=L.iadd(this.m);return H._forceRed(this)},T0.prototype.mul=function W(Q,Y){if(Q.isZero()||Y.isZero())return new U(0)._forceRed(this);var V=Q.mul(Y),A=V.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),L=V.isub(A).iushrn(this.shift),H=L;if(L.cmp(this.m)>=0)H=L.isub(this.m);else if(L.cmpn(0)<0)H=L.iadd(this.m);return H._forceRed(this)},T0.prototype.invm=function W(Q){var Y=this.imod(Q._invmp(this.m).mul(this.r2));return Y._forceRed(this)}})(typeof bQ==="undefined"||bQ,AX)});var LX=x((N9,DX)=>{var N1=hQ(),FO=Buffer.alloc(1,1),zX=Buffer.alloc(1,0);function MO(J,$,Z,G,U){let O=Buffer.alloc(32,0),D=Buffer.alloc(32,1);O=N1("sha256",O).update(D).update(zX).update($).update(J).update(U||"").digest(),D=N1("sha256",O).update(D).digest(),O=N1("sha256",O).update(D).update(FO).update($).update(J).update(U||"").digest(),D=N1("sha256",O).update(D).digest(),D=N1("sha256",O).update(D).digest();let F=D;while(!G(F)||!Z(F))O=N1("sha256",O).update(D).update(zX).digest(),D=N1("sha256",O).update(D).digest(),D=N1("sha256",O).update(D).digest(),F=D;return F}DX.exports=MO});var RX=x((_9,EX)=>{var KO=qX(),EO=HX().ec,dQ=new EO("secp256k1"),RO=LX(),k$=Buffer.alloc(32,0),x$=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),WX=Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex"),U1=dQ.curve.n,FX=U1.shrn(1),w$=dQ.curve.g;function V$(J){return J instanceof Uint8Array&&J.length===32}function y$(J){if(!V$(J))return!1;return x$.compare(J)>0}function _1(J){if(!(J instanceof Uint8Array))return!1;if(J.length<33)return!1;let $=J[0],Z=J.subarray(1,33);if(k$.compare(Z)===0)return!1;if(WX.compare(Z)<=0)return!1;if(($===2||$===3)&&J.length===33){try{GJ(J)}catch(U){return!1}return!0}let G=J.subarray(33);if(k$.compare(G)===0)return!1;if(WX.compare(G)<=0)return!1;if($===4&&J.length===65)return!0;return!1}function MX(J){return J[0]!==4}function jO(J){if(!_1(J))return!1;return MX(J)}function P1(J){if(!V$(J))return!1;return k$.compare(J)<0&&x$.compare(J)>0}function CO(J){let $=J.subarray(0,32),Z=J.subarray(32,64);return J instanceof Uint8Array&&J.length===64&&x$.compare($)>0&&x$.compare(Z)>0}function O$(J,$){if(J===void 0&&$!==void 0)return MX($);if(J===void 0)return!0;return J}function i0(J){return new KO(J)}function g$(J){return J.toArrayLike(Buffer,"be",32)}function GJ(J){return dQ.curve.decodePoint(J)}function MJ(J,$){return Buffer.from(J._encode($))}function NO(J,$,Z){if(!_1(J))throw new TypeError("Expected Point");if(!_1($))throw new TypeError("Expected Point");let G=GJ(J),U=GJ($),O=G.add(U);if(O.isInfinity())return null;let D=O$(Z,J);return MJ(O,D)}function _O(J,$,Z){if(!_1(J))throw new TypeError("Expected Point");if(!y$($))throw new TypeError("Expected Tweak");let G=O$(Z,J),U=GJ(J);if(k$.compare($)===0)return MJ(U,G);let O=i0($),D=w$.mul(O),F=U.add(D);if(F.isInfinity())return null;return MJ(F,G)}function PO(J,$){if(!_1(J))throw new TypeError("Expected Point");let Z=GJ(J);if(Z.isInfinity())throw new TypeError("Expected Point");let G=O$($,J);return MJ(Z,G)}function BO(J,$){if(!P1(J))throw new TypeError("Expected Private");let Z=i0(J),G=w$.mul(Z);if(G.isInfinity())return null;let U=O$($);return MJ(G,U)}function vO(J,$,Z){if(!_1(J))throw new TypeError("Expected Point");if(!y$($))throw new TypeError("Expected Tweak");let G=O$(Z,J),U=GJ(J),O=i0($),D=U.mul(O);if(D.isInfinity())return null;return MJ(D,G)}function SO(J,$){if(!P1(J))throw new TypeError("Expected Private");if(!y$($))throw new TypeError("Expected Tweak");let Z=i0(J),G=i0($),U=g$(Z.add(G).umod(U1));if(!P1(U))return null;return U}function TO(J,$){if(!P1(J))throw new TypeError("Expected Private");if(!y$($))throw new TypeError("Expected Tweak");let Z=i0(J),G=i0($),U=g$(Z.sub(G).umod(U1));if(!P1(U))return null;return U}function IO(J,$){return KX(J,$)}function kO(J,$,Z){return KX(J,$,Z)}function KX(J,$,Z){if(!V$(J))throw new TypeError("Expected Hash");if(!P1($))throw new TypeError("Expected Private");if(Z!==void 0&&!V$(Z))throw new TypeError("Expected Extra Data (32 bytes)");let G=i0($),U=i0(J),O,D;if(RO(J,$,function(E){let R=i0(E),C=w$.mul(R);if(C.isInfinity())return!1;if(O=C.x.umod(U1),O.isZero()===0)return!1;if(D=R.invm(U1).mul(U.add(G.mul(O))).umod(U1),D.isZero()===0)return!1;return!0},P1,Z),D.cmp(FX)>0)D=U1.sub(D);let K=Buffer.allocUnsafe(64);return g$(O).copy(K,0),g$(D).copy(K,32),K}function xO(J,$,Z,G){if(!V$(J))throw new TypeError("Expected Hash");if(!_1($))throw new TypeError("Expected Point");if(!CO(Z))throw new TypeError("Expected Signature");let U=GJ($),O=i0(Z.subarray(0,32)),D=i0(Z.subarray(32,64));if(G&&D.cmp(FX)>0)return!1;if(O.gtn(0)<=0)return!1;if(D.gtn(0)<=0)return!1;let F=i0(J),K=D.invm(U1),E=F.mul(K).umod(U1),R=O.mul(K).umod(U1),C=w$.mulAdd(E,U,R);if(C.isInfinity())return!1;return C.x.umod(U1).eq(O)}EX.exports={isPoint:_1,isPointCompressed:jO,isPrivate:P1,pointAdd:NO,pointAddScalar:_O,pointCompress:PO,pointFromScalar:BO,pointMultiply:vO,privateAdd:SO,privateSub:TO,sign:IO,signWithEntropy:kO,verify:xO}});var BX=x((PX)=>{Object.defineProperty(PX,"__esModule",{value:!0});var lQ=YX(),NX=A$(),q1=RX(),p0=l0(),gO=CX(),mQ=p0.BufferN(32),wO=p0.compile({wif:p0.UInt8,bip32:{public:p0.UInt32,private:p0.UInt32}}),c$={messagePrefix:`\x18Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128},jX=2147483648,yO=Math.pow(2,31)-1;function fO(J){return p0.String(J)&&J.match(/^(m\/)?(\d+'?\/)*\d+'?$/)!==null}function cO(J){return p0.UInt32(J)&&J<=yO}class oQ{constructor(J,$,Z,G,U=0,O=0,D=0){this.__D=J,this.__Q=$,this.chainCode=Z,this.network=G,this.__DEPTH=U,this.__INDEX=O,this.__PARENT_FINGERPRINT=D,p0(wO,G),this.lowR=!1}get depth(){return this.__DEPTH}get index(){return this.__INDEX}get parentFingerprint(){return this.__PARENT_FINGERPRINT}get publicKey(){if(this.__Q===void 0)this.__Q=q1.pointFromScalar(this.__D,!0);return this.__Q}get privateKey(){return this.__D}get identifier(){return lQ.hash160(this.publicKey)}get fingerprint(){return this.identifier.slice(0,4)}isNeutered(){return this.__D===void 0}neutered(){return f$(this.publicKey,this.chainCode,this.network,this.depth,this.index,this.parentFingerprint)}toBase58(){let J=this.network,$=!this.isNeutered()?J.bip32.private:J.bip32.public,Z=Buffer.allocUnsafe(78);if(Z.writeUInt32BE($,0),Z.writeUInt8(this.depth,4),Z.writeUInt32BE(this.parentFingerprint,5),Z.writeUInt32BE(this.index,9),this.chainCode.copy(Z,13),!this.isNeutered())Z.writeUInt8(0,45),this.privateKey.copy(Z,46);else this.publicKey.copy(Z,45);return NX.encode(Z)}toWIF(){if(!this.privateKey)throw new TypeError("Missing private key");return gO.encode(this.network.wif,this.privateKey,!0)}derive(J){p0(p0.UInt32,J);let $=J>=jX,Z=Buffer.allocUnsafe(37);if($){if(this.isNeutered())throw new TypeError("Missing private key for hardened child key");Z[0]=0,this.privateKey.copy(Z,1),Z.writeUInt32BE(J,33)}else this.publicKey.copy(Z,0),Z.writeUInt32BE(J,33);let G=lQ.hmacSHA512(this.chainCode,Z),U=G.slice(0,32),O=G.slice(32);if(!q1.isPrivate(U))return this.derive(J+1);let D;if(!this.isNeutered()){let F=q1.privateAdd(this.privateKey,U);if(F==null)return this.derive(J+1);D=pQ(F,O,this.network,this.depth+1,J,this.fingerprint.readUInt32BE(0))}else{let F=q1.pointAddScalar(this.publicKey,U,!0);if(F===null)return this.derive(J+1);D=f$(F,O,this.network,this.depth+1,J,this.fingerprint.readUInt32BE(0))}return D}deriveHardened(J){return p0(cO,J),this.derive(J+jX)}derivePath(J){p0(fO,J);let $=J.split("/");if($[0]==="m"){if(this.parentFingerprint)throw new TypeError("Expected master, got child");$=$.slice(1)}return $.reduce((Z,G)=>{let U;if(G.slice(-1)==="'")return U=parseInt(G.slice(0,-1),10),Z.deriveHardened(U);else return U=parseInt(G,10),Z.derive(U)},this)}sign(J,$){if(!this.privateKey)throw new Error("Missing private key");if($===void 0)$=this.lowR;if($===!1)return q1.sign(J,this.privateKey);else{let Z=q1.sign(J,this.privateKey),G=Buffer.alloc(32,0),U=0;while(Z[0]>127)U++,G.writeUIntLE(U,0,6),Z=q1.signWithEntropy(J,this.privateKey,G);return Z}}verify(J,$){return q1.verify(J,this.publicKey,$)}}function hO(J,$){let Z=NX.decode(J);if(Z.length!==78)throw new TypeError("Invalid buffer length");$=$||c$;let G=Z.readUInt32BE(0);if(G!==$.bip32.private&&G!==$.bip32.public)throw new TypeError("Invalid network version");let U=Z[4],O=Z.readUInt32BE(5);if(U===0){if(O!==0)throw new TypeError("Invalid parent fingerprint")}let D=Z.readUInt32BE(9);if(U===0&&D!==0)throw new TypeError("Invalid index");let F=Z.slice(13,45),K;if(G===$.bip32.private){if(Z.readUInt8(45)!==0)throw new TypeError("Invalid private key");let E=Z.slice(46,78);K=pQ(E,F,$,U,D,O)}else{let E=Z.slice(45,78);K=f$(E,F,$,U,D,O)}return K}PX.fromBase58=hO;function _X(J,$,Z){return pQ(J,$,Z)}PX.fromPrivateKey=_X;function pQ(J,$,Z,G,U,O){if(p0({privateKey:mQ,chainCode:mQ},{privateKey:J,chainCode:$}),Z=Z||c$,!q1.isPrivate(J))throw new TypeError("Private key not in range [1, n)");return new oQ(J,void 0,$,Z,G,U,O)}function bO(J,$,Z){return f$(J,$,Z)}PX.fromPublicKey=bO;function f$(J,$,Z,G,U,O){if(p0({publicKey:p0.BufferN(33),chainCode:mQ},{publicKey:J,chainCode:$}),Z=Z||c$,!q1.isPoint(J))throw new TypeError("Point is not on the curve");return new oQ(void 0,J,$,Z,G,U,O)}function dO(J,$){if(p0(p0.Buffer,J),J.length<16)throw new TypeError("Seed should be at least 128 bits");if(J.length>64)throw new TypeError("Seed should be at most 512 bits");$=$||c$;let Z=lQ.hmacSHA512(Buffer.from("Bitcoin seed","utf8"),J),G=Z.slice(0,32),U=Z.slice(32);return _X(G,U,$)}PX.fromSeed=dO});var SX=x((vX)=>{Object.defineProperty(vX,"__esModule",{value:!0});var h$=BX();vX.fromSeed=h$.fromSeed;vX.fromBase58=h$.fromBase58;vX.fromPublicKey=h$.fromPublicKey;vX.fromPrivateKey=h$.fromPrivateKey});var t0=x((TX)=>{Object.defineProperty(TX,"__esModule",{value:!0});TX.bitcoin={messagePrefix:`\x18Bitcoin Signed Message:
`,bech32:"bc",bip32:{public:76067358,private:76066276},pubKeyHash:0,scriptHash:5,wif:128};TX.regtest={messagePrefix:`\x18Bitcoin Signed Message:
`,bech32:"bcrt",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239};TX.testnet={messagePrefix:`\x18Bitcoin Signed Message:
`,bech32:"tb",bip32:{public:70617039,private:70615956},pubKeyHash:111,scriptHash:196,wif:239}});var kX=x((IX)=>{Object.defineProperty(IX,"__esModule",{value:!0});function eO(J,$,Z){$=$||4,Z=Z===void 0?!0:Z;let G=J.length;if(G===0)return 0;if(G>$)throw new TypeError("Script number overflow");if(Z){if((J[G-1]&127)===0){if(G<=1||(J[G-2]&128)===0)throw new Error("Non-minimally encoded script number")}}if(G===5){let O=J.readUInt32LE(0),D=J.readUInt8(4);if(D&128)return-((D&-129)*4294967296+O);return D*4294967296+O}let U=0;for(let O=0;O<G;++O)U|=J[O]<<8*O;if(J[G-1]&128)return-(U&~(128<<8*(G-1)));return U}IX.decode=eO;function JA(J){return J>2147483647?5:J>8388607?4:J>32767?3:J>127?2:J>0?1:0}function $A(J){let $=Math.abs(J),Z=JA($),G=Buffer.allocUnsafe(Z),U=J<0;for(let O=0;O<Z;++O)G.writeUInt8($&255,O),$>>=8;if(G[Z-1]&128)G.writeUInt8(U?128:0,Z-1);else if(U)G[Z-1]|=128;return G}IX.encode=$A});var Y1=x((gX)=>{Object.defineProperty(gX,"__esModule",{value:!0});var B0=l0(),XA=Math.pow(2,31)-1;function UA(J){return B0.UInt32(J)&&J<=XA}gX.UInt31=UA;function xX(J){return B0.String(J)&&!!J.match(/^(m\/)?(\d+'?\/)*\d+'?$/)}gX.BIP32Path=xX;xX.toJSON=()=>{return"BIP32 derivation path"};function YA(J){return(B0.Buffer(J.publicKey)||typeof J.getPublicKey==="function")&&typeof J.sign==="function"}gX.Signer=YA;var GA=2100000000000000;function VA(J){return B0.UInt53(J)&&J<=GA}gX.Satoshi=VA;gX.ECPoint=B0.quacksLike("Point");gX.Network=B0.compile({messagePrefix:B0.oneOf(B0.Buffer,B0.String),bip32:{public:B0.UInt32,private:B0.UInt32},pubKeyHash:B0.UInt8,scriptHash:B0.UInt8,wif:B0.UInt8});gX.Buffer256bit=B0.BufferN(32);gX.Hash160bit=B0.BufferN(20);gX.Hash256bit=B0.BufferN(32);gX.Number=B0.Number;gX.Array=B0.Array;gX.Boolean=B0.Boolean;gX.String=B0.String;gX.Buffer=B0.Buffer;gX.Hex=B0.Hex;gX.maybe=B0.maybe;gX.tuple=B0.tuple;gX.UInt8=B0.UInt8;gX.UInt32=B0.UInt32;gX.Function=B0.Function;gX.BufferN=B0.BufferN;gX.Null=B0.Null;gX.oneOf=B0.oneOf});var lX=x((dX)=>{Object.defineProperty(dX,"__esModule",{value:!0});var wX=Y1(),bX=hX(),kA=l0(),yX=Buffer.alloc(1,0);function fX(J){let $=0;while(J[$]===0)++$;if($===J.length)return yX;if(J=J.slice($),J[0]&128)return Buffer.concat([yX,J],1+J.length);return J}function cX(J){if(J[0]===0)J=J.slice(1);let $=Buffer.alloc(32,0),Z=Math.max(0,32-J.length);return J.copy($,Z),$}function xA(J){let $=J.readUInt8(J.length-1),Z=$&-129;if(Z<=0||Z>=4)throw new Error("Invalid hashType "+$);let G=bX.decode(J.slice(0,-1)),U=cX(G.r),O=cX(G.s);return{signature:Buffer.concat([U,O],64),hashType:$}}dX.decode=xA;function gA(J,$){kA({signature:wX.BufferN(64),hashType:wX.UInt8},{signature:J,hashType:$});let Z=$&-129;if(Z<=0||Z>=4)throw new Error("Invalid hashType "+$);let G=Buffer.allocUnsafe(1);G.writeUInt8($,0);let U=fX(J.slice(0,32)),O=fX(J.slice(32,64));return Buffer.concat([bX.encode(U,O),G])}dX.encode=gA});var oX=x((mX,uQ)=>{(function(J,$){function Z(W,Q){if(!W)throw new Error(Q||"Assertion failed")}function G(W,Q){W.super_=Q;var Y=function(){};Y.prototype=Q.prototype,W.prototype=new Y,W.prototype.constructor=W}function U(W,Q,Y){if(U.isBN(W))return W;if(this.negative=0,this.words=null,this.length=0,this.red=null,W!==null){if(Q==="le"||Q==="be")Y=Q,Q=10;this._init(W||0,Q||10,Y||"be")}}if(typeof J==="object")J.exports=U;else $.BN=U;U.BN=U,U.wordSize=26;var O;try{if(typeof window!=="undefined"&&typeof window.Buffer!=="undefined")O=window.Buffer;else O=(OX(),GX(VX)).Buffer}catch(W){}U.isBN=function W(Q){if(Q instanceof U)return!0;return Q!==null&&typeof Q==="object"&&Q.constructor.wordSize===U.wordSize&&Array.isArray(Q.words)},U.max=function W(Q,Y){if(Q.cmp(Y)>0)return Q;return Y},U.min=function W(Q,Y){if(Q.cmp(Y)<0)return Q;return Y},U.prototype._init=function W(Q,Y,V){if(typeof Q==="number")return this._initNumber(Q,Y,V);if(typeof Q==="object")return this._initArray(Q,Y,V);if(Y==="hex")Y=16;Z(Y===(Y|0)&&Y>=2&&Y<=36),Q=Q.toString().replace(/\s+/g,"");var A=0;if(Q[0]==="-")A++,this.negative=1;if(A<Q.length){if(Y===16)this._parseHex(Q,A,V);else if(this._parseBase(Q,Y,A),V==="le")this._initArray(this.toArray(),Y,V)}},U.prototype._initNumber=function W(Q,Y,V){if(Q<0)this.negative=1,Q=-Q;if(Q<67108864)this.words=[Q&67108863],this.length=1;else if(Q<4503599627370496)this.words=[Q&67108863,Q/67108864&67108863],this.length=2;else Z(Q<9007199254740992),this.words=[Q&67108863,Q/67108864&67108863,1],this.length=3;if(V!=="le")return;this._initArray(this.toArray(),Y,V)},U.prototype._initArray=function W(Q,Y,V){if(Z(typeof Q.length==="number"),Q.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(Q.length/3),this.words=new Array(this.length);for(var A=0;A<this.length;A++)this.words[A]=0;var L,H,M=0;if(V==="be"){for(A=Q.length-1,L=0;A>=0;A-=3)if(H=Q[A]|Q[A-1]<<8|Q[A-2]<<16,this.words[L]|=H<<M&67108863,this.words[L+1]=H>>>26-M&67108863,M+=24,M>=26)M-=26,L++}else if(V==="le"){for(A=0,L=0;A<Q.length;A+=3)if(H=Q[A]|Q[A+1]<<8|Q[A+2]<<16,this.words[L]|=H<<M&67108863,this.words[L+1]=H>>>26-M&67108863,M+=24,M>=26)M-=26,L++}return this.strip()};function D(W,Q){var Y=W.charCodeAt(Q);if(Y>=65&&Y<=70)return Y-55;else if(Y>=97&&Y<=102)return Y-87;else return Y-48&15}function F(W,Q,Y){var V=D(W,Y);if(Y-1>=Q)V|=D(W,Y-1)<<4;return V}U.prototype._parseHex=function W(Q,Y,V){this.length=Math.ceil((Q.length-Y)/6),this.words=new Array(this.length);for(var A=0;A<this.length;A++)this.words[A]=0;var L=0,H=0,M;if(V==="be")for(A=Q.length-1;A>=Y;A-=2)if(M=F(Q,Y,A)<<L,this.words[H]|=M&67108863,L>=18)L-=18,H+=1,this.words[H]|=M>>>26;else L+=8;else{var q=Q.length-Y;for(A=q%2===0?Y+1:Y;A<Q.length;A+=2)if(M=F(Q,Y,A)<<L,this.words[H]|=M&67108863,L>=18)L-=18,H+=1,this.words[H]|=M>>>26;else L+=8}this.strip()};function K(W,Q,Y,V){var A=0,L=Math.min(W.length,Y);for(var H=Q;H<L;H++){var M=W.charCodeAt(H)-48;if(A*=V,M>=49)A+=M-49+10;else if(M>=17)A+=M-17+10;else A+=M}return A}U.prototype._parseBase=function W(Q,Y,V){this.words=[0],this.length=1;for(var A=0,L=1;L<=67108863;L*=Y)A++;A--,L=L/Y|0;var H=Q.length-V,M=H%A,q=Math.min(H,H-M)+V,X=0;for(var z=V;z<q;z+=A)if(X=K(Q,z,z+A,Y),this.imuln(L),this.words[0]+X<67108864)this.words[0]+=X;else this._iaddn(X);if(M!==0){var _=1;X=K(Q,z,Q.length,Y);for(z=0;z<M;z++)_*=Y;if(this.imuln(_),this.words[0]+X<67108864)this.words[0]+=X;else this._iaddn(X)}this.strip()},U.prototype.copy=function W(Q){Q.words=new Array(this.length);for(var Y=0;Y<this.length;Y++)Q.words[Y]=this.words[Y];Q.length=this.length,Q.negative=this.negative,Q.red=this.red},U.prototype.clone=function W(){var Q=new U(null);return this.copy(Q),Q},U.prototype._expand=function W(Q){while(this.length<Q)this.words[this.length++]=0;return this},U.prototype.strip=function W(){while(this.length>1&&this.words[this.length-1]===0)this.length--;return this._normSign()},U.prototype._normSign=function W(){if(this.length===1&&this.words[0]===0)this.negative=0;return this},U.prototype.inspect=function W(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var E=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],R=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],C=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64000000,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,24300000,28629151,33554432,39135393,45435424,52521875,60466176];if(U.prototype.toString=function W(Q,Y){Q=Q||10,Y=Y|0||1;var V;if(Q===16||Q==="hex"){V="";var A=0,L=0;for(var H=0;H<this.length;H++){var M=this.words[H],q=((M<<A|L)&16777215).toString(16);if(L=M>>>24-A&16777215,A+=2,A>=26)A-=26,H--;if(L!==0||H!==this.length-1)V=E[6-q.length]+q+V;else V=q+V}if(L!==0)V=L.toString(16)+V;while(V.length%Y!==0)V="0"+V;if(this.negative!==0)V="-"+V;return V}if(Q===(Q|0)&&Q>=2&&Q<=36){var X=R[Q],z=C[Q];V="";var _=this.clone();_.negative=0;while(!_.isZero()){var N=_.modn(z).toString(Q);if(_=_.idivn(z),!_.isZero())V=E[X-N.length]+N+V;else V=N+V}if(this.isZero())V="0"+V;while(V.length%Y!==0)V="0"+V;if(this.negative!==0)V="-"+V;return V}Z(!1,"Base should be between 2 and 36")},U.prototype.toNumber=function W(){var Q=this.words[0];if(this.length===2)Q+=this.words[1]*67108864;else if(this.length===3&&this.words[2]===1)Q+=4503599627370496+this.words[1]*67108864;else if(this.length>2)Z(!1,"Number can only safely store up to 53 bits");return this.negative!==0?-Q:Q},U.prototype.toJSON=function W(){return this.toString(16)},U.prototype.toBuffer=function W(Q,Y){return Z(typeof O!=="undefined"),this.toArrayLike(O,Q,Y)},U.prototype.toArray=function W(Q,Y){return this.toArrayLike(Array,Q,Y)},U.prototype.toArrayLike=function W(Q,Y,V){var A=this.byteLength(),L=V||Math.max(1,A);Z(A<=L,"byte array longer than desired length"),Z(L>0,"Requested array length <= 0"),this.strip();var H=Y==="le",M=new Q(L),q,X,z=this.clone();if(!H){for(X=0;X<L-A;X++)M[X]=0;for(X=0;!z.isZero();X++)q=z.andln(255),z.iushrn(8),M[L-X-1]=q}else{for(X=0;!z.isZero();X++)q=z.andln(255),z.iushrn(8),M[X]=q;for(;X<L;X++)M[X]=0}return M},Math.clz32)U.prototype._countBits=function W(Q){return 32-Math.clz32(Q)};else U.prototype._countBits=function W(Q){var Y=Q,V=0;if(Y>=4096)V+=13,Y>>>=13;if(Y>=64)V+=7,Y>>>=7;if(Y>=8)V+=4,Y>>>=4;if(Y>=2)V+=2,Y>>>=2;return V+Y};U.prototype._zeroBits=function W(Q){if(Q===0)return 26;var Y=Q,V=0;if((Y&8191)===0)V+=13,Y>>>=13;if((Y&127)===0)V+=7,Y>>>=7;if((Y&15)===0)V+=4,Y>>>=4;if((Y&3)===0)V+=2,Y>>>=2;if((Y&1)===0)V++;return V},U.prototype.bitLength=function W(){var Q=this.words[this.length-1],Y=this._countBits(Q);return(this.length-1)*26+Y};function v(W){var Q=new Array(W.bitLength());for(var Y=0;Y<Q.length;Y++){var V=Y/26|0,A=Y%26;Q[Y]=(W.words[V]&1<<A)>>>A}return Q}U.prototype.zeroBits=function W(){if(this.isZero())return 0;var Q=0;for(var Y=0;Y<this.length;Y++){var V=this._zeroBits(this.words[Y]);if(Q+=V,V!==26)break}return Q},U.prototype.byteLength=function W(){return Math.ceil(this.bitLength()/8)},U.prototype.toTwos=function W(Q){if(this.negative!==0)return this.abs().inotn(Q).iaddn(1);return this.clone()},U.prototype.fromTwos=function W(Q){if(this.testn(Q-1))return this.notn(Q).iaddn(1).ineg();return this.clone()},U.prototype.isNeg=function W(){return this.negative!==0},U.prototype.neg=function W(){return this.clone().ineg()},U.prototype.ineg=function W(){if(!this.isZero())this.negative^=1;return this},U.prototype.iuor=function W(Q){while(this.length<Q.length)this.words[this.length++]=0;for(var Y=0;Y<Q.length;Y++)this.words[Y]=this.words[Y]|Q.words[Y];return this.strip()},U.prototype.ior=function W(Q){return Z((this.negative|Q.negative)===0),this.iuor(Q)},U.prototype.or=function W(Q){if(this.length>Q.length)return this.clone().ior(Q);return Q.clone().ior(this)},U.prototype.uor=function W(Q){if(this.length>Q.length)return this.clone().iuor(Q);return Q.clone().iuor(this)},U.prototype.iuand=function W(Q){var Y;if(this.length>Q.length)Y=Q;else Y=this;for(var V=0;V<Y.length;V++)this.words[V]=this.words[V]&Q.words[V];return this.length=Y.length,this.strip()},U.prototype.iand=function W(Q){return Z((this.negative|Q.negative)===0),this.iuand(Q)},U.prototype.and=function W(Q){if(this.length>Q.length)return this.clone().iand(Q);return Q.clone().iand(this)},U.prototype.uand=function W(Q){if(this.length>Q.length)return this.clone().iuand(Q);return Q.clone().iuand(this)},U.prototype.iuxor=function W(Q){var Y,V;if(this.length>Q.length)Y=this,V=Q;else Y=Q,V=this;for(var A=0;A<V.length;A++)this.words[A]=Y.words[A]^V.words[A];if(this!==Y)for(;A<Y.length;A++)this.words[A]=Y.words[A];return this.length=Y.length,this.strip()},U.prototype.ixor=function W(Q){return Z((this.negative|Q.negative)===0),this.iuxor(Q)},U.prototype.xor=function W(Q){if(this.length>Q.length)return this.clone().ixor(Q);return Q.clone().ixor(this)},U.prototype.uxor=function W(Q){if(this.length>Q.length)return this.clone().iuxor(Q);return Q.clone().iuxor(this)},U.prototype.inotn=function W(Q){Z(typeof Q==="number"&&Q>=0);var Y=Math.ceil(Q/26)|0,V=Q%26;if(this._expand(Y),V>0)Y--;for(var A=0;A<Y;A++)this.words[A]=~this.words[A]&67108863;if(V>0)this.words[A]=~this.words[A]&67108863>>26-V;return this.strip()},U.prototype.notn=function W(Q){return this.clone().inotn(Q)},U.prototype.setn=function W(Q,Y){Z(typeof Q==="number"&&Q>=0);var V=Q/26|0,A=Q%26;if(this._expand(V+1),Y)this.words[V]=this.words[V]|1<<A;else this.words[V]=this.words[V]&~(1<<A);return this.strip()},U.prototype.iadd=function W(Q){var Y;if(this.negative!==0&&Q.negative===0)return this.negative=0,Y=this.isub(Q),this.negative^=1,this._normSign();else if(this.negative===0&&Q.negative!==0)return Q.negative=0,Y=this.isub(Q),Q.negative=1,Y._normSign();var V,A;if(this.length>Q.length)V=this,A=Q;else V=Q,A=this;var L=0;for(var H=0;H<A.length;H++)Y=(V.words[H]|0)+(A.words[H]|0)+L,this.words[H]=Y&67108863,L=Y>>>26;for(;L!==0&&H<V.length;H++)Y=(V.words[H]|0)+L,this.words[H]=Y&67108863,L=Y>>>26;if(this.length=V.length,L!==0)this.words[this.length]=L,this.length++;else if(V!==this)for(;H<V.length;H++)this.words[H]=V.words[H];return this},U.prototype.add=function W(Q){var Y;if(Q.negative!==0&&this.negative===0)return Q.negative=0,Y=this.sub(Q),Q.negative^=1,Y;else if(Q.negative===0&&this.negative!==0)return this.negative=0,Y=Q.sub(this),this.negative=1,Y;if(this.length>Q.length)return this.clone().iadd(Q);return Q.clone().iadd(this)},U.prototype.isub=function W(Q){if(Q.negative!==0){Q.negative=0;var Y=this.iadd(Q);return Q.negative=1,Y._normSign()}else if(this.negative!==0)return this.negative=0,this.iadd(Q),this.negative=1,this._normSign();var V=this.cmp(Q);if(V===0)return this.negative=0,this.length=1,this.words[0]=0,this;var A,L;if(V>0)A=this,L=Q;else A=Q,L=this;var H=0;for(var M=0;M<L.length;M++)Y=(A.words[M]|0)-(L.words[M]|0)+H,H=Y>>26,this.words[M]=Y&67108863;for(;H!==0&&M<A.length;M++)Y=(A.words[M]|0)+H,H=Y>>26,this.words[M]=Y&67108863;if(H===0&&M<A.length&&A!==this)for(;M<A.length;M++)this.words[M]=A.words[M];if(this.length=Math.max(this.length,M),A!==this)this.negative=1;return this.strip()},U.prototype.sub=function W(Q){return this.clone().isub(Q)};function c(W,Q,Y){Y.negative=Q.negative^W.negative;var V=W.length+Q.length|0;Y.length=V,V=V-1|0;var A=W.words[0]|0,L=Q.words[0]|0,H=A*L,M=H&67108863,q=H/67108864|0;Y.words[0]=M;for(var X=1;X<V;X++){var z=q>>>26,_=q&67108863,N=Math.min(X,Q.length-1);for(var j=Math.max(0,X-W.length+1);j<=N;j++){var P=X-j|0;A=W.words[P]|0,L=Q.words[j]|0,H=A*L+_,z+=H/67108864|0,_=H&67108863}Y.words[X]=_|0,q=z|0}if(q!==0)Y.words[X]=q|0;else Y.length--;return Y.strip()}var N0=function W(Q,Y,V){var A=Q.words,L=Y.words,H=V.words,M=0,q,X,z,_=A[0]|0,N=_&8191,j=_>>>13,P=A[1]|0,B=P&8191,I=P>>>13,y0=A[2]|0,g=y0&8191,y=y0>>>13,pJ=A[3]|0,d=pJ&8191,l=pJ>>>13,uJ=A[4]|0,m=uJ&8191,o=uJ>>>13,rJ=A[5]|0,p=rJ&8191,u=rJ>>>13,nJ=A[6]|0,r=nJ&8191,n=nJ>>>13,sJ=A[7]|0,s=sJ&8191,a=sJ>>>13,aJ=A[8]|0,i=aJ&8191,t=aJ>>>13,iJ=A[9]|0,e=iJ&8191,J0=iJ>>>13,tJ=L[0]|0,$0=tJ&8191,Q0=tJ>>>13,eJ=L[1]|0,Z0=eJ&8191,X0=eJ>>>13,J$=L[2]|0,U0=J$&8191,Y0=J$>>>13,$$=L[3]|0,G0=$$&8191,V0=$$>>>13,Q$=L[4]|0,O0=Q$&8191,A0=Q$>>>13,Z$=L[5]|0,q0=Z$&8191,z0=Z$>>>13,X$=L[6]|0,D0=X$&8191,L0=X$>>>13,U$=L[7]|0,W0=U$&8191,H0=U$>>>13,Y$=L[8]|0,F0=Y$&8191,M0=Y$>>>13,G$=L[9]|0,K0=G$&8191,E0=G$>>>13;V.negative=Q.negative^Y.negative,V.length=19,q=Math.imul(N,$0),X=Math.imul(N,Q0),X=X+Math.imul(j,$0)|0,z=Math.imul(j,Q0);var l1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(l1>>>26)|0,l1&=67108863,q=Math.imul(B,$0),X=Math.imul(B,Q0),X=X+Math.imul(I,$0)|0,z=Math.imul(I,Q0),q=q+Math.imul(N,Z0)|0,X=X+Math.imul(N,X0)|0,X=X+Math.imul(j,Z0)|0,z=z+Math.imul(j,X0)|0;var m1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(m1>>>26)|0,m1&=67108863,q=Math.imul(g,$0),X=Math.imul(g,Q0),X=X+Math.imul(y,$0)|0,z=Math.imul(y,Q0),q=q+Math.imul(B,Z0)|0,X=X+Math.imul(B,X0)|0,X=X+Math.imul(I,Z0)|0,z=z+Math.imul(I,X0)|0,q=q+Math.imul(N,U0)|0,X=X+Math.imul(N,Y0)|0,X=X+Math.imul(j,U0)|0,z=z+Math.imul(j,Y0)|0;var o1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(o1>>>26)|0,o1&=67108863,q=Math.imul(d,$0),X=Math.imul(d,Q0),X=X+Math.imul(l,$0)|0,z=Math.imul(l,Q0),q=q+Math.imul(g,Z0)|0,X=X+Math.imul(g,X0)|0,X=X+Math.imul(y,Z0)|0,z=z+Math.imul(y,X0)|0,q=q+Math.imul(B,U0)|0,X=X+Math.imul(B,Y0)|0,X=X+Math.imul(I,U0)|0,z=z+Math.imul(I,Y0)|0,q=q+Math.imul(N,G0)|0,X=X+Math.imul(N,V0)|0,X=X+Math.imul(j,G0)|0,z=z+Math.imul(j,V0)|0;var p1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(p1>>>26)|0,p1&=67108863,q=Math.imul(m,$0),X=Math.imul(m,Q0),X=X+Math.imul(o,$0)|0,z=Math.imul(o,Q0),q=q+Math.imul(d,Z0)|0,X=X+Math.imul(d,X0)|0,X=X+Math.imul(l,Z0)|0,z=z+Math.imul(l,X0)|0,q=q+Math.imul(g,U0)|0,X=X+Math.imul(g,Y0)|0,X=X+Math.imul(y,U0)|0,z=z+Math.imul(y,Y0)|0,q=q+Math.imul(B,G0)|0,X=X+Math.imul(B,V0)|0,X=X+Math.imul(I,G0)|0,z=z+Math.imul(I,V0)|0,q=q+Math.imul(N,O0)|0,X=X+Math.imul(N,A0)|0,X=X+Math.imul(j,O0)|0,z=z+Math.imul(j,A0)|0;var u1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(u1>>>26)|0,u1&=67108863,q=Math.imul(p,$0),X=Math.imul(p,Q0),X=X+Math.imul(u,$0)|0,z=Math.imul(u,Q0),q=q+Math.imul(m,Z0)|0,X=X+Math.imul(m,X0)|0,X=X+Math.imul(o,Z0)|0,z=z+Math.imul(o,X0)|0,q=q+Math.imul(d,U0)|0,X=X+Math.imul(d,Y0)|0,X=X+Math.imul(l,U0)|0,z=z+Math.imul(l,Y0)|0,q=q+Math.imul(g,G0)|0,X=X+Math.imul(g,V0)|0,X=X+Math.imul(y,G0)|0,z=z+Math.imul(y,V0)|0,q=q+Math.imul(B,O0)|0,X=X+Math.imul(B,A0)|0,X=X+Math.imul(I,O0)|0,z=z+Math.imul(I,A0)|0,q=q+Math.imul(N,q0)|0,X=X+Math.imul(N,z0)|0,X=X+Math.imul(j,q0)|0,z=z+Math.imul(j,z0)|0;var r1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(r1>>>26)|0,r1&=67108863,q=Math.imul(r,$0),X=Math.imul(r,Q0),X=X+Math.imul(n,$0)|0,z=Math.imul(n,Q0),q=q+Math.imul(p,Z0)|0,X=X+Math.imul(p,X0)|0,X=X+Math.imul(u,Z0)|0,z=z+Math.imul(u,X0)|0,q=q+Math.imul(m,U0)|0,X=X+Math.imul(m,Y0)|0,X=X+Math.imul(o,U0)|0,z=z+Math.imul(o,Y0)|0,q=q+Math.imul(d,G0)|0,X=X+Math.imul(d,V0)|0,X=X+Math.imul(l,G0)|0,z=z+Math.imul(l,V0)|0,q=q+Math.imul(g,O0)|0,X=X+Math.imul(g,A0)|0,X=X+Math.imul(y,O0)|0,z=z+Math.imul(y,A0)|0,q=q+Math.imul(B,q0)|0,X=X+Math.imul(B,z0)|0,X=X+Math.imul(I,q0)|0,z=z+Math.imul(I,z0)|0,q=q+Math.imul(N,D0)|0,X=X+Math.imul(N,L0)|0,X=X+Math.imul(j,D0)|0,z=z+Math.imul(j,L0)|0;var n1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(n1>>>26)|0,n1&=67108863,q=Math.imul(s,$0),X=Math.imul(s,Q0),X=X+Math.imul(a,$0)|0,z=Math.imul(a,Q0),q=q+Math.imul(r,Z0)|0,X=X+Math.imul(r,X0)|0,X=X+Math.imul(n,Z0)|0,z=z+Math.imul(n,X0)|0,q=q+Math.imul(p,U0)|0,X=X+Math.imul(p,Y0)|0,X=X+Math.imul(u,U0)|0,z=z+Math.imul(u,Y0)|0,q=q+Math.imul(m,G0)|0,X=X+Math.imul(m,V0)|0,X=X+Math.imul(o,G0)|0,z=z+Math.imul(o,V0)|0,q=q+Math.imul(d,O0)|0,X=X+Math.imul(d,A0)|0,X=X+Math.imul(l,O0)|0,z=z+Math.imul(l,A0)|0,q=q+Math.imul(g,q0)|0,X=X+Math.imul(g,z0)|0,X=X+Math.imul(y,q0)|0,z=z+Math.imul(y,z0)|0,q=q+Math.imul(B,D0)|0,X=X+Math.imul(B,L0)|0,X=X+Math.imul(I,D0)|0,z=z+Math.imul(I,L0)|0,q=q+Math.imul(N,W0)|0,X=X+Math.imul(N,H0)|0,X=X+Math.imul(j,W0)|0,z=z+Math.imul(j,H0)|0;var s1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(s1>>>26)|0,s1&=67108863,q=Math.imul(i,$0),X=Math.imul(i,Q0),X=X+Math.imul(t,$0)|0,z=Math.imul(t,Q0),q=q+Math.imul(s,Z0)|0,X=X+Math.imul(s,X0)|0,X=X+Math.imul(a,Z0)|0,z=z+Math.imul(a,X0)|0,q=q+Math.imul(r,U0)|0,X=X+Math.imul(r,Y0)|0,X=X+Math.imul(n,U0)|0,z=z+Math.imul(n,Y0)|0,q=q+Math.imul(p,G0)|0,X=X+Math.imul(p,V0)|0,X=X+Math.imul(u,G0)|0,z=z+Math.imul(u,V0)|0,q=q+Math.imul(m,O0)|0,X=X+Math.imul(m,A0)|0,X=X+Math.imul(o,O0)|0,z=z+Math.imul(o,A0)|0,q=q+Math.imul(d,q0)|0,X=X+Math.imul(d,z0)|0,X=X+Math.imul(l,q0)|0,z=z+Math.imul(l,z0)|0,q=q+Math.imul(g,D0)|0,X=X+Math.imul(g,L0)|0,X=X+Math.imul(y,D0)|0,z=z+Math.imul(y,L0)|0,q=q+Math.imul(B,W0)|0,X=X+Math.imul(B,H0)|0,X=X+Math.imul(I,W0)|0,z=z+Math.imul(I,H0)|0,q=q+Math.imul(N,F0)|0,X=X+Math.imul(N,M0)|0,X=X+Math.imul(j,F0)|0,z=z+Math.imul(j,M0)|0;var a1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(a1>>>26)|0,a1&=67108863,q=Math.imul(e,$0),X=Math.imul(e,Q0),X=X+Math.imul(J0,$0)|0,z=Math.imul(J0,Q0),q=q+Math.imul(i,Z0)|0,X=X+Math.imul(i,X0)|0,X=X+Math.imul(t,Z0)|0,z=z+Math.imul(t,X0)|0,q=q+Math.imul(s,U0)|0,X=X+Math.imul(s,Y0)|0,X=X+Math.imul(a,U0)|0,z=z+Math.imul(a,Y0)|0,q=q+Math.imul(r,G0)|0,X=X+Math.imul(r,V0)|0,X=X+Math.imul(n,G0)|0,z=z+Math.imul(n,V0)|0,q=q+Math.imul(p,O0)|0,X=X+Math.imul(p,A0)|0,X=X+Math.imul(u,O0)|0,z=z+Math.imul(u,A0)|0,q=q+Math.imul(m,q0)|0,X=X+Math.imul(m,z0)|0,X=X+Math.imul(o,q0)|0,z=z+Math.imul(o,z0)|0,q=q+Math.imul(d,D0)|0,X=X+Math.imul(d,L0)|0,X=X+Math.imul(l,D0)|0,z=z+Math.imul(l,L0)|0,q=q+Math.imul(g,W0)|0,X=X+Math.imul(g,H0)|0,X=X+Math.imul(y,W0)|0,z=z+Math.imul(y,H0)|0,q=q+Math.imul(B,F0)|0,X=X+Math.imul(B,M0)|0,X=X+Math.imul(I,F0)|0,z=z+Math.imul(I,M0)|0,q=q+Math.imul(N,K0)|0,X=X+Math.imul(N,E0)|0,X=X+Math.imul(j,K0)|0,z=z+Math.imul(j,E0)|0;var i1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(i1>>>26)|0,i1&=67108863,q=Math.imul(e,Z0),X=Math.imul(e,X0),X=X+Math.imul(J0,Z0)|0,z=Math.imul(J0,X0),q=q+Math.imul(i,U0)|0,X=X+Math.imul(i,Y0)|0,X=X+Math.imul(t,U0)|0,z=z+Math.imul(t,Y0)|0,q=q+Math.imul(s,G0)|0,X=X+Math.imul(s,V0)|0,X=X+Math.imul(a,G0)|0,z=z+Math.imul(a,V0)|0,q=q+Math.imul(r,O0)|0,X=X+Math.imul(r,A0)|0,X=X+Math.imul(n,O0)|0,z=z+Math.imul(n,A0)|0,q=q+Math.imul(p,q0)|0,X=X+Math.imul(p,z0)|0,X=X+Math.imul(u,q0)|0,z=z+Math.imul(u,z0)|0,q=q+Math.imul(m,D0)|0,X=X+Math.imul(m,L0)|0,X=X+Math.imul(o,D0)|0,z=z+Math.imul(o,L0)|0,q=q+Math.imul(d,W0)|0,X=X+Math.imul(d,H0)|0,X=X+Math.imul(l,W0)|0,z=z+Math.imul(l,H0)|0,q=q+Math.imul(g,F0)|0,X=X+Math.imul(g,M0)|0,X=X+Math.imul(y,F0)|0,z=z+Math.imul(y,M0)|0,q=q+Math.imul(B,K0)|0,X=X+Math.imul(B,E0)|0,X=X+Math.imul(I,K0)|0,z=z+Math.imul(I,E0)|0;var t1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(t1>>>26)|0,t1&=67108863,q=Math.imul(e,U0),X=Math.imul(e,Y0),X=X+Math.imul(J0,U0)|0,z=Math.imul(J0,Y0),q=q+Math.imul(i,G0)|0,X=X+Math.imul(i,V0)|0,X=X+Math.imul(t,G0)|0,z=z+Math.imul(t,V0)|0,q=q+Math.imul(s,O0)|0,X=X+Math.imul(s,A0)|0,X=X+Math.imul(a,O0)|0,z=z+Math.imul(a,A0)|0,q=q+Math.imul(r,q0)|0,X=X+Math.imul(r,z0)|0,X=X+Math.imul(n,q0)|0,z=z+Math.imul(n,z0)|0,q=q+Math.imul(p,D0)|0,X=X+Math.imul(p,L0)|0,X=X+Math.imul(u,D0)|0,z=z+Math.imul(u,L0)|0,q=q+Math.imul(m,W0)|0,X=X+Math.imul(m,H0)|0,X=X+Math.imul(o,W0)|0,z=z+Math.imul(o,H0)|0,q=q+Math.imul(d,F0)|0,X=X+Math.imul(d,M0)|0,X=X+Math.imul(l,F0)|0,z=z+Math.imul(l,M0)|0,q=q+Math.imul(g,K0)|0,X=X+Math.imul(g,E0)|0,X=X+Math.imul(y,K0)|0,z=z+Math.imul(y,E0)|0;var e1=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(e1>>>26)|0,e1&=67108863,q=Math.imul(e,G0),X=Math.imul(e,V0),X=X+Math.imul(J0,G0)|0,z=Math.imul(J0,V0),q=q+Math.imul(i,O0)|0,X=X+Math.imul(i,A0)|0,X=X+Math.imul(t,O0)|0,z=z+Math.imul(t,A0)|0,q=q+Math.imul(s,q0)|0,X=X+Math.imul(s,z0)|0,X=X+Math.imul(a,q0)|0,z=z+Math.imul(a,z0)|0,q=q+Math.imul(r,D0)|0,X=X+Math.imul(r,L0)|0,X=X+Math.imul(n,D0)|0,z=z+Math.imul(n,L0)|0,q=q+Math.imul(p,W0)|0,X=X+Math.imul(p,H0)|0,X=X+Math.imul(u,W0)|0,z=z+Math.imul(u,H0)|0,q=q+Math.imul(m,F0)|0,X=X+Math.imul(m,M0)|0,X=X+Math.imul(o,F0)|0,z=z+Math.imul(o,M0)|0,q=q+Math.imul(d,K0)|0,X=X+Math.imul(d,E0)|0,X=X+Math.imul(l,K0)|0,z=z+Math.imul(l,E0)|0;var JJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(JJ>>>26)|0,JJ&=67108863,q=Math.imul(e,O0),X=Math.imul(e,A0),X=X+Math.imul(J0,O0)|0,z=Math.imul(J0,A0),q=q+Math.imul(i,q0)|0,X=X+Math.imul(i,z0)|0,X=X+Math.imul(t,q0)|0,z=z+Math.imul(t,z0)|0,q=q+Math.imul(s,D0)|0,X=X+Math.imul(s,L0)|0,X=X+Math.imul(a,D0)|0,z=z+Math.imul(a,L0)|0,q=q+Math.imul(r,W0)|0,X=X+Math.imul(r,H0)|0,X=X+Math.imul(n,W0)|0,z=z+Math.imul(n,H0)|0,q=q+Math.imul(p,F0)|0,X=X+Math.imul(p,M0)|0,X=X+Math.imul(u,F0)|0,z=z+Math.imul(u,M0)|0,q=q+Math.imul(m,K0)|0,X=X+Math.imul(m,E0)|0,X=X+Math.imul(o,K0)|0,z=z+Math.imul(o,E0)|0;var $J=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+($J>>>26)|0,$J&=67108863,q=Math.imul(e,q0),X=Math.imul(e,z0),X=X+Math.imul(J0,q0)|0,z=Math.imul(J0,z0),q=q+Math.imul(i,D0)|0,X=X+Math.imul(i,L0)|0,X=X+Math.imul(t,D0)|0,z=z+Math.imul(t,L0)|0,q=q+Math.imul(s,W0)|0,X=X+Math.imul(s,H0)|0,X=X+Math.imul(a,W0)|0,z=z+Math.imul(a,H0)|0,q=q+Math.imul(r,F0)|0,X=X+Math.imul(r,M0)|0,X=X+Math.imul(n,F0)|0,z=z+Math.imul(n,M0)|0,q=q+Math.imul(p,K0)|0,X=X+Math.imul(p,E0)|0,X=X+Math.imul(u,K0)|0,z=z+Math.imul(u,E0)|0;var QJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(QJ>>>26)|0,QJ&=67108863,q=Math.imul(e,D0),X=Math.imul(e,L0),X=X+Math.imul(J0,D0)|0,z=Math.imul(J0,L0),q=q+Math.imul(i,W0)|0,X=X+Math.imul(i,H0)|0,X=X+Math.imul(t,W0)|0,z=z+Math.imul(t,H0)|0,q=q+Math.imul(s,F0)|0,X=X+Math.imul(s,M0)|0,X=X+Math.imul(a,F0)|0,z=z+Math.imul(a,M0)|0,q=q+Math.imul(r,K0)|0,X=X+Math.imul(r,E0)|0,X=X+Math.imul(n,K0)|0,z=z+Math.imul(n,E0)|0;var ZJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(ZJ>>>26)|0,ZJ&=67108863,q=Math.imul(e,W0),X=Math.imul(e,H0),X=X+Math.imul(J0,W0)|0,z=Math.imul(J0,H0),q=q+Math.imul(i,F0)|0,X=X+Math.imul(i,M0)|0,X=X+Math.imul(t,F0)|0,z=z+Math.imul(t,M0)|0,q=q+Math.imul(s,K0)|0,X=X+Math.imul(s,E0)|0,X=X+Math.imul(a,K0)|0,z=z+Math.imul(a,E0)|0;var XJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(XJ>>>26)|0,XJ&=67108863,q=Math.imul(e,F0),X=Math.imul(e,M0),X=X+Math.imul(J0,F0)|0,z=Math.imul(J0,M0),q=q+Math.imul(i,K0)|0,X=X+Math.imul(i,E0)|0,X=X+Math.imul(t,K0)|0,z=z+Math.imul(t,E0)|0;var UJ=(M+q|0)+((X&8191)<<13)|0;M=(z+(X>>>13)|0)+(UJ>>>26)|0,UJ&=67108863,q=Math.imul(e,K0),X=Math.imul(e,E0),X=X+Math.imul(J0,K0)|0,z=Math.imul(J0,E0);var YJ=(M+q|0)+((X&8191)<<13)|0;if(M=(z+(X>>>13)|0)+(YJ>>>26)|0,YJ&=67108863,H[0]=l1,H[1]=m1,H[2]=o1,H[3]=p1,H[4]=u1,H[5]=r1,H[6]=n1,H[7]=s1,H[8]=a1,H[9]=i1,H[10]=t1,H[11]=e1,H[12]=JJ,H[13]=$J,H[14]=QJ,H[15]=ZJ,H[16]=XJ,H[17]=UJ,H[18]=YJ,M!==0)H[19]=M,V.length++;return V};if(!Math.imul)N0=c;function C0(W,Q,Y){Y.negative=Q.negative^W.negative,Y.length=W.length+Q.length;var V=0,A=0;for(var L=0;L<Y.length-1;L++){var H=A;A=0;var M=V&67108863,q=Math.min(L,Q.length-1);for(var X=Math.max(0,L-W.length+1);X<=q;X++){var z=L-X,_=W.words[z]|0,N=Q.words[X]|0,j=_*N,P=j&67108863;H=H+(j/67108864|0)|0,P=P+M|0,M=P&67108863,H=H+(P>>>26)|0,A+=H>>>26,H&=67108863}Y.words[L]=M,V=H,H=A}if(V!==0)Y.words[L]=V;else Y.length--;return Y.strip()}function _0(W,Q,Y){var V=new f;return V.mulp(W,Q,Y)}U.prototype.mulTo=function W(Q,Y){var V,A=this.length+Q.length;if(this.length===10&&Q.length===10)V=N0(this,Q,Y);else if(A<63)V=c(this,Q,Y);else if(A<1024)V=C0(this,Q,Y);else V=_0(this,Q,Y);return V};function f(W,Q){this.x=W,this.y=Q}f.prototype.makeRBT=function W(Q){var Y=new Array(Q),V=U.prototype._countBits(Q)-1;for(var A=0;A<Q;A++)Y[A]=this.revBin(A,V,Q);return Y},f.prototype.revBin=function W(Q,Y,V){if(Q===0||Q===V-1)return Q;var A=0;for(var L=0;L<Y;L++)A|=(Q&1)<<Y-L-1,Q>>=1;return A},f.prototype.permute=function W(Q,Y,V,A,L,H){for(var M=0;M<H;M++)A[M]=Y[Q[M]],L[M]=V[Q[M]]},f.prototype.transform=function W(Q,Y,V,A,L,H){this.permute(H,Q,Y,V,A,L);for(var M=1;M<L;M<<=1){var q=M<<1,X=Math.cos(2*Math.PI/q),z=Math.sin(2*Math.PI/q);for(var _=0;_<L;_+=q){var N=X,j=z;for(var P=0;P<M;P++){var B=V[_+P],I=A[_+P],y0=V[_+P+M],g=A[_+P+M],y=N*y0-j*g;if(g=N*g+j*y0,y0=y,V[_+P]=B+y0,A[_+P]=I+g,V[_+P+M]=B-y0,A[_+P+M]=I-g,P!==q)y=X*N-z*j,j=X*j+z*N,N=y}}}},f.prototype.guessLen13b=function W(Q,Y){var V=Math.max(Y,Q)|1,A=V&1,L=0;for(V=V/2|0;V;V=V>>>1)L++;return 1<<L+1+A},f.prototype.conjugate=function W(Q,Y,V){if(V<=1)return;for(var A=0;A<V/2;A++){var L=Q[A];Q[A]=Q[V-A-1],Q[V-A-1]=L,L=Y[A],Y[A]=-Y[V-A-1],Y[V-A-1]=-L}},f.prototype.normalize13b=function W(Q,Y){var V=0;for(var A=0;A<Y/2;A++){var L=Math.round(Q[2*A+1]/Y)*8192+Math.round(Q[2*A]/Y)+V;if(Q[A]=L&67108863,L<67108864)V=0;else V=L/67108864|0}return Q},f.prototype.convert13b=function W(Q,Y,V,A){var L=0;for(var H=0;H<Y;H++)L=L+(Q[H]|0),V[2*H]=L&8191,L=L>>>13,V[2*H+1]=L&8191,L=L>>>13;for(H=2*Y;H<A;++H)V[H]=0;Z(L===0),Z((L&-8192)===0)},f.prototype.stub=function W(Q){var Y=new Array(Q);for(var V=0;V<Q;V++)Y[V]=0;return Y},f.prototype.mulp=function W(Q,Y,V){var A=2*this.guessLen13b(Q.length,Y.length),L=this.makeRBT(A),H=this.stub(A),M=new Array(A),q=new Array(A),X=new Array(A),z=new Array(A),_=new Array(A),N=new Array(A),j=V.words;j.length=A,this.convert13b(Q.words,Q.length,M,A),this.convert13b(Y.words,Y.length,z,A),this.transform(M,H,q,X,A,L),this.transform(z,H,_,N,A,L);for(var P=0;P<A;P++){var B=q[P]*_[P]-X[P]*N[P];X[P]=q[P]*N[P]+X[P]*_[P],q[P]=B}return this.conjugate(q,X,A),this.transform(q,X,j,H,A,L),this.conjugate(j,H,A),this.normalize13b(j,A),V.negative=Q.negative^Y.negative,V.length=Q.length+Y.length,V.strip()},U.prototype.mul=function W(Q){var Y=new U(null);return Y.words=new Array(this.length+Q.length),this.mulTo(Q,Y)},U.prototype.mulf=function W(Q){var Y=new U(null);return Y.words=new Array(this.length+Q.length),_0(this,Q,Y)},U.prototype.imul=function W(Q){return this.clone().mulTo(Q,this)},U.prototype.imuln=function W(Q){Z(typeof Q==="number"),Z(Q<67108864);var Y=0;for(var V=0;V<this.length;V++){var A=(this.words[V]|0)*Q,L=(A&67108863)+(Y&67108863);Y>>=26,Y+=A/67108864|0,Y+=L>>>26,this.words[V]=L&67108863}if(Y!==0)this.words[V]=Y,this.length++;return this},U.prototype.muln=function W(Q){return this.clone().imuln(Q)},U.prototype.sqr=function W(){return this.mul(this)},U.prototype.isqr=function W(){return this.imul(this.clone())},U.prototype.pow=function W(Q){var Y=v(Q);if(Y.length===0)return new U(1);var V=this;for(var A=0;A<Y.length;A++,V=V.sqr())if(Y[A]!==0)break;if(++A<Y.length)for(var L=V.sqr();A<Y.length;A++,L=L.sqr()){if(Y[A]===0)continue;V=V.mul(L)}return V},U.prototype.iushln=function W(Q){Z(typeof Q==="number"&&Q>=0);var Y=Q%26,V=(Q-Y)/26,A=67108863>>>26-Y<<26-Y,L;if(Y!==0){var H=0;for(L=0;L<this.length;L++){var M=this.words[L]&A,q=(this.words[L]|0)-M<<Y;this.words[L]=q|H,H=M>>>26-Y}if(H)this.words[L]=H,this.length++}if(V!==0){for(L=this.length-1;L>=0;L--)this.words[L+V]=this.words[L];for(L=0;L<V;L++)this.words[L]=0;this.length+=V}return this.strip()},U.prototype.ishln=function W(Q){return Z(this.negative===0),this.iushln(Q)},U.prototype.iushrn=function W(Q,Y,V){Z(typeof Q==="number"&&Q>=0);var A;if(Y)A=(Y-Y%26)/26;else A=0;var L=Q%26,H=Math.min((Q-L)/26,this.length),M=67108863^67108863>>>L<<L,q=V;if(A-=H,A=Math.max(0,A),q){for(var X=0;X<H;X++)q.words[X]=this.words[X];q.length=H}if(H===0);else if(this.length>H){this.length-=H;for(X=0;X<this.length;X++)this.words[X]=this.words[X+H]}else this.words[0]=0,this.length=1;var z=0;for(X=this.length-1;X>=0&&(z!==0||X>=A);X--){var _=this.words[X]|0;this.words[X]=z<<26-L|_>>>L,z=_&M}if(q&&z!==0)q.words[q.length++]=z;if(this.length===0)this.words[0]=0,this.length=1;return this.strip()},U.prototype.ishrn=function W(Q,Y,V){return Z(this.negative===0),this.iushrn(Q,Y,V)},U.prototype.shln=function W(Q){return this.clone().ishln(Q)},U.prototype.ushln=function W(Q){return this.clone().iushln(Q)},U.prototype.shrn=function W(Q){return this.clone().ishrn(Q)},U.prototype.ushrn=function W(Q){return this.clone().iushrn(Q)},U.prototype.testn=function W(Q){Z(typeof Q==="number"&&Q>=0);var Y=Q%26,V=(Q-Y)/26,A=1<<Y;if(this.length<=V)return!1;var L=this.words[V];return!!(L&A)},U.prototype.imaskn=function W(Q){Z(typeof Q==="number"&&Q>=0);var Y=Q%26,V=(Q-Y)/26;if(Z(this.negative===0,"imaskn works only with positive numbers"),this.length<=V)return this;if(Y!==0)V++;if(this.length=Math.min(V,this.length),Y!==0){var A=67108863^67108863>>>Y<<Y;this.words[this.length-1]&=A}return this.strip()},U.prototype.maskn=function W(Q){return this.clone().imaskn(Q)},U.prototype.iaddn=function W(Q){if(Z(typeof Q==="number"),Z(Q<67108864),Q<0)return this.isubn(-Q);if(this.negative!==0){if(this.length===1&&(this.words[0]|0)<Q)return this.words[0]=Q-(this.words[0]|0),this.negative=0,this;return this.negative=0,this.isubn(Q),this.negative=1,this}return this._iaddn(Q)},U.prototype._iaddn=function W(Q){this.words[0]+=Q;for(var Y=0;Y<this.length&&this.words[Y]>=67108864;Y++)if(this.words[Y]-=67108864,Y===this.length-1)this.words[Y+1]=1;else this.words[Y+1]++;return this.length=Math.max(this.length,Y+1),this},U.prototype.isubn=function W(Q){if(Z(typeof Q==="number"),Z(Q<67108864),Q<0)return this.iaddn(-Q);if(this.negative!==0)return this.negative=0,this.iaddn(Q),this.negative=1,this;if(this.words[0]-=Q,this.length===1&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var Y=0;Y<this.length&&this.words[Y]<0;Y++)this.words[Y]+=67108864,this.words[Y+1]-=1;return this.strip()},U.prototype.addn=function W(Q){return this.clone().iaddn(Q)},U.prototype.subn=function W(Q){return this.clone().isubn(Q)},U.prototype.iabs=function W(){return this.negative=0,this},U.prototype.abs=function W(){return this.clone().iabs()},U.prototype._ishlnsubmul=function W(Q,Y,V){var A=Q.length+V,L;this._expand(A);var H,M=0;for(L=0;L<Q.length;L++){H=(this.words[L+V]|0)+M;var q=(Q.words[L]|0)*Y;H-=q&67108863,M=(H>>26)-(q/67108864|0),this.words[L+V]=H&67108863}for(;L<this.length-V;L++)H=(this.words[L+V]|0)+M,M=H>>26,this.words[L+V]=H&67108863;if(M===0)return this.strip();Z(M===-1),M=0;for(L=0;L<this.length;L++)H=-(this.words[L]|0)+M,M=H>>26,this.words[L]=H&67108863;return this.negative=1,this.strip()},U.prototype._wordDiv=function W(Q,Y){var V=this.length-Q.length,A=this.clone(),L=Q,H=L.words[L.length-1]|0,M=this._countBits(H);if(V=26-M,V!==0)L=L.ushln(V),A.iushln(V),H=L.words[L.length-1]|0;var q=A.length-L.length,X;if(Y!=="mod"){X=new U(null),X.length=q+1,X.words=new Array(X.length);for(var z=0;z<X.length;z++)X.words[z]=0}var _=A.clone()._ishlnsubmul(L,1,q);if(_.negative===0){if(A=_,X)X.words[q]=1}for(var N=q-1;N>=0;N--){var j=(A.words[L.length+N]|0)*67108864+(A.words[L.length+N-1]|0);j=Math.min(j/H|0,67108863),A._ishlnsubmul(L,j,N);while(A.negative!==0)if(j--,A.negative=0,A._ishlnsubmul(L,1,N),!A.isZero())A.negative^=1;if(X)X.words[N]=j}if(X)X.strip();if(A.strip(),Y!=="div"&&V!==0)A.iushrn(V);return{div:X||null,mod:A}},U.prototype.divmod=function W(Q,Y,V){if(Z(!Q.isZero()),this.isZero())return{div:new U(0),mod:new U(0)};var A,L,H;if(this.negative!==0&&Q.negative===0){if(H=this.neg().divmod(Q,Y),Y!=="mod")A=H.div.neg();if(Y!=="div"){if(L=H.mod.neg(),V&&L.negative!==0)L.iadd(Q)}return{div:A,mod:L}}if(this.negative===0&&Q.negative!==0){if(H=this.divmod(Q.neg(),Y),Y!=="mod")A=H.div.neg();return{div:A,mod:H.mod}}if((this.negative&Q.negative)!==0){if(H=this.neg().divmod(Q.neg(),Y),Y!=="div"){if(L=H.mod.neg(),V&&L.negative!==0)L.isub(Q)}return{div:H.div,mod:L}}if(Q.length>this.length||this.cmp(Q)<0)return{div:new U(0),mod:this};if(Q.length===1){if(Y==="div")return{div:this.divn(Q.words[0]),mod:null};if(Y==="mod")return{div:null,mod:new U(this.modn(Q.words[0]))};return{div:this.divn(Q.words[0]),mod:new U(this.modn(Q.words[0]))}}return this._wordDiv(Q,Y)},U.prototype.div=function W(Q){return this.divmod(Q,"div",!1).div},U.prototype.mod=function W(Q){return this.divmod(Q,"mod",!1).mod},U.prototype.umod=function W(Q){return this.divmod(Q,"mod",!0).mod},U.prototype.divRound=function W(Q){var Y=this.divmod(Q);if(Y.mod.isZero())return Y.div;var V=Y.div.negative!==0?Y.mod.isub(Q):Y.mod,A=Q.ushrn(1),L=Q.andln(1),H=V.cmp(A);if(H<0||L===1&&H===0)return Y.div;return Y.div.negative!==0?Y.div.isubn(1):Y.div.iaddn(1)},U.prototype.modn=function W(Q){Z(Q<=67108863);var Y=67108864%Q,V=0;for(var A=this.length-1;A>=0;A--)V=(Y*V+(this.words[A]|0))%Q;return V},U.prototype.idivn=function W(Q){Z(Q<=67108863);var Y=0;for(var V=this.length-1;V>=0;V--){var A=(this.words[V]|0)+Y*67108864;this.words[V]=A/Q|0,Y=A%Q}return this.strip()},U.prototype.divn=function W(Q){return this.clone().idivn(Q)},U.prototype.egcd=function W(Q){Z(Q.negative===0),Z(!Q.isZero());var Y=this,V=Q.clone();if(Y.negative!==0)Y=Y.umod(Q);else Y=Y.clone();var A=new U(1),L=new U(0),H=new U(0),M=new U(1),q=0;while(Y.isEven()&&V.isEven())Y.iushrn(1),V.iushrn(1),++q;var X=V.clone(),z=Y.clone();while(!Y.isZero()){for(var _=0,N=1;(Y.words[0]&N)===0&&_<26;++_,N<<=1);if(_>0){Y.iushrn(_);while(_-- >0){if(A.isOdd()||L.isOdd())A.iadd(X),L.isub(z);A.iushrn(1),L.iushrn(1)}}for(var j=0,P=1;(V.words[0]&P)===0&&j<26;++j,P<<=1);if(j>0){V.iushrn(j);while(j-- >0){if(H.isOdd()||M.isOdd())H.iadd(X),M.isub(z);H.iushrn(1),M.iushrn(1)}}if(Y.cmp(V)>=0)Y.isub(V),A.isub(H),L.isub(M);else V.isub(Y),H.isub(A),M.isub(L)}return{a:H,b:M,gcd:V.iushln(q)}},U.prototype._invmp=function W(Q){Z(Q.negative===0),Z(!Q.isZero());var Y=this,V=Q.clone();if(Y.negative!==0)Y=Y.umod(Q);else Y=Y.clone();var A=new U(1),L=new U(0),H=V.clone();while(Y.cmpn(1)>0&&V.cmpn(1)>0){for(var M=0,q=1;(Y.words[0]&q)===0&&M<26;++M,q<<=1);if(M>0){Y.iushrn(M);while(M-- >0){if(A.isOdd())A.iadd(H);A.iushrn(1)}}for(var X=0,z=1;(V.words[0]&z)===0&&X<26;++X,z<<=1);if(X>0){V.iushrn(X);while(X-- >0){if(L.isOdd())L.iadd(H);L.iushrn(1)}}if(Y.cmp(V)>=0)Y.isub(V),A.isub(L);else V.isub(Y),L.isub(A)}var _;if(Y.cmpn(1)===0)_=A;else _=L;if(_.cmpn(0)<0)_.iadd(Q);return _},U.prototype.gcd=function W(Q){if(this.isZero())return Q.abs();if(Q.isZero())return this.abs();var Y=this.clone(),V=Q.clone();Y.negative=0,V.negative=0;for(var A=0;Y.isEven()&&V.isEven();A++)Y.iushrn(1),V.iushrn(1);do{while(Y.isEven())Y.iushrn(1);while(V.isEven())V.iushrn(1);var L=Y.cmp(V);if(L<0){var H=Y;Y=V,V=H}else if(L===0||V.cmpn(1)===0)break;Y.isub(V)}while(!0);return V.iushln(A)},U.prototype.invm=function W(Q){return this.egcd(Q).a.umod(Q)},U.prototype.isEven=function W(){return(this.words[0]&1)===0},U.prototype.isOdd=function W(){return(this.words[0]&1)===1},U.prototype.andln=function W(Q){return this.words[0]&Q},U.prototype.bincn=function W(Q){Z(typeof Q==="number");var Y=Q%26,V=(Q-Y)/26,A=1<<Y;if(this.length<=V)return this._expand(V+1),this.words[V]|=A,this;var L=A;for(var H=V;L!==0&&H<this.length;H++){var M=this.words[H]|0;M+=L,L=M>>>26,M&=67108863,this.words[H]=M}if(L!==0)this.words[H]=L,this.length++;return this},U.prototype.isZero=function W(){return this.length===1&&this.words[0]===0},U.prototype.cmpn=function W(Q){var Y=Q<0;if(this.negative!==0&&!Y)return-1;if(this.negative===0&&Y)return 1;this.strip();var V;if(this.length>1)V=1;else{if(Y)Q=-Q;Z(Q<=67108863,"Number is too big");var A=this.words[0]|0;V=A===Q?0:A<Q?-1:1}if(this.negative!==0)return-V|0;return V},U.prototype.cmp=function W(Q){if(this.negative!==0&&Q.negative===0)return-1;if(this.negative===0&&Q.negative!==0)return 1;var Y=this.ucmp(Q);if(this.negative!==0)return-Y|0;return Y},U.prototype.ucmp=function W(Q){if(this.length>Q.length)return 1;if(this.length<Q.length)return-1;var Y=0;for(var V=this.length-1;V>=0;V--){var A=this.words[V]|0,L=Q.words[V]|0;if(A===L)continue;if(A<L)Y=-1;else if(A>L)Y=1;break}return Y},U.prototype.gtn=function W(Q){return this.cmpn(Q)===1},U.prototype.gt=function W(Q){return this.cmp(Q)===1},U.prototype.gten=function W(Q){return this.cmpn(Q)>=0},U.prototype.gte=function W(Q){return this.cmp(Q)>=0},U.prototype.ltn=function W(Q){return this.cmpn(Q)===-1},U.prototype.lt=function W(Q){return this.cmp(Q)===-1},U.prototype.lten=function W(Q){return this.cmpn(Q)<=0},U.prototype.lte=function W(Q){return this.cmp(Q)<=0},U.prototype.eqn=function W(Q){return this.cmpn(Q)===0},U.prototype.eq=function W(Q){return this.cmp(Q)===0},U.red=function W(Q){return new T(Q)},U.prototype.toRed=function W(Q){return Z(!this.red,"Already a number in reduction context"),Z(this.negative===0,"red works only with positives"),Q.convertTo(this)._forceRed(Q)},U.prototype.fromRed=function W(){return Z(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},U.prototype._forceRed=function W(Q){return this.red=Q,this},U.prototype.forceRed=function W(Q){return Z(!this.red,"Already a number in reduction context"),this._forceRed(Q)},U.prototype.redAdd=function W(Q){return Z(this.red,"redAdd works only with red numbers"),this.red.add(this,Q)},U.prototype.redIAdd=function W(Q){return Z(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,Q)},U.prototype.redSub=function W(Q){return Z(this.red,"redSub works only with red numbers"),this.red.sub(this,Q)},U.prototype.redISub=function W(Q){return Z(this.red,"redISub works only with red numbers"),this.red.isub(this,Q)},U.prototype.redShl=function W(Q){return Z(this.red,"redShl works only with red numbers"),this.red.shl(this,Q)},U.prototype.redMul=function W(Q){return Z(this.red,"redMul works only with red numbers"),this.red._verify2(this,Q),this.red.mul(this,Q)},U.prototype.redIMul=function W(Q){return Z(this.red,"redMul works only with red numbers"),this.red._verify2(this,Q),this.red.imul(this,Q)},U.prototype.redSqr=function W(){return Z(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},U.prototype.redISqr=function W(){return Z(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},U.prototype.redSqrt=function W(){return Z(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},U.prototype.redInvm=function W(){return Z(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},U.prototype.redNeg=function W(){return Z(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},U.prototype.redPow=function W(Q){return Z(this.red&&!Q.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,Q)};var w={k256:null,p224:null,p192:null,p25519:null};function k(W,Q){this.name=W,this.p=new U(Q,16),this.n=this.p.bitLength(),this.k=new U(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}k.prototype._tmp=function W(){var Q=new U(null);return Q.words=new Array(Math.ceil(this.n/13)),Q},k.prototype.ireduce=function W(Q){var Y=Q,V;do this.split(Y,this.tmp),Y=this.imulK(Y),Y=Y.iadd(this.tmp),V=Y.bitLength();while(V>this.n);var A=V<this.n?-1:Y.ucmp(this.p);if(A===0)Y.words[0]=0,Y.length=1;else if(A>0)Y.isub(this.p);else if(Y.strip!==void 0)Y.strip();else Y._strip();return Y},k.prototype.split=function W(Q,Y){Q.iushrn(this.n,0,Y)},k.prototype.imulK=function W(Q){return Q.imul(this.k)};function S(){k.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}G(S,k),S.prototype.split=function W(Q,Y){var V=4194303,A=Math.min(Q.length,9);for(var L=0;L<A;L++)Y.words[L]=Q.words[L];if(Y.length=A,Q.length<=9){Q.words[0]=0,Q.length=1;return}var H=Q.words[9];Y.words[Y.length++]=H&V;for(L=10;L<Q.length;L++){var M=Q.words[L]|0;Q.words[L-10]=(M&V)<<4|H>>>22,H=M}if(H>>>=22,Q.words[L-10]=H,H===0&&Q.length>10)Q.length-=10;else Q.length-=9},S.prototype.imulK=function W(Q){Q.words[Q.length]=0,Q.words[Q.length+1]=0,Q.length+=2;var Y=0;for(var V=0;V<Q.length;V++){var A=Q.words[V]|0;Y+=A*977,Q.words[V]=Y&67108863,Y=A*64+(Y/67108864|0)}if(Q.words[Q.length-1]===0){if(Q.length--,Q.words[Q.length-1]===0)Q.length--}return Q};function P0(){k.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}G(P0,k);function h(){k.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}G(h,k);function S0(){k.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}G(S0,k),S0.prototype.imulK=function W(Q){var Y=0;for(var V=0;V<Q.length;V++){var A=(Q.words[V]|0)*19+Y,L=A&67108863;A>>>=26,Q.words[V]=L,Y=A}if(Y!==0)Q.words[Q.length++]=Y;return Q},U._prime=function W(Q){if(w[Q])return w[Q];var Y;if(Q==="k256")Y=new S;else if(Q==="p224")Y=new P0;else if(Q==="p192")Y=new h;else if(Q==="p25519")Y=new S0;else throw new Error("Unknown prime "+Q);return w[Q]=Y,Y};function T(W){if(typeof W==="string"){var Q=U._prime(W);this.m=Q.p,this.prime=Q}else Z(W.gtn(1),"modulus must be greater than 1"),this.m=W,this.prime=null}T.prototype._verify1=function W(Q){Z(Q.negative===0,"red works only with positives"),Z(Q.red,"red works only with red numbers")},T.prototype._verify2=function W(Q,Y){Z((Q.negative|Y.negative)===0,"red works only with positives"),Z(Q.red&&Q.red===Y.red,"red works only with red numbers")},T.prototype.imod=function W(Q){if(this.prime)return this.prime.ireduce(Q)._forceRed(this);return Q.umod(this.m)._forceRed(this)},T.prototype.neg=function W(Q){if(Q.isZero())return Q.clone();return this.m.sub(Q)._forceRed(this)},T.prototype.add=function W(Q,Y){this._verify2(Q,Y);var V=Q.add(Y);if(V.cmp(this.m)>=0)V.isub(this.m);return V._forceRed(this)},T.prototype.iadd=function W(Q,Y){this._verify2(Q,Y);var V=Q.iadd(Y);if(V.cmp(this.m)>=0)V.isub(this.m);return V},T.prototype.sub=function W(Q,Y){this._verify2(Q,Y);var V=Q.sub(Y);if(V.cmpn(0)<0)V.iadd(this.m);return V._forceRed(this)},T.prototype.isub=function W(Q,Y){this._verify2(Q,Y);var V=Q.isub(Y);if(V.cmpn(0)<0)V.iadd(this.m);return V},T.prototype.shl=function W(Q,Y){return this._verify1(Q),this.imod(Q.ushln(Y))},T.prototype.imul=function W(Q,Y){return this._verify2(Q,Y),this.imod(Q.imul(Y))},T.prototype.mul=function W(Q,Y){return this._verify2(Q,Y),this.imod(Q.mul(Y))},T.prototype.isqr=function W(Q){return this.imul(Q,Q.clone())},T.prototype.sqr=function W(Q){return this.mul(Q,Q)},T.prototype.sqrt=function W(Q){if(Q.isZero())return Q.clone();var Y=this.m.andln(3);if(Z(Y%2===1),Y===3){var V=this.m.add(new U(1)).iushrn(2);return this.pow(Q,V)}var A=this.m.subn(1),L=0;while(!A.isZero()&&A.andln(1)===0)L++,A.iushrn(1);Z(!A.isZero());var H=new U(1).toRed(this),M=H.redNeg(),q=this.m.subn(1).iushrn(1),X=this.m.bitLength();X=new U(2*X*X).toRed(this);while(this.pow(X,q).cmp(M)!==0)X.redIAdd(M);var z=this.pow(X,A),_=this.pow(Q,A.addn(1).iushrn(1)),N=this.pow(Q,A),j=L;while(N.cmp(H)!==0){var P=N;for(var B=0;P.cmp(H)!==0;B++)P=P.redSqr();Z(B<j);var I=this.pow(z,new U(1).iushln(j-B-1));_=_.redMul(I),z=I.redSqr(),N=N.redMul(z),j=B}return _},T.prototype.invm=function W(Q){var Y=Q._invmp(this.m);if(Y.negative!==0)return Y.negative=0,this.imod(Y).redNeg();else return this.imod(Y)},T.prototype.pow=function W(Q,Y){if(Y.isZero())return new U(1).toRed(this);if(Y.cmpn(1)===0)return Q.clone();var V=4,A=new Array(1<<V);A[0]=new U(1).toRed(this),A[1]=Q;for(var L=2;L<A.length;L++)A[L]=this.mul(A[L-1],Q);var H=A[0],M=0,q=0,X=Y.bitLength()%26;if(X===0)X=26;for(L=Y.length-1;L>=0;L--){var z=Y.words[L];for(var _=X-1;_>=0;_--){var N=z>>_&1;if(H!==A[0])H=this.sqr(H);if(N===0&&M===0){q=0;continue}if(M<<=1,M|=N,q++,q!==V&&(L!==0||_!==0))continue;H=this.mul(H,A[M]),q=0,M=0}X=26}return H},T.prototype.convertTo=function W(Q){var Y=Q.umod(this.m);return Y===Q?Y.clone():Y},T.prototype.convertFrom=function W(Q){var Y=Q.clone();return Y.red=null,Y},U.mont=function W(Q){return new T0(Q)};function T0(W){if(T.call(this,W),this.shift=this.m.bitLength(),this.shift%26!==0)this.shift+=26-this.shift%26;this.r=new U(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}G(T0,T),T0.prototype.convertTo=function W(Q){return this.imod(Q.ushln(this.shift))},T0.prototype.convertFrom=function W(Q){var Y=this.imod(Q.mul(this.rinv));return Y.red=null,Y},T0.prototype.imul=function W(Q,Y){if(Q.isZero()||Y.isZero())return Q.words[0]=0,Q.length=1,Q;var V=Q.imul(Y),A=V.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),L=V.isub(A).iushrn(this.shift),H=L;if(L.cmp(this.m)>=0)H=L.isub(this.m);else if(L.cmpn(0)<0)H=L.iadd(this.m);return H._forceRed(this)},T0.prototype.mul=function W(Q,Y){if(Q.isZero()||Y.isZero())return new U(0)._forceRed(this);var V=Q.mul(Y),A=V.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),L=V.isub(A).iushrn(this.shift),H=L;if(L.cmp(this.m)>=0)H=L.isub(this.m);else if(L.cmpn(0)<0)H=L.iadd(this.m);return H._forceRed(this)},T0.prototype.invm=function W(Q){var Y=this.imod(Q._invmp(this.m).mul(this.r2));return Y._forceRed(this)}})(typeof uQ==="undefined"||uQ,mX)});var rX=x((k9,uX)=>{var B1=hQ(),fA=Buffer.alloc(1,1),pX=Buffer.alloc(1,0);function cA(J,$,Z,G,U){let O=Buffer.alloc(32,0),D=Buffer.alloc(32,1);O=B1("sha256",O).update(D).update(pX).update($).update(J).update(U||"").digest(),D=B1("sha256",O).update(D).digest(),O=B1("sha256",O).update(D).update(fA).update($).update(J).update(U||"").digest(),D=B1("sha256",O).update(D).digest(),D=B1("sha256",O).update(D).digest();let F=D;while(!G(F)||!Z(F))O=B1("sha256",O).update(D).update(pX).digest(),D=B1("sha256",O).update(D).digest(),D=B1("sha256",O).update(D).digest(),F=D;return F}uX.exports=cA});var z1=x((x9,tX)=>{var hA=oX(),bA=HX().ec,rQ=new bA("secp256k1"),dA=rX(),b$=Buffer.alloc(32,0),d$=Buffer.from("fffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141","hex"),nX=Buffer.from("fffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f","hex"),G1=rQ.curve.n,sX=G1.shrn(1),m$=rQ.curve.g;function q$(J){return Buffer.isBuffer(J)&&J.length===32}function o$(J){if(!q$(J))return!1;return J.compare(d$)<0}function v1(J){if(!Buffer.isBuffer(J))return!1;if(J.length<33)return!1;let $=J[0],Z=J.slice(1,33);if(Z.compare(b$)===0)return!1;if(Z.compare(nX)>=0)return!1;if(($===2||$===3)&&J.length===33){try{VJ(J)}catch(U){return!1}return!0}let G=J.slice(33);if(G.compare(b$)===0)return!1;if(G.compare(nX)>=0)return!1;if($===4&&J.length===65)return!0;return!1}function aX(J){return J[0]!==4}function lA(J){if(!v1(J))return!1;return aX(J)}function S1(J){if(!q$(J))return!1;return J.compare(b$)>0&&J.compare(d$)<0}function mA(J){let $=J.slice(0,32),Z=J.slice(32,64);return Buffer.isBuffer(J)&&J.length===64&&$.compare(d$)<0&&Z.compare(d$)<0}function z$(J,$){if(J===void 0&&$!==void 0)return aX($);if(J===void 0)return!0;return J}function e0(J){return new hA(J)}function l$(J){return J.toArrayLike(Buffer,"be",32)}function VJ(J){return rQ.curve.decodePoint(J)}function KJ(J,$){return Buffer.from(J._encode($))}function oA(J,$,Z){if(!v1(J))throw new TypeError("Expected Point");if(!v1($))throw new TypeError("Expected Point");let G=VJ(J),U=VJ($),O=G.add(U);if(O.isInfinity())return null;let D=z$(Z,J);return KJ(O,D)}function pA(J,$,Z){if(!v1(J))throw new TypeError("Expected Point");if(!o$($))throw new TypeError("Expected Tweak");let G=z$(Z,J),U=VJ(J);if($.compare(b$)===0)return KJ(U,G);let O=e0($),D=m$.mul(O),F=U.add(D);if(F.isInfinity())return null;return KJ(F,G)}function uA(J,$){if(!v1(J))throw new TypeError("Expected Point");let Z=VJ(J);if(Z.isInfinity())throw new TypeError("Expected Point");let G=z$($,J);return KJ(Z,G)}function rA(J,$){if(!S1(J))throw new TypeError("Expected Private");let Z=e0(J),G=m$.mul(Z);if(G.isInfinity())return null;let U=z$($);return KJ(G,U)}function nA(J,$,Z){if(!v1(J))throw new TypeError("Expected Point");if(!o$($))throw new TypeError("Expected Tweak");let G=z$(Z,J),U=VJ(J),O=e0($),D=U.mul(O);if(D.isInfinity())return null;return KJ(D,G)}function sA(J,$){if(!S1(J))throw new TypeError("Expected Private");if(!o$($))throw new TypeError("Expected Tweak");let Z=e0(J),G=e0($),U=l$(Z.add(G).umod(G1));if(!S1(U))return null;return U}function aA(J,$){if(!S1(J))throw new TypeError("Expected Private");if(!o$($))throw new TypeError("Expected Tweak");let Z=e0(J),G=e0($),U=l$(Z.sub(G).umod(G1));if(!S1(U))return null;return U}function iA(J,$){return iX(J,$)}function tA(J,$,Z){return iX(J,$,Z)}function iX(J,$,Z){if(!q$(J))throw new TypeError("Expected Hash");if(!S1($))throw new TypeError("Expected Private");if(Z!==void 0&&!q$(Z))throw new TypeError("Expected Extra Data (32 bytes)");let G=e0($),U=e0(J),O,D;if(dA(J,$,function(E){let R=e0(E),C=m$.mul(R);if(C.isInfinity())return!1;if(O=C.x.umod(G1),O.isZero()===0)return!1;if(D=R.invm(G1).mul(U.add(G.mul(O))).umod(G1),D.isZero()===0)return!1;return!0},S1,Z),D.cmp(sX)>0)D=G1.sub(D);let K=Buffer.allocUnsafe(64);return l$(O).copy(K,0),l$(D).copy(K,32),K}function eA(J,$,Z,G){if(!q$(J))throw new TypeError("Expected Hash");if(!v1($))throw new TypeError("Expected Point");if(!mA(Z))throw new TypeError("Expected Signature");let U=VJ($),O=e0(Z.slice(0,32)),D=e0(Z.slice(32,64));if(G&&D.cmp(sX)>0)return!1;if(O.gtn(0)<=0)return!1;if(D.gtn(0)<=0)return!1;let F=e0(J),K=D.invm(G1),E=F.mul(K).umod(G1),R=O.mul(K).umod(G1),C=m$.mulAdd(E,U,R);if(C.isInfinity())return!1;return C.x.umod(G1).eq(O)}tX.exports={isPoint:v1,isPointCompressed:lA,isPrivate:S1,pointAdd:oA,pointAddScalar:pA,pointCompress:uA,pointFromScalar:rA,pointMultiply:nA,privateAdd:sA,privateSub:aA,sign:iA,signWithEntropy:tA,verify:eA}});var p$=x((g9,J8)=>{J8.exports={OP_FALSE:0,OP_0:0,OP_PUSHDATA1:76,OP_PUSHDATA2:77,OP_PUSHDATA4:78,OP_1NEGATE:79,OP_RESERVED:80,OP_TRUE:81,OP_1:81,OP_2:82,OP_3:83,OP_4:84,OP_5:85,OP_6:86,OP_7:87,OP_8:88,OP_9:89,OP_10:90,OP_11:91,OP_12:92,OP_13:93,OP_14:94,OP_15:95,OP_16:96,OP_NOP:97,OP_VER:98,OP_IF:99,OP_NOTIF:100,OP_VERIF:101,OP_VERNOTIF:102,OP_ELSE:103,OP_ENDIF:104,OP_VERIFY:105,OP_RETURN:106,OP_TOALTSTACK:107,OP_FROMALTSTACK:108,OP_2DROP:109,OP_2DUP:110,OP_3DUP:111,OP_2OVER:112,OP_2ROT:113,OP_2SWAP:114,OP_IFDUP:115,OP_DEPTH:116,OP_DROP:117,OP_DUP:118,OP_NIP:119,OP_OVER:120,OP_PICK:121,OP_ROLL:122,OP_ROT:123,OP_SWAP:124,OP_TUCK:125,OP_CAT:126,OP_SUBSTR:127,OP_LEFT:128,OP_RIGHT:129,OP_SIZE:130,OP_INVERT:131,OP_AND:132,OP_OR:133,OP_XOR:134,OP_EQUAL:135,OP_EQUALVERIFY:136,OP_RESERVED1:137,OP_RESERVED2:138,OP_1ADD:139,OP_1SUB:140,OP_2MUL:141,OP_2DIV:142,OP_NEGATE:143,OP_ABS:144,OP_NOT:145,OP_0NOTEQUAL:146,OP_ADD:147,OP_SUB:148,OP_MUL:149,OP_DIV:150,OP_MOD:151,OP_LSHIFT:152,OP_RSHIFT:153,OP_BOOLAND:154,OP_BOOLOR:155,OP_NUMEQUAL:156,OP_NUMEQUALVERIFY:157,OP_NUMNOTEQUAL:158,OP_LESSTHAN:159,OP_GREATERTHAN:160,OP_LESSTHANOREQUAL:161,OP_GREATERTHANOREQUAL:162,OP_MIN:163,OP_MAX:164,OP_WITHIN:165,OP_RIPEMD160:166,OP_SHA1:167,OP_SHA256:168,OP_HASH160:169,OP_HASH256:170,OP_CODESEPARATOR:171,OP_CHECKSIG:172,OP_CHECKSIGVERIFY:173,OP_CHECKMULTISIG:174,OP_CHECKMULTISIGVERIFY:175,OP_NOP1:176,OP_NOP2:177,OP_CHECKLOCKTIMEVERIFY:177,OP_NOP3:178,OP_CHECKSEQUENCEVERIFY:178,OP_NOP4:179,OP_NOP5:180,OP_NOP6:181,OP_NOP7:182,OP_NOP8:183,OP_NOP9:184,OP_NOP10:185,OP_PUBKEYHASH:253,OP_PUBKEY:254,OP_INVALIDOPCODE:255}});var $U=x((w9,JU)=>{var T1=p$();function eX(J){return J<T1.OP_PUSHDATA1?1:J<=255?2:J<=65535?3:5}function $8(J,$,Z){var G=eX($);if(G===1)J.writeUInt8($,Z);else if(G===2)J.writeUInt8(T1.OP_PUSHDATA1,Z),J.writeUInt8($,Z+1);else if(G===3)J.writeUInt8(T1.OP_PUSHDATA2,Z),J.writeUInt16LE($,Z+1);else J.writeUInt8(T1.OP_PUSHDATA4,Z),J.writeUInt32LE($,Z+1);return G}function Q8(J,$){var Z=J.readUInt8($),G,U;if(Z<T1.OP_PUSHDATA1)G=Z,U=1;else if(Z===T1.OP_PUSHDATA1){if($+2>J.length)return null;G=J.readUInt8($+1),U=2}else if(Z===T1.OP_PUSHDATA2){if($+3>J.length)return null;G=J.readUInt16LE($+1),U=3}else{if($+5>J.length)return null;if(Z!==T1.OP_PUSHDATA4)throw new Error("Unexpected opcode");G=J.readUInt32LE($+1),U=5}return{opcode:Z,number:G,size:U}}JU.exports={encodingLength:eX,encode:$8,decode:Q8}});var YU=x((y9,UU)=>{var QU=p$(),XU={};for(nQ in QU)ZU=QU[nQ],XU[ZU]=nQ;var ZU,nQ;UU.exports=XU});var R0=x((DU)=>{Object.defineProperty(DU,"__esModule",{value:!0});var GU=kX(),Z8=lX(),I1=Y1(),X8=hX(),U8=z1(),sQ=$U(),D$=l0();DU.OPS=p$();var Y8=YU(),VU=DU.OPS.OP_RESERVED;function G8(J){return I1.Number(J)&&(J===DU.OPS.OP_0||J>=DU.OPS.OP_1&&J<=DU.OPS.OP_16||J===DU.OPS.OP_1NEGATE)}function V8(J){return I1.Buffer(J)||G8(J)}function OU(J){return I1.Array(J)&&J.every(V8)}DU.isPushOnly=OU;function u$(J){if(J.length===0)return DU.OPS.OP_0;if(J.length!==1)return;if(J[0]>=1&&J[0]<=16)return VU+J[0];if(J[0]===129)return DU.OPS.OP_1NEGATE}function AU(J){return Buffer.isBuffer(J)}function O8(J){return I1.Array(J)}function r$(J){return Buffer.isBuffer(J)}function qU(J){if(AU(J))return J;D$(I1.Array,J);let $=J.reduce((U,O)=>{if(r$(O)){if(O.length===1&&u$(O)!==void 0)return U+1;return U+sQ.encodingLength(O.length)+O.length}return U+1},0),Z=Buffer.allocUnsafe($),G=0;if(J.forEach((U)=>{if(r$(U)){let O=u$(U);if(O!==void 0){Z.writeUInt8(O,G),G+=1;return}G+=sQ.encode(Z,U.length,G),U.copy(Z,G),G+=U.length}else Z.writeUInt8(U,G),G+=1}),G!==Z.length)throw new Error("Could not decode chunks");return Z}DU.compile=qU;function aQ(J){if(O8(J))return J;D$(I1.Buffer,J);let $=[],Z=0;while(Z<J.length){let G=J[Z];if(G>DU.OPS.OP_0&&G<=DU.OPS.OP_PUSHDATA4){let U=sQ.decode(J,Z);if(U===null)return null;if(Z+=U.size,Z+U.number>J.length)return null;let O=J.slice(Z,Z+U.number);Z+=U.number;let D=u$(O);if(D!==void 0)$.push(D);else $.push(O)}else $.push(G),Z+=1}return $}DU.decompile=aQ;function A8(J){if(AU(J))J=aQ(J);return J.map(($)=>{if(r$($)){let Z=u$($);if(Z===void 0)return $.toString("hex");$=Z}return Y8[$]}).join(" ")}DU.toASM=A8;function q8(J){return D$(I1.String,J),qU(J.split(" ").map(($)=>{if(DU.OPS[$]!==void 0)return DU.OPS[$];return D$(I1.Hex,$),Buffer.from($,"hex")}))}DU.fromASM=q8;function z8(J){return J=aQ(J),D$(OU,J),J.map(($)=>{if(r$($))return $;if($===DU.OPS.OP_0)return Buffer.allocUnsafe(0);return GU.encode($-VU)})}DU.toStack=z8;function D8(J){return U8.isPoint(J)}DU.isCanonicalPubKey=D8;function zU(J){let $=J&-129;return $>0&&$<4}DU.isDefinedHashType=zU;function L8(J){if(!Buffer.isBuffer(J))return!1;if(!zU(J[J.length-1]))return!1;return X8.check(J.slice(0,-1))}DU.isCanonicalScriptSignature=L8;DU.number=GU;DU.signature=Z8});var k1=x((LU)=>{Object.defineProperty(LU,"__esModule",{value:!0});function P8(J,$,Z){Object.defineProperty(J,$,{configurable:!0,enumerable:!0,get(){let G=Z.call(this);return this[$]=G,G},set(G){Object.defineProperty(this,$,{configurable:!0,enumerable:!0,value:G,writable:!0})}})}LU.prop=P8;function B8(J){let $;return()=>{if($!==void 0)return $;return $=J(),$}}LU.value=B8});var MU=x((FU)=>{Object.defineProperty(FU,"__esModule",{value:!0});var T8=t0(),n$=R0(),WU=k1(),H1=l0(),HU=n$.OPS;function I8(J,$){if(J.length!==$.length)return!1;return J.every((Z,G)=>{return Z.equals($[G])})}function k8(J,$){if(!J.data&&!J.output)throw new TypeError("Not enough data");$=Object.assign({validate:!0},$||{}),H1({network:H1.maybe(H1.Object),output:H1.maybe(H1.Buffer),data:H1.maybe(H1.arrayOf(H1.Buffer))},J);let G={name:"embed",network:J.network||T8.bitcoin};if(WU.prop(G,"output",()=>{if(!J.data)return;return n$.compile([HU.OP_RETURN].concat(J.data))}),WU.prop(G,"data",()=>{if(!J.output)return;return n$.decompile(J.output).slice(1)}),$.validate){if(J.output){let U=n$.decompile(J.output);if(U[0]!==HU.OP_RETURN)throw new TypeError("Output is invalid");if(!U.slice(1).every(H1.Buffer))throw new TypeError("Output is invalid");if(J.data&&!I8(J.data,G.data))throw new TypeError("Data mismatch")}}return Object.assign(G,J)}FU.p2data=k8});var jU=x((RU)=>{Object.defineProperty(RU,"__esModule",{value:!0});var g8=t0(),EJ=R0(),x1=k1(),RJ=EJ.OPS,u0=l0(),KU=z1(),s$=RJ.OP_RESERVED;function EU(J,$){if(J.length!==$.length)return!1;return J.every((Z,G)=>{return Z.equals($[G])})}function w8(J,$){if(!J.input&&!J.output&&!(J.pubkeys&&J.m!==void 0)&&!J.signatures)throw new TypeError("Not enough data");$=Object.assign({validate:!0},$||{});function Z(K){return EJ.isCanonicalScriptSignature(K)||($.allowIncomplete&&K===RJ.OP_0)!==void 0}u0({network:u0.maybe(u0.Object),m:u0.maybe(u0.Number),n:u0.maybe(u0.Number),output:u0.maybe(u0.Buffer),pubkeys:u0.maybe(u0.arrayOf(KU.isPoint)),signatures:u0.maybe(u0.arrayOf(Z)),input:u0.maybe(u0.Buffer)},J);let U={network:J.network||g8.bitcoin},O=[],D=!1;function F(K){if(D)return;D=!0,O=EJ.decompile(K),U.m=O[0]-s$,U.n=O[O.length-2]-s$,U.pubkeys=O.slice(1,-2)}if(x1.prop(U,"output",()=>{if(!J.m)return;if(!U.n)return;if(!J.pubkeys)return;return EJ.compile([].concat(s$+J.m,J.pubkeys,s$+U.n,RJ.OP_CHECKMULTISIG))}),x1.prop(U,"m",()=>{if(!U.output)return;return F(U.output),U.m}),x1.prop(U,"n",()=>{if(!U.pubkeys)return;return U.pubkeys.length}),x1.prop(U,"pubkeys",()=>{if(!J.output)return;return F(J.output),U.pubkeys}),x1.prop(U,"signatures",()=>{if(!J.input)return;return EJ.decompile(J.input).slice(1)}),x1.prop(U,"input",()=>{if(!J.signatures)return;return EJ.compile([RJ.OP_0].concat(J.signatures))}),x1.prop(U,"witness",()=>{if(!U.input)return;return[]}),x1.prop(U,"name",()=>{if(!U.m||!U.n)return;return`p2ms(${U.m} of ${U.n})`}),$.validate){if(J.output){if(F(J.output),!u0.Number(O[0]))throw new TypeError("Output is invalid");if(!u0.Number(O[O.length-2]))throw new TypeError("Output is invalid");if(O[O.length-1]!==RJ.OP_CHECKMULTISIG)throw new TypeError("Output is invalid");if(U.m<=0||U.n>16||U.m>U.n||U.n!==O.length-3)throw new TypeError("Output is invalid");if(!U.pubkeys.every((K)=>KU.isPoint(K)))throw new TypeError("Output is invalid");if(J.m!==void 0&&J.m!==U.m)throw new TypeError("m mismatch");if(J.n!==void 0&&J.n!==U.n)throw new TypeError("n mismatch");if(J.pubkeys&&!EU(J.pubkeys,U.pubkeys))throw new TypeError("Pubkeys mismatch")}if(J.pubkeys){if(J.n!==void 0&&J.n!==J.pubkeys.length)throw new TypeError("Pubkey count mismatch");if(U.n=J.pubkeys.length,U.n<U.m)throw new TypeError("Pubkey count cannot be less than m")}if(J.signatures){if(J.signatures.length<U.m)throw new TypeError("Not enough signatures provided");if(J.signatures.length>U.m)throw new TypeError("Too many signatures provided")}if(J.input){if(J.input[0]!==RJ.OP_0)throw new TypeError("Input is invalid");if(U.signatures.length===0||!U.signatures.every(Z))throw new TypeError("Input has invalid signature(s)");if(J.signatures&&!EU(J.signatures,U.signatures))throw new TypeError("Signature mismatch");if(J.m!==void 0&&J.m!==J.signatures.length)throw new TypeError("Signature count mismatch")}}return Object.assign(U,J)}RU.p2ms=w8});var PU=x((_U)=>{Object.defineProperty(_U,"__esModule",{value:!0});var f8=t0(),CJ=R0(),jJ=k1(),F1=l0(),CU=CJ.OPS,NU=z1();function c8(J,$){if(!J.input&&!J.output&&!J.pubkey&&!J.input&&!J.signature)throw new TypeError("Not enough data");$=Object.assign({validate:!0},$||{}),F1({network:F1.maybe(F1.Object),output:F1.maybe(F1.Buffer),pubkey:F1.maybe(NU.isPoint),signature:F1.maybe(CJ.isCanonicalScriptSignature),input:F1.maybe(F1.Buffer)},J);let Z=jJ.value(()=>{return CJ.decompile(J.input)}),U={name:"p2pk",network:J.network||f8.bitcoin};if(jJ.prop(U,"output",()=>{if(!J.pubkey)return;return CJ.compile([J.pubkey,CU.OP_CHECKSIG])}),jJ.prop(U,"pubkey",()=>{if(!J.output)return;return J.output.slice(1,-1)}),jJ.prop(U,"signature",()=>{if(!J.input)return;return Z()[0]}),jJ.prop(U,"input",()=>{if(!J.signature)return;return CJ.compile([J.signature])}),jJ.prop(U,"witness",()=>{if(!U.input)return;return[]}),$.validate){if(J.output){if(J.output[J.output.length-1]!==CU.OP_CHECKSIG)throw new TypeError("Output is invalid");if(!NU.isPoint(U.pubkey))throw new TypeError("Output pubkey is invalid");if(J.pubkey&&!J.pubkey.equals(U.pubkey))throw new TypeError("Pubkey mismatch")}if(J.signature){if(J.input&&!J.input.equals(U.input))throw new TypeError("Signature mismatch")}if(J.input){if(Z().length!==1)throw new TypeError("Input is invalid");if(!CJ.isCanonicalScriptSignature(U.signature))throw new TypeError("Input has invalid signature")}}return Object.assign(U,J)}_U.p2pk=c8});var D1=x((vU)=>{Object.defineProperty(vU,"__esModule",{value:!0});var a$=XX();function BU(J){try{return a$("rmd160").update(J).digest()}catch($){return a$("ripemd160").update(J).digest()}}vU.ripemd160=BU;function b8(J){return a$("sha1").update(J).digest()}vU.sha1=b8;function i$(J){return a$("sha256").update(J).digest()}vU.sha256=i$;function d8(J){return BU(i$(J))}vU.hash160=d8;function l8(J){return i$(i$(J))}vU.hash256=l8});var kU=x((IU)=>{Object.defineProperty(IU,"__esModule",{value:!0});var iQ=D1(),n8=t0(),NJ=R0(),M1=k1(),$1=l0(),g1=NJ.OPS,SU=z1(),TU=A$();function s8(J,$){if(!J.address&&!J.hash&&!J.output&&!J.pubkey&&!J.input)throw new TypeError("Not enough data");$=Object.assign({validate:!0},$||{}),$1({network:$1.maybe($1.Object),address:$1.maybe($1.String),hash:$1.maybe($1.BufferN(20)),output:$1.maybe($1.BufferN(25)),pubkey:$1.maybe(SU.isPoint),signature:$1.maybe(NJ.isCanonicalScriptSignature),input:$1.maybe($1.Buffer)},J);let Z=M1.value(()=>{let D=TU.decode(J.address),F=D.readUInt8(0),K=D.slice(1);return{version:F,hash:K}}),G=M1.value(()=>{return NJ.decompile(J.input)}),U=J.network||n8.bitcoin,O={name:"p2pkh",network:U};if(M1.prop(O,"address",()=>{if(!O.hash)return;let D=Buffer.allocUnsafe(21);return D.writeUInt8(U.pubKeyHash,0),O.hash.copy(D,1),TU.encode(D)}),M1.prop(O,"hash",()=>{if(J.output)return J.output.slice(3,23);if(J.address)return Z().hash;if(J.pubkey||O.pubkey)return iQ.hash160(J.pubkey||O.pubkey)}),M1.prop(O,"output",()=>{if(!O.hash)return;return NJ.compile([g1.OP_DUP,g1.OP_HASH160,O.hash,g1.OP_EQUALVERIFY,g1.OP_CHECKSIG])}),M1.prop(O,"pubkey",()=>{if(!J.input)return;return G()[1]}),M1.prop(O,"signature",()=>{if(!J.input)return;return G()[0]}),M1.prop(O,"input",()=>{if(!J.pubkey)return;if(!J.signature)return;return NJ.compile([J.signature,J.pubkey])}),M1.prop(O,"witness",()=>{if(!O.input)return;return[]}),$.validate){let D=Buffer.from([]);if(J.address){if(Z().version!==U.pubKeyHash)throw new TypeError("Invalid version or Network mismatch");if(Z().hash.length!==20)throw new TypeError("Invalid address");D=Z().hash}if(J.hash)if(D.length>0&&!D.equals(J.hash))throw new TypeError("Hash mismatch");else D=J.hash;if(J.output){if(J.output.length!==25||J.output[0]!==g1.OP_DUP||J.output[1]!==g1.OP_HASH160||J.output[2]!==20||J.output[23]!==g1.OP_EQUALVERIFY||J.output[24]!==g1.OP_CHECKSIG)throw new TypeError("Output is invalid");let F=J.output.slice(3,23);if(D.length>0&&!D.equals(F))throw new TypeError("Hash mismatch");else D=F}if(J.pubkey){let F=iQ.hash160(J.pubkey);if(D.length>0&&!D.equals(F))throw new TypeError("Hash mismatch");else D=F}if(J.input){let F=G();if(F.length!==2)throw new TypeError("Input is invalid");if(!NJ.isCanonicalScriptSignature(F[0]))throw new TypeError("Input has invalid signature");if(!SU.isPoint(F[1]))throw new TypeError("Input has invalid pubkey");if(J.signature&&!J.signature.equals(F[0]))throw new TypeError("Signature mismatch");if(J.pubkey&&!J.pubkey.equals(F[1]))throw new TypeError("Pubkey mismatch");let K=iQ.hash160(F[1]);if(D.length>0&&!D.equals(K))throw new TypeError("Hash mismatch")}}return Object.assign(O,J)}IU.p2pkh=s8});var yU=x((wU)=>{Object.defineProperty(wU,"__esModule",{value:!0});var xU=D1(),i8=t0(),K1=R0(),L1=k1(),f0=l0(),t$=K1.OPS,gU=A$();function t8(J,$){if(J.length!==$.length)return!1;return J.every((Z,G)=>{return Z.equals($[G])})}function e8(J,$){if(!J.address&&!J.hash&&!J.output&&!J.redeem&&!J.input)throw new TypeError("Not enough data");$=Object.assign({validate:!0},$||{}),f0({network:f0.maybe(f0.Object),address:f0.maybe(f0.String),hash:f0.maybe(f0.BufferN(20)),output:f0.maybe(f0.BufferN(23)),redeem:f0.maybe({network:f0.maybe(f0.Object),output:f0.maybe(f0.Buffer),input:f0.maybe(f0.Buffer),witness:f0.maybe(f0.arrayOf(f0.Buffer))}),input:f0.maybe(f0.Buffer),witness:f0.maybe(f0.arrayOf(f0.Buffer))},J);let Z=J.network;if(!Z)Z=J.redeem&&J.redeem.network||i8.bitcoin;let G={network:Z},U=L1.value(()=>{let F=gU.decode(J.address),K=F.readUInt8(0),E=F.slice(1);return{version:K,hash:E}}),O=L1.value(()=>{return K1.decompile(J.input)}),D=L1.value(()=>{let F=O();return{network:Z,output:F[F.length-1],input:K1.compile(F.slice(0,-1)),witness:J.witness||[]}});if(L1.prop(G,"address",()=>{if(!G.hash)return;let F=Buffer.allocUnsafe(21);return F.writeUInt8(G.network.scriptHash,0),G.hash.copy(F,1),gU.encode(F)}),L1.prop(G,"hash",()=>{if(J.output)return J.output.slice(2,22);if(J.address)return U().hash;if(G.redeem&&G.redeem.output)return xU.hash160(G.redeem.output)}),L1.prop(G,"output",()=>{if(!G.hash)return;return K1.compile([t$.OP_HASH160,G.hash,t$.OP_EQUAL])}),L1.prop(G,"redeem",()=>{if(!J.input)return;return D()}),L1.prop(G,"input",()=>{if(!J.redeem||!J.redeem.input||!J.redeem.output)return;return K1.compile([].concat(K1.decompile(J.redeem.input),J.redeem.output))}),L1.prop(G,"witness",()=>{if(G.redeem&&G.redeem.witness)return G.redeem.witness;if(G.input)return[]}),L1.prop(G,"name",()=>{let F=["p2sh"];if(G.redeem!==void 0)F.push(G.redeem.name);return F.join("-")}),$.validate){let F=Buffer.from([]);if(J.address){if(U().version!==Z.scriptHash)throw new TypeError("Invalid version or Network mismatch");if(U().hash.length!==20)throw new TypeError("Invalid address");F=U().hash}if(J.hash)if(F.length>0&&!F.equals(J.hash))throw new TypeError("Hash mismatch");else F=J.hash;if(J.output){if(J.output.length!==23||J.output[0]!==t$.OP_HASH160||J.output[1]!==20||J.output[22]!==t$.OP_EQUAL)throw new TypeError("Output is invalid");let E=J.output.slice(2,22);if(F.length>0&&!F.equals(E))throw new TypeError("Hash mismatch");else F=E}let K=(E)=>{if(E.output){let R=K1.decompile(E.output);if(!R||R.length<1)throw new TypeError("Redeem.output too short");let C=xU.hash160(E.output);if(F.length>0&&!F.equals(C))throw new TypeError("Hash mismatch");else F=C}if(E.input){let R=E.input.length>0,C=E.witness&&E.witness.length>0;if(!R&&!C)throw new TypeError("Empty input");if(R&&C)throw new TypeError("Input and witness provided");if(R){let v=K1.decompile(E.input);if(!K1.isPushOnly(v))throw new TypeError("Non push-only scriptSig")}}};if(J.input){let E=O();if(!E||E.length<1)throw new TypeError("Input too short");if(!Buffer.isBuffer(D().output))throw new TypeError("Input is invalid");K(D())}if(J.redeem){if(J.redeem.network&&J.redeem.network!==Z)throw new TypeError("Network mismatch");if(J.input){let E=D();if(J.redeem.output&&!J.redeem.output.equals(E.output))throw new TypeError("Redeem.output mismatch");if(J.redeem.input&&!J.redeem.input.equals(E.input))throw new TypeError("Redeem.input mismatch")}K(J.redeem)}if(J.witness){if(J.redeem&&J.redeem.witness&&!t8(J.redeem.witness,J.witness))throw new TypeError("Witness and redeem.witness mismatch")}}return Object.assign(G,J)}wU.p2sh=e8});var QQ=x((p9,hU)=>{var JQ="qpzry9x8gf2tvdw0s3jn54khce6mua7l",tQ={};for(L$=0;L$<JQ.length;L$++){if(e$=JQ.charAt(L$),tQ[e$]!==void 0)throw new TypeError(e$+" is ambiguous");tQ[e$]=L$}var e$,L$;function _J(J){var $=J>>25;return(J&33554431)<<5^-($>>0&1)&996825010^-($>>1&1)&642813549^-($>>2&1)&513874426^-($>>3&1)&1027748829^-($>>4&1)&705979059}function fU(J){var $=1;for(var Z=0;Z<J.length;++Z){var G=J.charCodeAt(Z);if(G<33||G>126)return"Invalid prefix ("+J+")";$=_J($)^G>>5}$=_J($);for(Z=0;Z<J.length;++Z){var U=J.charCodeAt(Z);$=_J($)^U&31}return $}function $q(J,$,Z){if(Z=Z||90,J.length+7+$.length>Z)throw new TypeError("Exceeds length limit");J=J.toLowerCase();var G=fU(J);if(typeof G==="string")throw new Error(G);var U=J+"1";for(var O=0;O<$.length;++O){var D=$[O];if(D>>5!==0)throw new Error("Non 5-bit word");G=_J(G)^D,U+=JQ.charAt(D)}for(O=0;O<6;++O)G=_J(G);G^=1;for(O=0;O<6;++O){var F=G>>(5-O)*5&31;U+=JQ.charAt(F)}return U}function cU(J,$){if($=$||90,J.length<8)return J+" too short";if(J.length>$)return"Exceeds length limit";var Z=J.toLowerCase(),G=J.toUpperCase();if(J!==Z&&J!==G)return"Mixed-case string "+J;J=Z;var U=J.lastIndexOf("1");if(U===-1)return"No separator character for "+J;if(U===0)return"Missing prefix for "+J;var O=J.slice(0,U),D=J.slice(U+1);if(D.length<6)return"Data too short";var F=fU(O);if(typeof F==="string")return F;var K=[];for(var E=0;E<D.length;++E){var R=D.charAt(E),C=tQ[R];if(C===void 0)return"Unknown character "+R;if(F=_J(F)^C,E+6>=D.length)continue;K.push(C)}if(F!==1)return"Invalid checksum for "+J;return{prefix:O,words:K}}function Qq(){var J=cU.apply(null,arguments);if(typeof J==="object")return J}function Zq(J){var $=cU.apply(null,arguments);if(typeof $==="object")return $;throw new Error($)}function $Q(J,$,Z,G){var U=0,O=0,D=(1<<Z)-1,F=[];for(var K=0;K<J.length;++K){U=U<<$|J[K],O+=$;while(O>=Z)O-=Z,F.push(U>>O&D)}if(G){if(O>0)F.push(U<<Z-O&D)}else{if(O>=$)return"Excess padding";if(U<<Z-O&D)return"Non-zero padding"}return F}function Xq(J){var $=$Q(J,8,5,!0);if(Array.isArray($))return $}function Uq(J){var $=$Q(J,8,5,!0);if(Array.isArray($))return $;throw new Error($)}function Yq(J){var $=$Q(J,5,8,!1);if(Array.isArray($))return $}function Gq(J){var $=$Q(J,5,8,!1);if(Array.isArray($))return $;throw new Error($)}hU.exports={decodeUnsafe:Qq,decode:Zq,encode:$q,toWordsUnsafe:Xq,toWords:Uq,fromWordsUnsafe:Yq,fromWords:Gq}});var lU=x((dU)=>{Object.defineProperty(dU,"__esModule",{value:!0});var eQ=D1(),Vq=t0(),XQ=R0(),w1=k1(),n0=l0(),bU=XQ.OPS,JZ=z1(),ZQ=QQ(),Oq=Buffer.alloc(0);function Aq(J,$){if(!J.address&&!J.hash&&!J.output&&!J.pubkey&&!J.witness)throw new TypeError("Not enough data");$=Object.assign({validate:!0},$||{}),n0({address:n0.maybe(n0.String),hash:n0.maybe(n0.BufferN(20)),input:n0.maybe(n0.BufferN(0)),network:n0.maybe(n0.Object),output:n0.maybe(n0.BufferN(22)),pubkey:n0.maybe(JZ.isPoint),signature:n0.maybe(XQ.isCanonicalScriptSignature),witness:n0.maybe(n0.arrayOf(n0.Buffer))},J);let Z=w1.value(()=>{let O=ZQ.decode(J.address),D=O.words.shift(),F=ZQ.fromWords(O.words);return{version:D,prefix:O.prefix,data:Buffer.from(F)}}),G=J.network||Vq.bitcoin,U={name:"p2wpkh",network:G};if(w1.prop(U,"address",()=>{if(!U.hash)return;let O=ZQ.toWords(U.hash);return O.unshift(0),ZQ.encode(G.bech32,O)}),w1.prop(U,"hash",()=>{if(J.output)return J.output.slice(2,22);if(J.address)return Z().data;if(J.pubkey||U.pubkey)return eQ.hash160(J.pubkey||U.pubkey)}),w1.prop(U,"output",()=>{if(!U.hash)return;return XQ.compile([bU.OP_0,U.hash])}),w1.prop(U,"pubkey",()=>{if(J.pubkey)return J.pubkey;if(!J.witness)return;return J.witness[1]}),w1.prop(U,"signature",()=>{if(!J.witness)return;return J.witness[0]}),w1.prop(U,"input",()=>{if(!U.witness)return;return Oq}),w1.prop(U,"witness",()=>{if(!J.pubkey)return;if(!J.signature)return;return[J.signature,J.pubkey]}),$.validate){let O=Buffer.from([]);if(J.address){if(G&&G.bech32!==Z().prefix)throw new TypeError("Invalid prefix or Network mismatch");if(Z().version!==0)throw new TypeError("Invalid address version");if(Z().data.length!==20)throw new TypeError("Invalid address data");O=Z().data}if(J.hash)if(O.length>0&&!O.equals(J.hash))throw new TypeError("Hash mismatch");else O=J.hash;if(J.output){if(J.output.length!==22||J.output[0]!==bU.OP_0||J.output[1]!==20)throw new TypeError("Output is invalid");if(O.length>0&&!O.equals(J.output.slice(2)))throw new TypeError("Hash mismatch");else O=J.output.slice(2)}if(J.pubkey){let D=eQ.hash160(J.pubkey);if(O.length>0&&!O.equals(D))throw new TypeError("Hash mismatch");else O=D;if(!JZ.isPoint(J.pubkey)||J.pubkey.length!==33)throw new TypeError("Invalid pubkey for p2wpkh")}if(J.witness){if(J.witness.length!==2)throw new TypeError("Witness is invalid");if(!XQ.isCanonicalScriptSignature(J.witness[0]))throw new TypeError("Witness has invalid signature");if(!JZ.isPoint(J.witness[1])||J.witness[1].length!==33)throw new TypeError("Witness has invalid pubkey");if(J.signature&&!J.signature.equals(J.witness[0]))throw new TypeError("Signature mismatch");if(J.pubkey&&!J.pubkey.equals(J.witness[1]))throw new TypeError("Pubkey mismatch");let D=eQ.hash160(J.witness[1]);if(O.length>0&&!O.equals(D))throw new TypeError("Hash mismatch")}}return Object.assign(U,J)}dU.p2wpkh=Aq});var uU=x((pU)=>{Object.defineProperty(pU,"__esModule",{value:!0});var mU=D1(),zq=t0(),y1=R0(),E1=k1(),c0=l0(),oU=y1.OPS,Dq=z1(),UQ=QQ(),$Z=Buffer.alloc(0);function Lq(J,$){if(J.length!==$.length)return!1;return J.every((Z,G)=>{return Z.equals($[G])})}function YQ(J){if(Buffer.isBuffer(J)&&J.length===65&&J[0]===4&&Dq.isPoint(J))return!0;else return!1}function Wq(J,$){if(!J.address&&!J.hash&&!J.output&&!J.redeem&&!J.witness)throw new TypeError("Not enough data");$=Object.assign({validate:!0},$||{}),c0({network:c0.maybe(c0.Object),address:c0.maybe(c0.String),hash:c0.maybe(c0.BufferN(32)),output:c0.maybe(c0.BufferN(34)),redeem:c0.maybe({input:c0.maybe(c0.Buffer),network:c0.maybe(c0.Object),output:c0.maybe(c0.Buffer),witness:c0.maybe(c0.arrayOf(c0.Buffer))}),input:c0.maybe(c0.BufferN(0)),witness:c0.maybe(c0.arrayOf(c0.Buffer))},J);let Z=E1.value(()=>{let D=UQ.decode(J.address),F=D.words.shift(),K=UQ.fromWords(D.words);return{version:F,prefix:D.prefix,data:Buffer.from(K)}}),G=E1.value(()=>{return y1.decompile(J.redeem.input)}),U=J.network;if(!U)U=J.redeem&&J.redeem.network||zq.bitcoin;let O={network:U};if(E1.prop(O,"address",()=>{if(!O.hash)return;let D=UQ.toWords(O.hash);return D.unshift(0),UQ.encode(U.bech32,D)}),E1.prop(O,"hash",()=>{if(J.output)return J.output.slice(2);if(J.address)return Z().data;if(O.redeem&&O.redeem.output)return mU.sha256(O.redeem.output)}),E1.prop(O,"output",()=>{if(!O.hash)return;return y1.compile([oU.OP_0,O.hash])}),E1.prop(O,"redeem",()=>{if(!J.witness)return;return{output:J.witness[J.witness.length-1],input:$Z,witness:J.witness.slice(0,-1)}}),E1.prop(O,"input",()=>{if(!O.witness)return;return $Z}),E1.prop(O,"witness",()=>{if(J.redeem&&J.redeem.input&&J.redeem.input.length>0&&J.redeem.output&&J.redeem.output.length>0){let D=y1.toStack(G());return O.redeem=Object.assign({witness:D},J.redeem),O.redeem.input=$Z,[].concat(D,J.redeem.output)}if(!J.redeem)return;if(!J.redeem.output)return;if(!J.redeem.witness)return;return[].concat(J.redeem.witness,J.redeem.output)}),E1.prop(O,"name",()=>{let D=["p2wsh"];if(O.redeem!==void 0)D.push(O.redeem.name);return D.join("-")}),$.validate){let D=Buffer.from([]);if(J.address){if(Z().prefix!==U.bech32)throw new TypeError("Invalid prefix or Network mismatch");if(Z().version!==0)throw new TypeError("Invalid address version");if(Z().data.length!==32)throw new TypeError("Invalid address data");D=Z().data}if(J.hash)if(D.length>0&&!D.equals(J.hash))throw new TypeError("Hash mismatch");else D=J.hash;if(J.output){if(J.output.length!==34||J.output[0]!==oU.OP_0||J.output[1]!==32)throw new TypeError("Output is invalid");let F=J.output.slice(2);if(D.length>0&&!D.equals(F))throw new TypeError("Hash mismatch");else D=F}if(J.redeem){if(J.redeem.network&&J.redeem.network!==U)throw new TypeError("Network mismatch");if(J.redeem.input&&J.redeem.input.length>0&&J.redeem.witness&&J.redeem.witness.length>0)throw new TypeError("Ambiguous witness source");if(J.redeem.output){if(y1.decompile(J.redeem.output).length===0)throw new TypeError("Redeem.output is invalid");let F=mU.sha256(J.redeem.output);if(D.length>0&&!D.equals(F))throw new TypeError("Hash mismatch");else D=F}if(J.redeem.input&&!y1.isPushOnly(G()))throw new TypeError("Non push-only scriptSig");if(J.witness&&J.redeem.witness&&!Lq(J.witness,J.redeem.witness))throw new TypeError("Witness and redeem.witness mismatch");if(J.redeem.input&&G().some(YQ)||J.redeem.output&&(y1.decompile(J.redeem.output)||[]).some(YQ))throw new TypeError("redeem.input or redeem.output contains uncompressed pubkey")}if(J.witness&&J.witness.length>0){let F=J.witness[J.witness.length-1];if(J.redeem&&J.redeem.output&&!J.redeem.output.equals(F))throw new TypeError("Witness and redeem.output mismatch");if(J.witness.some(YQ)||(y1.decompile(F)||[]).some(YQ))throw new TypeError("Witness contains uncompressed pubkey")}}return Object.assign(O,J)}pU.p2wsh=Wq});var W$=x((rU)=>{Object.defineProperty(rU,"__esModule",{value:!0});var Fq=MU();rU.embed=Fq.p2data;var Mq=jU();rU.p2ms=Mq.p2ms;var Kq=PU();rU.p2pk=Kq.p2pk;var Eq=kU();rU.p2pkh=Eq.p2pkh;var Rq=yU();rU.p2sh=Rq.p2sh;var jq=lU();rU.p2wpkh=jq.p2wpkh;var Cq=uU();rU.p2wsh=Cq.p2wsh});var VQ=x((tU)=>{Object.defineProperty(tU,"__esModule",{value:!0});var nU=t0(),f1=W$(),Iq=R0(),QZ=Y1(),GQ=QQ(),sU=A$(),kq=l0();function aU(J){let $=sU.decode(J);if($.length<21)throw new TypeError(J+" is too short");if($.length>21)throw new TypeError(J+" is too long");let Z=$.readUInt8(0),G=$.slice(1);return{version:Z,hash:G}}tU.fromBase58Check=aU;function iU(J){let $=GQ.decode(J),Z=GQ.fromWords($.words.slice(1));return{version:$.words[0],prefix:$.prefix,data:Buffer.from(Z)}}tU.fromBech32=iU;function xq(J,$){kq(QZ.tuple(QZ.Hash160bit,QZ.UInt8),arguments);let Z=Buffer.allocUnsafe(21);return Z.writeUInt8($,0),J.copy(Z,1),sU.encode(Z)}tU.toBase58Check=xq;function gq(J,$,Z){let G=GQ.toWords(J);return G.unshift($),GQ.encode(Z,G)}tU.toBech32=gq;function wq(J,$){$=$||nU.bitcoin;try{return f1.p2pkh({output:J,network:$}).address}catch(Z){}try{return f1.p2sh({output:J,network:$}).address}catch(Z){}try{return f1.p2wpkh({output:J,network:$}).address}catch(Z){}try{return f1.p2wsh({output:J,network:$}).address}catch(Z){}throw new Error(Iq.toASM(J)+" has no matching Address")}tU.fromOutputScript=wq;function yq(J,$){$=$||nU.bitcoin;let Z,G;try{Z=aU(J)}catch(U){}if(Z){if(Z.version===$.pubKeyHash)return f1.p2pkh({hash:Z.hash}).output;if(Z.version===$.scriptHash)return f1.p2sh({hash:Z.hash}).output}else{try{G=iU(J)}catch(U){}if(G){if(G.prefix!==$.bech32)throw new Error(J+" has an invalid prefix");if(G.version===0){if(G.data.length===20)return f1.p2wpkh({hash:G.data}).output;if(G.data.length===32)return f1.p2wsh({hash:G.data}).output}}}throw new Error(J+" has no matching Script")}tU.toOutputScript=yq});var OQ=x(($Y)=>{Object.defineProperty($Y,"__esModule",{value:!0});var eU=t0(),OJ=Y1(),R1=z1(),oq=mq(),c1=l0(),JY=CX(),ZZ=c1.maybe(c1.compile({compressed:OJ.maybe(OJ.Boolean),network:OJ.maybe(OJ.Network)}));class XZ{constructor(J,$,Z){if(this.__D=J,this.__Q=$,this.lowR=!1,Z===void 0)Z={};if(this.compressed=Z.compressed===void 0?!0:Z.compressed,this.network=Z.network||eU.bitcoin,$!==void 0)this.__Q=R1.pointCompress($,this.compressed)}get privateKey(){return this.__D}get publicKey(){if(!this.__Q)this.__Q=R1.pointFromScalar(this.__D,this.compressed);return this.__Q}toWIF(){if(!this.__D)throw new Error("Missing private key");return JY.encode(this.network.wif,this.__D,this.compressed)}sign(J,$){if(!this.__D)throw new Error("Missing private key");if($===void 0)$=this.lowR;if($===!1)return R1.sign(J,this.__D);else{let Z=R1.sign(J,this.__D),G=Buffer.alloc(32,0),U=0;while(Z[0]>127)U++,G.writeUIntLE(U,0,6),Z=R1.signWithEntropy(J,this.__D,G);return Z}}verify(J,$){return R1.verify(J,this.publicKey,$)}}function UZ(J,$){if(c1(OJ.Buffer256bit,J),!R1.isPrivate(J))throw new TypeError("Private key not in range [1, n)");return c1(ZZ,$),new XZ(J,void 0,$)}$Y.fromPrivateKey=UZ;function pq(J,$){return c1(R1.isPoint,J),c1(ZZ,$),new XZ(void 0,J,$)}$Y.fromPublicKey=pq;function uq(J,$){let Z=JY.decode(J),G=Z.version;if(OJ.Array($)){if($=$.filter((U)=>{return G===U.wif}).pop(),!$)throw new Error("Unknown network version")}else if($=$||eU.bitcoin,G!==$.wif)throw new Error("Invalid network version");return UZ(Z.privateKey,{compressed:Z.compressed,network:$})}$Y.fromWIF=uq;function rq(J){if(c1(ZZ,J),J===void 0)J={};let $=J.rng||oq,Z;do Z=$(32),c1(OJ.Buffer256bit,Z);while(!R1.isPrivate(Z));return UZ(Z,J)}$Y.makeRandom=rq});var H$=x((VY)=>{Object.defineProperty(VY,"__esModule",{value:!0});var PJ=Y1(),QY=l0(),AQ=qQ();function ZY(J,$){if(typeof J!=="number")throw new Error("cannot write a non-number as a number");if(J<0)throw new Error("specified a negative value for writing an unsigned value");if(J>$)throw new Error("RangeError: value out of range");if(Math.floor(J)!==J)throw new Error("value has a fractional component")}function XY(J,$){let Z=J.readUInt32LE($),G=J.readUInt32LE($+4);return G*=4294967296,ZY(G+Z,9007199254740991),G+Z}VY.readUInt64LE=XY;function UY(J,$,Z){return ZY($,9007199254740991),J.writeInt32LE($&-1,Z),J.writeUInt32LE(Math.floor($/4294967296),Z+4),Z+8}VY.writeUInt64LE=UY;function tq(J){if(J.length<1)return J;let $=J.length-1,Z=0;for(let G=0;G<J.length/2;G++)Z=J[G],J[G]=J[$],J[$]=Z,$--;return J}VY.reverseBuffer=tq;function eq(J){let $=Buffer.allocUnsafe(J.length);return J.copy($),$}VY.cloneBuffer=eq;class YY{constructor(J,$=0){this.buffer=J,this.offset=$,QY(PJ.tuple(PJ.Buffer,PJ.UInt32),[J,$])}writeUInt8(J){this.offset=this.buffer.writeUInt8(J,this.offset)}writeInt32(J){this.offset=this.buffer.writeInt32LE(J,this.offset)}writeUInt32(J){this.offset=this.buffer.writeUInt32LE(J,this.offset)}writeUInt64(J){this.offset=UY(this.buffer,J,this.offset)}writeVarInt(J){AQ.encode(J,this.buffer,this.offset),this.offset+=AQ.encode.bytes}writeSlice(J){if(this.buffer.length<this.offset+J.length)throw new Error("Cannot write slice out of bounds");this.offset+=J.copy(this.buffer,this.offset)}writeVarSlice(J){this.writeVarInt(J.length),this.writeSlice(J)}writeVector(J){this.writeVarInt(J.length),J.forEach(($)=>this.writeVarSlice($))}}VY.BufferWriter=YY;class GY{constructor(J,$=0){this.buffer=J,this.offset=$,QY(PJ.tuple(PJ.Buffer,PJ.UInt32),[J,$])}readUInt8(){let J=this.buffer.readUInt8(this.offset);return this.offset++,J}readInt32(){let J=this.buffer.readInt32LE(this.offset);return this.offset+=4,J}readUInt32(){let J=this.buffer.readUInt32LE(this.offset);return this.offset+=4,J}readUInt64(){let J=XY(this.buffer,this.offset);return this.offset+=8,J}readVarInt(){let J=AQ.decode(this.buffer,this.offset);return this.offset+=AQ.decode.bytes,J}readSlice(J){if(this.buffer.length<this.offset+J)throw new Error("Cannot read slice out of bounds");let $=this.buffer.slice(this.offset,this.offset+J);return this.offset+=J,$}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){let J=this.readVarInt(),$=[];for(let Z=0;Z<J;Z++)$.push(this.readVarSlice());return $}}VY.BufferReader=GY});var F$=x((zY)=>{Object.defineProperty(zY,"__esModule",{value:!0});var h1=H$(),AJ=D1(),OY=R0(),Y5=R0(),x0=Y1(),qJ=l0(),zQ=qQ();function BJ(J){let $=J.length;return zQ.encodingLength($)+$}function G5(J){let $=J.length;return zQ.encodingLength($)+J.reduce((Z,G)=>{return Z+BJ(G)},0)}var GZ=Buffer.allocUnsafe(0),AY=[],YZ=Buffer.from("0000000000000000000000000000000000000000000000000000000000000000","hex"),qY=Buffer.from("0000000000000000000000000000000000000000000000000000000000000001","hex"),V5=Buffer.from("ffffffffffffffff","hex"),O5={script:GZ,valueBuffer:V5};function A5(J){return J.value!==void 0}class I0{constructor(){this.version=1,this.locktime=0,this.ins=[],this.outs=[]}static fromBuffer(J,$){let Z=new h1.BufferReader(J),G=new I0;G.version=Z.readInt32();let U=Z.readUInt8(),O=Z.readUInt8(),D=!1;if(U===I0.ADVANCED_TRANSACTION_MARKER&&O===I0.ADVANCED_TRANSACTION_FLAG)D=!0;else Z.offset-=2;let F=Z.readVarInt();for(let E=0;E<F;++E)G.ins.push({hash:Z.readSlice(32),index:Z.readUInt32(),script:Z.readVarSlice(),sequence:Z.readUInt32(),witness:AY});let K=Z.readVarInt();for(let E=0;E<K;++E)G.outs.push({value:Z.readUInt64(),script:Z.readVarSlice()});if(D){for(let E=0;E<F;++E)G.ins[E].witness=Z.readVector();if(!G.hasWitnesses())throw new Error("Transaction has superfluous witness data")}if(G.locktime=Z.readUInt32(),$)return G;if(Z.offset!==J.length)throw new Error("Transaction has unexpected data");return G}static fromHex(J){return I0.fromBuffer(Buffer.from(J,"hex"),!1)}static isCoinbaseHash(J){qJ(x0.Hash256bit,J);for(let $=0;$<32;++$)if(J[$]!==0)return!1;return!0}isCoinbase(){return this.ins.length===1&&I0.isCoinbaseHash(this.ins[0].hash)}addInput(J,$,Z,G){if(qJ(x0.tuple(x0.Hash256bit,x0.UInt32,x0.maybe(x0.UInt32),x0.maybe(x0.Buffer)),arguments),x0.Null(Z))Z=I0.DEFAULT_SEQUENCE;return this.ins.push({hash:J,index:$,script:G||GZ,sequence:Z,witness:AY})-1}addOutput(J,$){return qJ(x0.tuple(x0.Buffer,x0.Satoshi),arguments),this.outs.push({script:J,value:$})-1}hasWitnesses(){return this.ins.some((J)=>{return J.witness.length!==0})}weight(){let J=this.byteLength(!1),$=this.byteLength(!0);return J*3+$}virtualSize(){return Math.ceil(this.weight()/4)}byteLength(J=!0){let $=J&&this.hasWitnesses();return($?10:8)+zQ.encodingLength(this.ins.length)+zQ.encodingLength(this.outs.length)+this.ins.reduce((Z,G)=>{return Z+40+BJ(G.script)},0)+this.outs.reduce((Z,G)=>{return Z+8+BJ(G.script)},0)+($?this.ins.reduce((Z,G)=>{return Z+G5(G.witness)},0):0)}clone(){let J=new I0;return J.version=this.version,J.locktime=this.locktime,J.ins=this.ins.map(($)=>{return{hash:$.hash,index:$.index,script:$.script,sequence:$.sequence,witness:$.witness}}),J.outs=this.outs.map(($)=>{return{script:$.script,value:$.value}}),J}hashForSignature(J,$,Z){if(qJ(x0.tuple(x0.UInt32,x0.Buffer,x0.Number),arguments),J>=this.ins.length)return qY;let G=OY.compile(OY.decompile($).filter((D)=>{return D!==Y5.OPS.OP_CODESEPARATOR})),U=this.clone();if((Z&31)===I0.SIGHASH_NONE)U.outs=[],U.ins.forEach((D,F)=>{if(F===J)return;D.sequence=0});else if((Z&31)===I0.SIGHASH_SINGLE){if(J>=this.outs.length)return qY;U.outs.length=J+1;for(let D=0;D<J;D++)U.outs[D]=O5;U.ins.forEach((D,F)=>{if(F===J)return;D.sequence=0})}if(Z&I0.SIGHASH_ANYONECANPAY)U.ins=[U.ins[J]],U.ins[0].script=G;else U.ins.forEach((D)=>{D.script=GZ}),U.ins[J].script=G;let O=Buffer.allocUnsafe(U.byteLength(!1)+4);return O.writeInt32LE(Z,O.length-4),U.__toBuffer(O,0,!1),AJ.hash256(O)}hashForWitnessV0(J,$,Z,G){qJ(x0.tuple(x0.UInt32,x0.Buffer,x0.Satoshi,x0.UInt32),arguments);let U=Buffer.from([]),O,D=YZ,F=YZ,K=YZ;if(!(G&I0.SIGHASH_ANYONECANPAY))U=Buffer.allocUnsafe(36*this.ins.length),O=new h1.BufferWriter(U,0),this.ins.forEach((R)=>{O.writeSlice(R.hash),O.writeUInt32(R.index)}),F=AJ.hash256(U);if(!(G&I0.SIGHASH_ANYONECANPAY)&&(G&31)!==I0.SIGHASH_SINGLE&&(G&31)!==I0.SIGHASH_NONE)U=Buffer.allocUnsafe(4*this.ins.length),O=new h1.BufferWriter(U,0),this.ins.forEach((R)=>{O.writeUInt32(R.sequence)}),K=AJ.hash256(U);if((G&31)!==I0.SIGHASH_SINGLE&&(G&31)!==I0.SIGHASH_NONE){let R=this.outs.reduce((C,v)=>{return C+8+BJ(v.script)},0);U=Buffer.allocUnsafe(R),O=new h1.BufferWriter(U,0),this.outs.forEach((C)=>{O.writeUInt64(C.value),O.writeVarSlice(C.script)}),D=AJ.hash256(U)}else if((G&31)===I0.SIGHASH_SINGLE&&J<this.outs.length){let R=this.outs[J];U=Buffer.allocUnsafe(8+BJ(R.script)),O=new h1.BufferWriter(U,0),O.writeUInt64(R.value),O.writeVarSlice(R.script),D=AJ.hash256(U)}U=Buffer.allocUnsafe(156+BJ($)),O=new h1.BufferWriter(U,0);let E=this.ins[J];return O.writeUInt32(this.version),O.writeSlice(F),O.writeSlice(K),O.writeSlice(E.hash),O.writeUInt32(E.index),O.writeVarSlice($),O.writeUInt64(Z),O.writeUInt32(E.sequence),O.writeSlice(D),O.writeUInt32(this.locktime),O.writeUInt32(G),AJ.hash256(U)}getHash(J){if(J&&this.isCoinbase())return Buffer.alloc(32,0);return AJ.hash256(this.__toBuffer(void 0,void 0,J))}getId(){return h1.reverseBuffer(this.getHash(!1)).toString("hex")}toBuffer(J,$){return this.__toBuffer(J,$,!0)}toHex(){return this.toBuffer(void 0,void 0).toString("hex")}setInputScript(J,$){qJ(x0.tuple(x0.Number,x0.Buffer),arguments),this.ins[J].script=$}setWitness(J,$){qJ(x0.tuple(x0.Number,[x0.Buffer]),arguments),this.ins[J].witness=$}__toBuffer(J,$,Z=!1){if(!J)J=Buffer.allocUnsafe(this.byteLength(Z));let G=new h1.BufferWriter(J,$||0);G.writeInt32(this.version);let U=Z&&this.hasWitnesses();if(U)G.writeUInt8(I0.ADVANCED_TRANSACTION_MARKER),G.writeUInt8(I0.ADVANCED_TRANSACTION_FLAG);if(G.writeVarInt(this.ins.length),this.ins.forEach((O)=>{G.writeSlice(O.hash),G.writeUInt32(O.index),G.writeVarSlice(O.script),G.writeUInt32(O.sequence)}),G.writeVarInt(this.outs.length),this.outs.forEach((O)=>{if(A5(O))G.writeUInt64(O.value);else G.writeSlice(O.valueBuffer);G.writeVarSlice(O.script)}),U)this.ins.forEach((O)=>{G.writeVector(O.witness)});if(G.writeUInt32(this.locktime),$!==void 0)return J.slice($,G.offset);return J}}I0.DEFAULT_SEQUENCE=4294967295;I0.SIGHASH_ALL=1;I0.SIGHASH_NONE=2;I0.SIGHASH_SINGLE=3;I0.SIGHASH_ANYONECANPAY=128;I0.ADVANCED_TRANSACTION_MARKER=0;I0.ADVANCED_TRANSACTION_FLAG=1;zY.Transaction=I0});var HY=x((WY)=>{Object.defineProperty(WY,"__esModule",{value:!0});var DQ=H$(),VZ=D1(),D5=F$(),L5=Y1(),W5=z5(),H5=l0(),OZ=qQ(),AZ=new TypeError("Cannot compute merkle root for zero transactions"),DY=new TypeError("Cannot compute witness commit for non-segwit block");class zJ{constructor(){this.version=1,this.prevHash=void 0,this.merkleRoot=void 0,this.timestamp=0,this.witnessCommit=void 0,this.bits=0,this.nonce=0,this.transactions=void 0}static fromBuffer(J){if(J.length<80)throw new Error("Buffer too small (< 80 bytes)");let $=new DQ.BufferReader(J),Z=new zJ;if(Z.version=$.readInt32(),Z.prevHash=$.readSlice(32),Z.merkleRoot=$.readSlice(32),Z.timestamp=$.readUInt32(),Z.bits=$.readUInt32(),Z.nonce=$.readUInt32(),J.length===80)return Z;let G=()=>{let D=D5.Transaction.fromBuffer($.buffer.slice($.offset),!0);return $.offset+=D.byteLength(),D},U=$.readVarInt();Z.transactions=[];for(let D=0;D<U;++D){let F=G();Z.transactions.push(F)}let O=Z.getWitnessCommit();if(O)Z.witnessCommit=O;return Z}static fromHex(J){return zJ.fromBuffer(Buffer.from(J,"hex"))}static calculateTarget(J){let $=((J&4278190080)>>24)-3,Z=J&8388607,G=Buffer.alloc(32,0);return G.writeUIntBE(Z,29-$,3),G}static calculateMerkleRoot(J,$){if(H5([{getHash:L5.Function}],J),J.length===0)throw AZ;if($&&!LY(J))throw DY;let Z=J.map((U)=>U.getHash($)),G=W5(Z,VZ.hash256);return $?VZ.hash256(Buffer.concat([G,J[0].ins[0].witness[0]])):G}getWitnessCommit(){if(!LY(this.transactions))return null;let J=this.transactions[0].outs.filter((Z)=>Z.script.slice(0,6).equals(Buffer.from("6a24aa21a9ed","hex"))).map((Z)=>Z.script.slice(6,38));if(J.length===0)return null;let $=J[J.length-1];if(!($ instanceof Buffer&&$.length===32))return null;return $}hasWitnessCommit(){if(this.witnessCommit instanceof Buffer&&this.witnessCommit.length===32)return!0;if(this.getWitnessCommit()!==null)return!0;return!1}hasWitness(){return F5(this.transactions)}weight(){let J=this.byteLength(!1,!1),$=this.byteLength(!1,!0);return J*3+$}byteLength(J,$=!0){if(J||!this.transactions)return 80;return 80+OZ.encodingLength(this.transactions.length)+this.transactions.reduce((Z,G)=>Z+G.byteLength($),0)}getHash(){return VZ.hash256(this.toBuffer(!0))}getId(){return DQ.reverseBuffer(this.getHash()).toString("hex")}getUTCDate(){let J=new Date(0);return J.setUTCSeconds(this.timestamp),J}toBuffer(J){let $=Buffer.allocUnsafe(this.byteLength(J)),Z=new DQ.BufferWriter($);if(Z.writeInt32(this.version),Z.writeSlice(this.prevHash),Z.writeSlice(this.merkleRoot),Z.writeUInt32(this.timestamp),Z.writeUInt32(this.bits),Z.writeUInt32(this.nonce),J||!this.transactions)return $;return OZ.encode(this.transactions.length,$,Z.offset),Z.offset+=OZ.encode.bytes,this.transactions.forEach((G)=>{let U=G.byteLength();G.toBuffer($,Z.offset),Z.offset+=U}),$}toHex(J){return this.toBuffer(J).toString("hex")}checkTxRoots(){let J=this.hasWitnessCommit();if(!J&&this.hasWitness())return!1;return this.__checkMerkleRoot()&&(J?this.__checkWitnessCommit():!0)}checkProofOfWork(){let J=DQ.reverseBuffer(this.getHash()),$=zJ.calculateTarget(this.bits);return J.compare($)<=0}__checkMerkleRoot(){if(!this.transactions)throw AZ;let J=zJ.calculateMerkleRoot(this.transactions);return this.merkleRoot.compare(J)===0}__checkWitnessCommit(){if(!this.transactions)throw AZ;if(!this.hasWitnessCommit())throw DY;let J=zJ.calculateMerkleRoot(this.transactions,!0);return this.witnessCommit.compare(J)===0}}WY.Block=zJ;function LY(J){return J instanceof Array&&J[0]&&J[0].ins&&J[0].ins instanceof Array&&J[0].ins[0]&&J[0].ins[0].witness&&J[0].ins[0].witness instanceof Array&&J[0].ins[0].witness.length>0}function F5(J){return J instanceof Array&&J.some(($)=>typeof $==="object"&&$.ins instanceof Array&&$.ins.some((Z)=>typeof Z==="object"&&Z.witness instanceof Array&&Z.witness.length>0))}});var dY=x((bY)=>{Object.defineProperty(bY,"__esModule",{value:!0});var FY=R5(),WQ=K5(),W1=E5(),MY=VQ(),HQ=H$(),j5=D1(),vY=OQ(),C5=t0(),r0=W$(),s0=R0(),m0=F$(),N5={network:C5.bitcoin,maximumFeeRate:5000};class FQ{constructor(J={},$=new FY.Psbt(new DZ)){if(this.data=$,this.opts=Object.assign({},N5,J),this.__CACHE={__NON_WITNESS_UTXO_TX_CACHE:[],__NON_WITNESS_UTXO_BUF_CACHE:[],__TX_IN_CACHE:{},__TX:this.data.globalMap.unsignedTx.tx,__UNSAFE_SIGN_NONSEGWIT:!1},this.data.inputs.length===0)this.setVersion(2);let Z=(G,U,O,D)=>Object.defineProperty(G,U,{enumerable:O,writable:D});Z(this,"__CACHE",!1,!0),Z(this,"opts",!1,!0)}static fromBase64(J,$={}){let Z=Buffer.from(J,"base64");return this.fromBuffer(Z,$)}static fromHex(J,$={}){let Z=Buffer.from(J,"hex");return this.fromBuffer(Z,$)}static fromBuffer(J,$={}){let Z=FY.Psbt.fromBuffer(J,_5),G=new FQ($,Z);return x5(G.__CACHE.__TX,G.__CACHE),G}get inputCount(){return this.data.inputs.length}get version(){return this.__CACHE.__TX.version}set version(J){this.setVersion(J)}get locktime(){return this.__CACHE.__TX.locktime}set locktime(J){this.setLocktime(J)}get txInputs(){return this.__CACHE.__TX.ins.map((J)=>({hash:HQ.cloneBuffer(J.hash),index:J.index,sequence:J.sequence}))}get txOutputs(){return this.__CACHE.__TX.outs.map((J)=>{let $;try{$=MY.fromOutputScript(J.script,this.opts.network)}catch(Z){}return{script:HQ.cloneBuffer(J.script),value:J.value,address:$}})}combine(...J){return this.data.combine(...J.map(($)=>$.data)),this}clone(){let J=FQ.fromBuffer(this.data.toBuffer());return J.opts=JSON.parse(JSON.stringify(this.opts)),J}setMaximumFeeRate(J){LQ(J),this.opts.maximumFeeRate=J}setVersion(J){LQ(J),M$(this.data.inputs,"setVersion");let $=this.__CACHE;return $.__TX.version=J,$.__EXTRACTED_TX=void 0,this}setLocktime(J){LQ(J),M$(this.data.inputs,"setLocktime");let $=this.__CACHE;return $.__TX.locktime=J,$.__EXTRACTED_TX=void 0,this}setInputSequence(J,$){LQ($),M$(this.data.inputs,"setInputSequence");let Z=this.__CACHE;if(Z.__TX.ins.length<=J)throw new Error("Input index too high");return Z.__TX.ins[J].sequence=$,Z.__EXTRACTED_TX=void 0,this}addInputs(J){return J.forEach(($)=>this.addInput($)),this}addInput(J){if(arguments.length>1||!J||J.hash===void 0||J.index===void 0)throw new Error("Invalid arguments for Psbt.addInput. Requires single object with at least [hash] and [index]");if(M$(this.data.inputs,"addInput"),J.witnessScript)MQ(J.witnessScript);let $=this.__CACHE;this.data.addInput(J);let Z=$.__TX.ins[$.__TX.ins.length-1];kY($,Z);let G=this.data.inputs.length-1,U=this.data.inputs[G];if(U.nonWitnessUtxo)zZ(this.__CACHE,U,G);return $.__FEE=void 0,$.__FEE_RATE=void 0,$.__EXTRACTED_TX=void 0,this}addOutputs(J){return J.forEach(($)=>this.addOutput($)),this}addOutput(J){if(arguments.length>1||!J||J.value===void 0||J.address===void 0&&J.script===void 0)throw new Error("Invalid arguments for Psbt.addOutput. Requires single object with at least [script or address] and [value]");M$(this.data.inputs,"addOutput");let{address:$}=J;if(typeof $==="string"){let{network:G}=this.opts,U=MY.toOutputScript($,G);J=Object.assign(J,{script:U})}let Z=this.__CACHE;return this.data.addOutput(J),Z.__FEE=void 0,Z.__FEE_RATE=void 0,Z.__EXTRACTED_TX=void 0,this}extractTransaction(J){if(!this.data.inputs.every(SY))throw new Error("Not finalized");let $=this.__CACHE;if(!J)T5(this,$,this.opts);if($.__EXTRACTED_TX)return $.__EXTRACTED_TX;let Z=$.__TX.clone();return yY(this.data.inputs,Z,$,!0),Z}getFeeRate(){return NY("__FEE_RATE","fee rate",this.data.inputs,this.__CACHE)}getFee(){return NY("__FEE","fee",this.data.inputs,this.__CACHE)}finalizeAllInputs(){return W1.checkForInput(this.data.inputs,0),K$(this.data.inputs.length).forEach((J)=>this.finalizeInput(J)),this}finalizeInput(J,$=g5){let Z=W1.checkForInput(this.data.inputs,J),{script:G,isP2SH:U,isP2WSH:O,isSegwit:D}=c5(J,Z,this.__CACHE);if(!G)throw new Error(`No script found for input #${J}`);I5(Z);let{finalScriptSig:F,finalScriptWitness:K}=$(J,Z,G,D,U,O);if(F)this.data.updateInput(J,{finalScriptSig:F});if(K)this.data.updateInput(J,{finalScriptWitness:K});if(!F&&!K)throw new Error(`Unknown error finalizing input #${J}`);return this.data.clearFinalizedInput(J),this}getInputType(J){let $=W1.checkForInput(this.data.inputs,J),Z=fY(J,$,this.__CACHE),G=RQ(Z,J,"input",$.redeemScript||m5($.finalScriptSig),$.witnessScript||o5($.finalScriptWitness)),U=G.type==="raw"?"":G.type+"-",O=hY(G.meaningfulScript);return U+O}inputHasPubkey(J,$){let Z=W1.checkForInput(this.data.inputs,J);return d5($,Z,J,this.__CACHE)}inputHasHDKey(J,$){let Z=W1.checkForInput(this.data.inputs,J),G=RY($);return!!Z.bip32Derivation&&Z.bip32Derivation.some(G)}outputHasPubkey(J,$){let Z=W1.checkForOutput(this.data.outputs,J);return l5($,Z,J,this.__CACHE)}outputHasHDKey(J,$){let Z=W1.checkForOutput(this.data.outputs,J),G=RY($);return!!Z.bip32Derivation&&Z.bip32Derivation.some(G)}validateSignaturesOfAllInputs(){return W1.checkForInput(this.data.inputs,0),K$(this.data.inputs.length).map(($)=>this.validateSignaturesOfInput($)).reduce(($,Z)=>Z===!0&&$,!0)}validateSignaturesOfInput(J,$){let Z=this.data.inputs[J],G=(Z||{}).partialSig;if(!Z||!G||G.length<1)throw new Error("No signatures to validate");let U=$?G.filter((E)=>E.pubkey.equals($)):G;if(U.length<1)throw new Error("No signatures for this pubkey");let O=[],D,F,K;for(let E of U){let R=s0.signature.decode(E.signature),{hash:C,script:v}=K!==R.hashType?gY(J,Object.assign({},Z,{sighashType:R.hashType}),this.__CACHE,!0):{hash:D,script:F};K=R.hashType,D=C,F=v,IY(E.pubkey,v,"verify");let c=vY.fromPublicKey(E.pubkey);O.push(c.verify(C,R.signature))}return O.every((E)=>E===!0)}signAllInputsHD(J,$=[m0.Transaction.SIGHASH_ALL]){if(!J||!J.publicKey||!J.fingerprint)throw new Error("Need HDSigner to sign input");let Z=[];for(let G of K$(this.data.inputs.length))try{this.signInputHD(G,J,$),Z.push(!0)}catch(U){Z.push(!1)}if(Z.every((G)=>G===!1))throw new Error("No inputs were signed");return this}signAllInputsHDAsync(J,$=[m0.Transaction.SIGHASH_ALL]){return new Promise((Z,G)=>{if(!J||!J.publicKey||!J.fingerprint)return G(new Error("Need HDSigner to sign input"));let U=[],O=[];for(let D of K$(this.data.inputs.length))O.push(this.signInputHDAsync(D,J,$).then(()=>{U.push(!0)},()=>{U.push(!1)}));return Promise.all(O).then(()=>{if(U.every((D)=>D===!1))return G(new Error("No inputs were signed"));Z()})})}signInputHD(J,$,Z=[m0.Transaction.SIGHASH_ALL]){if(!$||!$.publicKey||!$.fingerprint)throw new Error("Need HDSigner to sign input");return PY(J,this.data.inputs,$).forEach((U)=>this.signInput(J,U,Z)),this}signInputHDAsync(J,$,Z=[m0.Transaction.SIGHASH_ALL]){return new Promise((G,U)=>{if(!$||!$.publicKey||!$.fingerprint)return U(new Error("Need HDSigner to sign input"));let D=PY(J,this.data.inputs,$).map((F)=>this.signInputAsync(J,F,Z));return Promise.all(D).then(()=>{G()}).catch(U)})}signAllInputs(J,$=[m0.Transaction.SIGHASH_ALL]){if(!J||!J.publicKey)throw new Error("Need Signer to sign input");let Z=[];for(let G of K$(this.data.inputs.length))try{this.signInput(G,J,$),Z.push(!0)}catch(U){Z.push(!1)}if(Z.every((G)=>G===!1))throw new Error("No inputs were signed");return this}signAllInputsAsync(J,$=[m0.Transaction.SIGHASH_ALL]){return new Promise((Z,G)=>{if(!J||!J.publicKey)return G(new Error("Need Signer to sign input"));let U=[],O=[];for(let[D]of this.data.inputs.entries())O.push(this.signInputAsync(D,J,$).then(()=>{U.push(!0)},()=>{U.push(!1)}));return Promise.all(O).then(()=>{if(U.every((D)=>D===!1))return G(new Error("No inputs were signed"));Z()})})}signInput(J,$,Z=[m0.Transaction.SIGHASH_ALL]){if(!$||!$.publicKey)throw new Error("Need Signer to sign input");let{hash:G,sighashType:U}=_Y(this.data.inputs,J,$.publicKey,this.__CACHE,Z),O=[{pubkey:$.publicKey,signature:s0.signature.encode($.sign(G),U)}];return this.data.updateInput(J,{partialSig:O}),this}signInputAsync(J,$,Z=[m0.Transaction.SIGHASH_ALL]){return Promise.resolve().then(()=>{if(!$||!$.publicKey)throw new Error("Need Signer to sign input");let{hash:G,sighashType:U}=_Y(this.data.inputs,J,$.publicKey,this.__CACHE,Z);return Promise.resolve($.sign(G)).then((O)=>{let D=[{pubkey:$.publicKey,signature:s0.signature.encode(O,U)}];this.data.updateInput(J,{partialSig:D})})})}toBuffer(){return qZ(this.__CACHE),this.data.toBuffer()}toHex(){return qZ(this.__CACHE),this.data.toHex()}toBase64(){return qZ(this.__CACHE),this.data.toBase64()}updateGlobal(J){return this.data.updateGlobal(J),this}updateInput(J,$){if($.witnessScript)MQ($.witnessScript);if(this.data.updateInput(J,$),$.nonWitnessUtxo)zZ(this.__CACHE,this.data.inputs[J],J);return this}updateOutput(J,$){return this.data.updateOutput(J,$),this}addUnknownKeyValToGlobal(J){return this.data.addUnknownKeyValToGlobal(J),this}addUnknownKeyValToInput(J,$){return this.data.addUnknownKeyValToInput(J,$),this}addUnknownKeyValToOutput(J,$){return this.data.addUnknownKeyValToOutput(J,$),this}clearFinalizedInput(J){return this.data.clearFinalizedInput(J),this}}bY.Psbt=FQ;var _5=(J)=>new DZ(J);class DZ{constructor(J=Buffer.from([2,0,0,0,0,0,0,0,0,0])){this.tx=m0.Transaction.fromBuffer(J),k5(this.tx),Object.defineProperty(this,"tx",{enumerable:!1,writable:!0})}getInputOutputCounts(){return{inputCount:this.tx.ins.length,outputCount:this.tx.outs.length}}addInput(J){if(J.hash===void 0||J.index===void 0||!Buffer.isBuffer(J.hash)&&typeof J.hash!=="string"||typeof J.index!=="number")throw new Error("Error adding input.");let $=typeof J.hash==="string"?HQ.reverseBuffer(Buffer.from(J.hash,"hex")):J.hash;this.tx.addInput($,J.index,J.sequence)}addOutput(J){if(J.script===void 0||J.value===void 0||!Buffer.isBuffer(J.script)||typeof J.value!=="number")throw new Error("Error adding output.");this.tx.addOutput(J.script,J.value)}toBuffer(){return this.tx.toBuffer()}}function P5(J,$,Z){switch(Z){case"pubkey":case"pubkeyhash":case"witnesspubkeyhash":return KY(1,J.partialSig);case"multisig":let G=r0.p2ms({output:$});return KY(G.m,J.partialSig,G.pubkeys);default:return!1}}function qZ(J){if(J.__UNSAFE_SIGN_NONSEGWIT!==!1)throw new Error("Not BIP174 compliant, can not export")}function KY(J,$,Z){if(!$)return!1;let G;if(Z)G=Z.map((U)=>{let O=vY.fromPublicKey(U,{compressed:!0}).publicKey;return $.find((D)=>D.pubkey.equals(O))}).filter((U)=>!!U);else G=$;if(G.length>J)throw new Error("Too many signatures");return G.length===J}function SY(J){return!!J.finalScriptSig||!!J.finalScriptWitness}function vJ(J){return($)=>{try{return J({output:$}),!0}catch(Z){return!1}}}var B5=vJ(r0.p2ms),v5=vJ(r0.p2pk),S5=vJ(r0.p2pkh),KQ=vJ(r0.p2wpkh),EY=vJ(r0.p2wsh),TY=vJ(r0.p2sh);function RY(J){return($)=>{if(!$.masterFingerprint.equals(J.fingerprint))return!1;if(!J.derivePath($.path).publicKey.equals($.pubkey))return!1;return!0}}function LQ(J){if(typeof J!=="number"||J!==Math.floor(J)||J>4294967295||J<0)throw new Error("Invalid 32 bit integer")}function T5(J,$,Z){let G=$.__FEE_RATE||J.getFeeRate(),U=$.__EXTRACTED_TX.virtualSize(),O=G*U;if(G>=Z.maximumFeeRate)throw new Error(`Warning: You are paying around ${(O/1e8).toFixed(8)} in fees, which is ${G} satoshi per byte for a transaction with a VSize of ${U} bytes (segwit counted as 0.25 byte per byte). Use setMaximumFeeRate method to raise your threshold, or pass true to the first arg of extractTransaction.`)}function M$(J,$){J.forEach((Z)=>{let G=!1,U=[];if((Z.partialSig||[]).length===0){if(!Z.finalScriptSig&&!Z.finalScriptWitness)return;U=f5(Z)}else U=Z.partialSig;if(U.forEach((O)=>{let{hashType:D}=s0.signature.decode(O.signature),F=[];if(D&m0.Transaction.SIGHASH_ANYONECANPAY)F.push("addInput");switch(D&31){case m0.Transaction.SIGHASH_ALL:break;case m0.Transaction.SIGHASH_SINGLE:case m0.Transaction.SIGHASH_NONE:F.push("addOutput"),F.push("setInputSequence");break}if(F.indexOf($)===-1)G=!0}),G)throw new Error("Can not modify transaction, signatures exist.")})}function I5(J){if(!J.sighashType||!J.partialSig)return;let{partialSig:$,sighashType:Z}=J;$.forEach((G)=>{let{hashType:U}=s0.signature.decode(G.signature);if(Z!==U)throw new Error("Signature sighash does not match input sighash type")})}function IY(J,$,Z){if(!LZ(J,$))throw new Error(`Can not ${Z} for this input with the key ${J.toString("hex")}`)}function k5(J){if(!J.ins.every((Z)=>Z.script&&Z.script.length===0&&Z.witness&&Z.witness.length===0))throw new Error("Format Error: Transaction ScriptSigs are not empty")}function x5(J,$){J.ins.forEach((Z)=>{kY($,Z)})}function kY(J,$){let Z=HQ.reverseBuffer(Buffer.from($.hash)).toString("hex")+":"+$.index;if(J.__TX_IN_CACHE[Z])throw new Error("Duplicate input detected.");J.__TX_IN_CACHE[Z]=1}function xY(J,$){return(Z,G,U,O)=>{let D=J({redeem:{output:U}}).output;if(!G.equals(D))throw new Error(`${$} for ${O} #${Z} doesn't match the scriptPubKey in the prevout`)}}var jY=xY(r0.p2sh,"Redeem script"),CY=xY(r0.p2wsh,"Witness script");function NY(J,$,Z,G){if(!Z.every(SY))throw new Error(`PSBT must be finalized to calculate ${$}`);if(J==="__FEE_RATE"&&G.__FEE_RATE)return G.__FEE_RATE;if(J==="__FEE"&&G.__FEE)return G.__FEE;let U,O=!0;if(G.__EXTRACTED_TX)U=G.__EXTRACTED_TX,O=!1;else U=G.__TX.clone();if(yY(Z,U,G,O),J==="__FEE_RATE")return G.__FEE_RATE;else if(J==="__FEE")return G.__FEE}function g5(J,$,Z,G,U,O){let D=hY(Z);if(!P5($,Z,D))throw new Error(`Can not finalize input #${J}`);return w5(Z,D,$.partialSig,G,U,O)}function w5(J,$,Z,G,U,O){let D,F,K=y5(J,$,Z),E=!O?null:r0.p2wsh({redeem:K}),R=!U?null:r0.p2sh({redeem:E||K});if(G){if(E)F=BY(E.witness);else F=BY(K.witness);if(R)D=R.input}else if(R)D=R.input;else D=K.input;return{finalScriptSig:D,finalScriptWitness:F}}function _Y(J,$,Z,G,U){let O=W1.checkForInput(J,$),{hash:D,sighashType:F,script:K}=gY($,O,G,!1,U);return IY(Z,K,"sign"),{hash:D,sighashType:F}}function gY(J,$,Z,G,U){let O=Z.__TX,D=$.sighashType||m0.Transaction.SIGHASH_ALL;if(U&&U.indexOf(D)<0){let C=b5(D);throw new Error(`Sighash type is not allowed. Retry the sign method passing the sighashTypes array of whitelisted types. Sighash type: ${C}`)}let F,K;if($.nonWitnessUtxo){let C=EQ(Z,$,J),v=O.ins[J].hash,c=C.getHash();if(!v.equals(c))throw new Error(`Non-witness UTXO hash for input #${J} doesn't match the hash specified in the prevout`);let N0=O.ins[J].index;K=C.outs[N0]}else if($.witnessUtxo)K=$.witnessUtxo;else throw new Error("Need a Utxo input item for signing");let{meaningfulScript:E,type:R}=RQ(K.script,J,"input",$.redeemScript,$.witnessScript);if(["p2sh-p2wsh","p2wsh"].indexOf(R)>=0)F=O.hashForWitnessV0(J,E,K.value,D);else if(KQ(E)){let C=r0.p2pkh({hash:E.slice(2)}).output;F=O.hashForWitnessV0(J,C,K.value,D)}else{if($.nonWitnessUtxo===void 0&&Z.__UNSAFE_SIGN_NONSEGWIT===!1)throw new Error(`Input #${J} has witnessUtxo but non-segwit script: ${E.toString("hex")}`);if(!G&&Z.__UNSAFE_SIGN_NONSEGWIT!==!1)console.warn(`Warning: Signing non-segwit inputs without the full parent transaction means there is a chance that a miner could feed you incorrect information to trick you into paying large fees. This behavior is the same as the old TransactionBuilder class when signing non-segwit scripts. You are not able to export this Psbt with toBuffer|toBase64|toHex since it is not BIP174 compliant.
*********************
PROCEED WITH CAUTION!
*********************`);F=O.hashForSignature(J,E,D)}return{script:E,sighashType:D,hash:F}}function y5(J,$,Z){let G;switch($){case"multisig":let U=h5(J,Z);G=r0.p2ms({output:J,signatures:U});break;case"pubkey":G=r0.p2pk({output:J,signature:Z[0].signature});break;case"pubkeyhash":G=r0.p2pkh({output:J,pubkey:Z[0].pubkey,signature:Z[0].signature});break;case"witnesspubkeyhash":G=r0.p2wpkh({output:J,pubkey:Z[0].pubkey,signature:Z[0].signature});break}return G}function f5(J){let $=!J.finalScriptSig?[]:s0.decompile(J.finalScriptSig)||[],Z=!J.finalScriptWitness?[]:s0.decompile(J.finalScriptWitness)||[];return $.concat(Z).filter((G)=>{return Buffer.isBuffer(G)&&s0.isCanonicalScriptSignature(G)}).map((G)=>({signature:G}))}function c5(J,$,Z){let G=Z.__TX,U={script:null,isSegwit:!1,isP2SH:!1,isP2WSH:!1};if(U.isP2SH=!!$.redeemScript,U.isP2WSH=!!$.witnessScript,$.witnessScript)U.script=$.witnessScript;else if($.redeemScript)U.script=$.redeemScript;else if($.nonWitnessUtxo){let O=EQ(Z,$,J),D=G.ins[J].index;U.script=O.outs[D].script}else if($.witnessUtxo)U.script=$.witnessUtxo.script;if($.witnessScript||KQ(U.script))U.isSegwit=!0;return U}function PY(J,$,Z){let G=W1.checkForInput($,J);if(!G.bip32Derivation||G.bip32Derivation.length===0)throw new Error("Need bip32Derivation to sign with HD");let U=G.bip32Derivation.map((D)=>{if(D.masterFingerprint.equals(Z.fingerprint))return D;else return}).filter((D)=>!!D);if(U.length===0)throw new Error("Need one bip32Derivation masterFingerprint to match the HDSigner fingerprint");return U.map((D)=>{let F=Z.derivePath(D.path);if(!D.pubkey.equals(F.publicKey))throw new Error("pubkey did not match bip32Derivation");return F})}function h5(J,$){return r0.p2ms({output:J}).pubkeys.map((G)=>{return($.filter((U)=>{return U.pubkey.equals(G)})[0]||{}).signature}).filter((G)=>!!G)}function wY(J){let $=0;function Z(D){return $+=D,J.slice($-D,$)}function G(){let D=WQ.decode(J,$);return $+=WQ.decode.bytes,D}function U(){return Z(G())}function O(){let D=G(),F=[];for(let K=0;K<D;K++)F.push(U());return F}return O()}function b5(J){let $=J&m0.Transaction.SIGHASH_ANYONECANPAY?"SIGHASH_ANYONECANPAY | ":"";switch(J&31){case m0.Transaction.SIGHASH_ALL:$+="SIGHASH_ALL";break;case m0.Transaction.SIGHASH_SINGLE:$+="SIGHASH_SINGLE";break;case m0.Transaction.SIGHASH_NONE:$+="SIGHASH_NONE";break}return $}function BY(J){let $=Buffer.allocUnsafe(0);function Z(D){$=Buffer.concat([$,Buffer.from(D)])}function G(D){let F=$.length,K=WQ.encodingLength(D);$=Buffer.concat([$,Buffer.allocUnsafe(K)]),WQ.encode(D,$,F)}function U(D){G(D.length),Z(D)}function O(D){G(D.length),D.forEach(U)}return O(J),$}function zZ(J,$,Z){J.__NON_WITNESS_UTXO_BUF_CACHE[Z]=$.nonWitnessUtxo;let G=m0.Transaction.fromBuffer($.nonWitnessUtxo);J.__NON_WITNESS_UTXO_TX_CACHE[Z]=G;let U=J,O=Z;delete $.nonWitnessUtxo,Object.defineProperty($,"nonWitnessUtxo",{enumerable:!0,get(){let D=U.__NON_WITNESS_UTXO_BUF_CACHE[O],F=U.__NON_WITNESS_UTXO_TX_CACHE[O];if(D!==void 0)return D;else{let K=F.toBuffer();return U.__NON_WITNESS_UTXO_BUF_CACHE[O]=K,K}},set(D){U.__NON_WITNESS_UTXO_BUF_CACHE[O]=D}})}function yY(J,$,Z,G){let U=0;J.forEach((K,E)=>{if(G&&K.finalScriptSig)$.ins[E].script=K.finalScriptSig;if(G&&K.finalScriptWitness)$.ins[E].witness=wY(K.finalScriptWitness);if(K.witnessUtxo)U+=K.witnessUtxo.value;else if(K.nonWitnessUtxo){let R=EQ(Z,K,E),C=$.ins[E].index,v=R.outs[C];U+=v.value}});let O=$.outs.reduce((K,E)=>K+E.value,0),D=U-O;if(D<0)throw new Error("Outputs are spending more than Inputs");let F=$.virtualSize();Z.__FEE=D,Z.__EXTRACTED_TX=$,Z.__FEE_RATE=Math.floor(D/F)}function EQ(J,$,Z){let G=J.__NON_WITNESS_UTXO_TX_CACHE;if(!G[Z])zZ(J,$,Z);return G[Z]}function fY(J,$,Z){if($.witnessUtxo!==void 0)return $.witnessUtxo.script;else if($.nonWitnessUtxo!==void 0)return EQ(Z,$,J).outs[Z.__TX.ins[J].index].script;else throw new Error("Can't find pubkey in input without Utxo data")}function d5(J,$,Z,G){let U=fY(Z,$,G),{meaningfulScript:O}=RQ(U,Z,"input",$.redeemScript,$.witnessScript);return LZ(J,O)}function l5(J,$,Z,G){let U=G.__TX.outs[Z].script,{meaningfulScript:O}=RQ(U,Z,"output",$.redeemScript,$.witnessScript);return LZ(J,O)}function m5(J){if(!J)return;let $=s0.decompile(J);if(!$)return;let Z=$[$.length-1];if(!Buffer.isBuffer(Z)||cY(Z)||p5(Z))return;if(!s0.decompile(Z))return;return Z}function o5(J){if(!J)return;let $=wY(J),Z=$[$.length-1];if(cY(Z))return;if(!s0.decompile(Z))return;return Z}function cY(J){return J.length===33&&s0.isCanonicalPubKey(J)}function p5(J){return s0.isCanonicalScriptSignature(J)}function RQ(J,$,Z,G,U){let O=TY(J),D=O&&G&&EY(G),F=EY(J);if(O&&G===void 0)throw new Error("scriptPubkey is P2SH but redeemScript missing");if((F||D)&&U===void 0)throw new Error("scriptPubkey or redeemScript is P2WSH but witnessScript missing");let K;if(D)K=U,jY($,J,G,Z),CY($,G,U,Z),MQ(K);else if(F)K=U,CY($,J,U,Z),MQ(K);else if(O)K=G,jY($,J,G,Z);else K=J;return{meaningfulScript:K,type:D?"p2sh-p2wsh":O?"p2sh":F?"p2wsh":"raw"}}function MQ(J){if(KQ(J)||TY(J))throw new Error("P2WPKH or P2SH can not be contained within P2WSH")}function LZ(J,$){let Z=j5.hash160(J),G=s0.decompile($);if(G===null)throw new Error("Unknown script error");return G.some((U)=>{if(typeof U==="number")return!1;return U.equals(J)||U.equals(Z)})}function hY(J){if(KQ(J))return"witnesspubkeyhash";if(S5(J))return"pubkeyhash";if(B5(J))return"multisig";if(v5(J))return"pubkey";return"nonstandard"}function K$(J){return[...Array(J).keys()]}});var pY=x((oY)=>{Object.defineProperty(oY,"__esModule",{value:!0});var WZ=R0(),lY=R0();function r5(J){return J===lY.OPS.OP_0||WZ.isCanonicalScriptSignature(J)}function mY(J,$){let Z=WZ.decompile(J);if(Z.length<2)return!1;if(Z[0]!==lY.OPS.OP_0)return!1;if($)return Z.slice(1).every(r5);return Z.slice(1).every(WZ.isCanonicalScriptSignature)}oY.check=mY;mY.toJSON=()=>{return"multisig input"}});var tY=x((iY)=>{Object.defineProperty(iY,"__esModule",{value:!0});var uY=R0(),sY=R0(),rY=Y1(),nY=sY.OPS.OP_RESERVED;function aY(J,$){let Z=uY.decompile(J);if(Z.length<4)return!1;if(Z[Z.length-1]!==sY.OPS.OP_CHECKMULTISIG)return!1;if(!rY.Number(Z[0]))return!1;if(!rY.Number(Z[Z.length-2]))return!1;let G=Z[0]-nY,U=Z[Z.length-2]-nY;if(G<=0)return!1;if(U>16)return!1;if(G>U)return!1;if(U!==Z.length-3)return!1;if($)return!0;return Z.slice(1,-2).every(uY.isCanonicalPubKey)}iY.check=aY;aY.toJSON=()=>{return"multi-sig output"}});var jQ=x((eY)=>{Object.defineProperty(eY,"__esModule",{value:!0});var a5=pY();eY.input=a5;var i5=tY();eY.output=i5});var QG=x(($G)=>{Object.defineProperty($G,"__esModule",{value:!0});var JG=R0(),Jz=JG.OPS;function HZ(J){let $=JG.compile(J);return $.length>1&&$[0]===Jz.OP_RETURN}$G.check=HZ;HZ.toJSON=()=>{return"null data output"};var $z={check:HZ};$G.output=$z});var YG=x((UG)=>{Object.defineProperty(UG,"__esModule",{value:!0});var ZG=R0();function XG(J){let $=ZG.decompile(J);return $.length===1&&ZG.isCanonicalScriptSignature($[0])}UG.check=XG;XG.toJSON=()=>{return"pubKey input"}});var AG=x((OG)=>{Object.defineProperty(OG,"__esModule",{value:!0});var GG=R0(),Uz=R0();function VG(J){let $=GG.decompile(J);return $.length===2&&GG.isCanonicalPubKey($[0])&&$[1]===Uz.OPS.OP_CHECKSIG}OG.check=VG;VG.toJSON=()=>{return"pubKey output"}});var CQ=x((qG)=>{Object.defineProperty(qG,"__esModule",{value:!0});var Gz=YG();qG.input=Gz;var Vz=AG();qG.output=Vz});var LG=x((DG)=>{Object.defineProperty(DG,"__esModule",{value:!0});var FZ=R0();function zG(J){let $=FZ.decompile(J);return $.length===2&&FZ.isCanonicalScriptSignature($[0])&&FZ.isCanonicalPubKey($[1])}DG.check=zG;zG.toJSON=()=>{return"pubKeyHash input"}});var FG=x((HG)=>{Object.defineProperty(HG,"__esModule",{value:!0});var zz=R0(),NQ=R0();function WG(J){let $=zz.compile(J);return $.length===25&&$[0]===NQ.OPS.OP_DUP&&$[1]===NQ.OPS.OP_HASH160&&$[2]===20&&$[23]===NQ.OPS.OP_EQUALVERIFY&&$[24]===NQ.OPS.OP_CHECKSIG}HG.check=WG;WG.toJSON=()=>{return"pubKeyHash output"}});var _Q=x((MG)=>{Object.defineProperty(MG,"__esModule",{value:!0});var Lz=LG();MG.input=Lz;var Wz=FG();MG.output=Wz});var MZ=x((EG)=>{Object.defineProperty(EG,"__esModule",{value:!0});var Mz=R0(),Kz=R0();function KG(J){let $=Mz.compile(J);return $.length===22&&$[0]===Kz.OPS.OP_0&&$[1]===20}EG.check=KG;KG.toJSON=()=>{return"Witness pubKeyHash output"}});var KZ=x((jG)=>{Object.defineProperty(jG,"__esModule",{value:!0});var Rz=R0(),jz=R0();function RG(J){let $=Rz.compile(J);return $.length===34&&$[0]===jz.OPS.OP_0&&$[1]===32}jG.check=RG;RG.toJSON=()=>{return"Witness scriptHash output"}});var vG=x((BG)=>{Object.defineProperty(BG,"__esModule",{value:!0});var E$=R0(),CG=jQ(),NG=CQ(),_G=_Q(),Nz=MZ(),_z=KZ();function PG(J,$){let Z=E$.decompile(J);if(Z.length<1)return!1;let G=Z[Z.length-1];if(!Buffer.isBuffer(G))return!1;let U=E$.decompile(E$.compile(Z.slice(0,-1))),O=E$.decompile(G);if(!O)return!1;if(!E$.isPushOnly(U))return!1;if(Z.length===1)return _z.check(O)||Nz.check(O);if(_G.input.check(U)&&_G.output.check(O))return!0;if(CG.input.check(U,$)&&CG.output.check(O))return!0;if(NG.input.check(U)&&NG.output.check(O))return!0;return!1}BG.check=PG;PG.toJSON=()=>{return"scriptHash input"}});var kG=x((IG)=>{Object.defineProperty(IG,"__esModule",{value:!0});var Bz=R0(),SG=R0();function TG(J){let $=Bz.compile(J);return $.length===23&&$[0]===SG.OPS.OP_HASH160&&$[1]===20&&$[22]===SG.OPS.OP_EQUAL}IG.check=TG;TG.toJSON=()=>{return"scriptHash output"}});var gG=x((xG)=>{Object.defineProperty(xG,"__esModule",{value:!0});var Sz=vG();xG.input=Sz;var Tz=kG();xG.output=Tz});var hG=x((cG)=>{Object.defineProperty(cG,"__esModule",{value:!0});var EZ=R0(),wG=R0(),xz=Y1(),yG=l0(),fG=Buffer.from("aa21a9ed","hex");function RZ(J){let $=EZ.compile(J);return $.length>37&&$[0]===wG.OPS.OP_RETURN&&$[1]===36&&$.slice(2,6).equals(fG)}cG.check=RZ;RZ.toJSON=()=>{return"Witness commitment output"};function gz(J){yG(xz.Hash256bit,J);let $=Buffer.allocUnsafe(36);return fG.copy($,0),J.copy($,4),EZ.compile([wG.OPS.OP_RETURN,$])}cG.encode=gz;function wz(J){return yG(RZ,J),EZ.decompile(J)[1].slice(4,36)}cG.decode=wz});var dG=x((bG)=>{Object.defineProperty(bG,"__esModule",{value:!0});var hz=hG();bG.output=hz});var oG=x((mG)=>{Object.defineProperty(mG,"__esModule",{value:!0});var jZ=R0();function dz(J){return jZ.isCanonicalPubKey(J)&&J.length===33}function lG(J){let $=jZ.decompile(J);return $.length===2&&jZ.isCanonicalScriptSignature($[0])&&dz($[1])}mG.check=lG;lG.toJSON=()=>{return"witnessPubKeyHash input"}});var uG=x((pG)=>{Object.defineProperty(pG,"__esModule",{value:!0});var mz=oG();pG.input=mz;var oz=MZ();pG.output=oz});var JV=x((eG)=>{Object.defineProperty(eG,"__esModule",{value:!0});var rG=R0(),nG=l0(),sG=jQ(),aG=CQ(),iG=_Q();function tG(J,$){if(nG(nG.Array,J),J.length<1)return!1;let Z=J[J.length-1];if(!Buffer.isBuffer(Z))return!1;let G=rG.decompile(Z);if(!G||G.length===0)return!1;let U=rG.compile(J.slice(0,-1));if(iG.input.check(U)&&iG.output.check(G))return!0;if(sG.input.check(U,$)&&sG.output.check(G))return!0;if(aG.input.check(U)&&aG.output.check(G))return!0;return!1}eG.check=tG;tG.toJSON=()=>{return"witnessScriptHash input"}});var QV=x(($V)=>{Object.defineProperty($V,"__esModule",{value:!0});var nz=JV();$V.input=nz;var sz=KZ();$V.output=sz});var AV=x((OV)=>{Object.defineProperty(OV,"__esModule",{value:!0});var CZ=R0(),ZV=jQ(),tz=QG(),XV=CQ(),UV=_Q(),YV=gG(),ez=dG(),GV=uG(),VV=QV(),o0={P2MS:"multisig",NONSTANDARD:"nonstandard",NULLDATA:"nulldata",P2PK:"pubkey",P2PKH:"pubkeyhash",P2SH:"scripthash",P2WPKH:"witnesspubkeyhash",P2WSH:"witnessscripthash",WITNESS_COMMITMENT:"witnesscommitment"};OV.types=o0;function JD(J){if(GV.output.check(J))return o0.P2WPKH;if(VV.output.check(J))return o0.P2WSH;if(UV.output.check(J))return o0.P2PKH;if(YV.output.check(J))return o0.P2SH;let $=CZ.decompile(J);if(!$)throw new TypeError("Invalid script");if(ZV.output.check($))return o0.P2MS;if(XV.output.check($))return o0.P2PK;if(ez.output.check($))return o0.WITNESS_COMMITMENT;if(tz.output.check($))return o0.NULLDATA;return o0.NONSTANDARD}OV.output=JD;function $D(J,$){let Z=CZ.decompile(J);if(!Z)throw new TypeError("Invalid script");if(UV.input.check(Z))return o0.P2PKH;if(YV.input.check(Z,$))return o0.P2SH;if(ZV.input.check(Z,$))return o0.P2MS;if(XV.input.check(Z))return o0.P2PK;return o0.NONSTANDARD}OV.input=$D;function QD(J,$){let Z=CZ.decompile(J);if(!Z)throw new TypeError("Invalid script");if(GV.input.check(Z))return o0.P2WPKH;if(VV.input.check(Z,$))return o0.P2WSH;return o0.NONSTANDARD}OV.witness=QD});var DV=x((zV)=>{Object.defineProperty(zV,"__esModule",{value:!0});var GD=VQ(),VD=H$(),DJ=AV(),qV=D1(),OD=OQ(),AD=t0(),w0=W$(),LJ=R0(),qD=R0(),j1=F$(),C1=Y1(),v0=l0(),b=DJ.types,zD=new Set(["p2pkh","p2pk","p2wpkh","p2ms","p2sh-p2pkh","p2sh-p2pk","p2sh-p2wpkh","p2sh-p2ms","p2wsh-p2pkh","p2wsh-p2pk","p2wsh-p2ms","p2sh-p2wsh-p2pkh","p2sh-p2wsh-p2pk","p2sh-p2wsh-p2ms"]);function g0(J,$,Z){try{v0(J,$)}catch(G){throw new Error(Z)}}function DD(J){return typeof J==="string"||J instanceof String}function LD(J){return J instanceof j1.Transaction}class BZ{constructor(J=AD.bitcoin,$=2500){this.network=J,this.maximumFeeRate=$,this.__PREV_TX_SET={},this.__INPUTS=[],this.__TX=new j1.Transaction,this.__TX.version=2,this.__USE_LOW_R=!1,console.warn("Deprecation Warning: TransactionBuilder will be removed in the future. (v6.x.x or later) Please use the Psbt class instead. Examples of usage are available in the transactions-psbt.js integration test file on our Github. A high level explanation is available in the psbt.ts and psbt.js files as well.")}static fromTransaction(J,$){let Z=new BZ($);return Z.setVersion(J.version),Z.setLockTime(J.locktime),J.outs.forEach((G)=>{Z.addOutput(G.script,G.value)}),J.ins.forEach((G)=>{Z.__addInputUnsafe(G.hash,G.index,{sequence:G.sequence,script:G.script,witness:G.witness})}),Z.__INPUTS.forEach((G,U)=>{WD(G,J,U)}),Z}setLowR(J){if(v0(v0.maybe(v0.Boolean),J),J===void 0)J=!0;return this.__USE_LOW_R=J,J}setLockTime(J){if(v0(C1.UInt32,J),this.__INPUTS.some(($)=>{if(!$.signatures)return!1;return $.signatures.some((Z)=>Z!==void 0)}))throw new Error("No, this would invalidate signatures");this.__TX.locktime=J}setVersion(J){v0(C1.UInt32,J),this.__TX.version=J}addInput(J,$,Z,G){if(!this.__canModifyInputs())throw new Error("No, this would invalidate signatures");let U;if(DD(J))J=VD.reverseBuffer(Buffer.from(J,"hex"));else if(LD(J)){let O=J.outs[$];G=O.script,U=O.value,J=J.getHash(!1)}return this.__addInputUnsafe(J,$,{sequence:Z,prevOutScript:G,value:U})}addOutput(J,$){if(!this.__canModifyOutputs())throw new Error("No, this would invalidate signatures");if(typeof J==="string")J=GD.toOutputScript(J,this.network);return this.__TX.addOutput(J,$)}build(){return this.__build(!1)}buildIncomplete(){return this.__build(!0)}sign(J,$,Z,G,U,O){MD(KD(this.network,this.__INPUTS,this.__needsOutputs.bind(this),this.__TX,J,$,Z,G,U,O,this.__USE_LOW_R))}__addInputUnsafe(J,$,Z){if(j1.Transaction.isCoinbaseHash(J))throw new Error("coinbase inputs not supported");let G=J.toString("hex")+":"+$;if(this.__PREV_TX_SET[G]!==void 0)throw new Error("Duplicate TxOut: "+G);let U={};if(Z.script!==void 0)U=PQ(Z.script,Z.witness||[]);if(Z.value!==void 0)U.value=Z.value;if(!U.prevOutScript&&Z.prevOutScript){let D;if(!U.pubkeys&&!U.signatures){let F=R$(Z.prevOutScript);if(F.pubkeys)U.pubkeys=F.pubkeys,U.signatures=F.signatures;D=F.type}U.prevOutScript=Z.prevOutScript,U.prevOutType=D||DJ.output(Z.prevOutScript)}let O=this.__TX.addInput(J,$,Z.sequence,Z.scriptSig);return this.__INPUTS[O]=U,this.__PREV_TX_SET[G]=!0,O}__build(J){if(!J){if(!this.__TX.ins.length)throw new Error("Transaction has no inputs");if(!this.__TX.outs.length)throw new Error("Transaction has no outputs")}let $=this.__TX.clone();if(this.__INPUTS.forEach((Z,G)=>{if(!Z.prevOutType&&!J)throw new Error("Transaction is not complete");let U=PZ(Z.prevOutType,Z,J);if(!U){if(!J&&Z.prevOutType===b.NONSTANDARD)throw new Error("Unknown input type");if(!J)throw new Error("Not enough information");return}$.setInputScript(G,U.input),$.setWitness(G,U.witness)}),!J){if(this.__overMaximumFees($.virtualSize()))throw new Error("Transaction has absurd fees")}return $}__canModifyInputs(){return this.__INPUTS.every((J)=>{if(!J.signatures)return!0;return J.signatures.every(($)=>{if(!$)return!0;return(_Z($)&j1.Transaction.SIGHASH_ANYONECANPAY)!==0})})}__needsOutputs(J){if(J===j1.Transaction.SIGHASH_ALL)return this.__TX.outs.length===0;return this.__TX.outs.length===0&&this.__INPUTS.some(($)=>{if(!$.signatures)return!1;return $.signatures.some((Z)=>{if(!Z)return!1;if(_Z(Z)&j1.Transaction.SIGHASH_NONE)return!1;return!0})})}__canModifyOutputs(){let J=this.__TX.ins.length,$=this.__TX.outs.length;return this.__INPUTS.every((Z)=>{if(Z.signatures===void 0)return!0;return Z.signatures.every((G)=>{if(!G)return!0;let O=_Z(G)&31;if(O===j1.Transaction.SIGHASH_NONE)return!0;if(O===j1.Transaction.SIGHASH_SINGLE)return J<=$;return!1})})}__overMaximumFees(J){let $=this.__INPUTS.reduce((O,D)=>O+(D.value>>>0),0),Z=this.__TX.outs.reduce((O,D)=>O+D.value,0);return($-Z)/J>this.maximumFeeRate}}zV.TransactionBuilder=BZ;function PQ(J,$,Z,G){if(J.length===0&&$.length===0)return{};if(!Z){let U=DJ.input(J,!0),O=DJ.witness($,!0);if(U===b.NONSTANDARD)U=void 0;if(O===b.NONSTANDARD)O=void 0;Z=U||O}switch(Z){case b.P2WPKH:{let{output:U,pubkey:O,signature:D}=w0.p2wpkh({witness:$});return{prevOutScript:U,prevOutType:b.P2WPKH,pubkeys:[O],signatures:[D]}}case b.P2PKH:{let{output:U,pubkey:O,signature:D}=w0.p2pkh({input:J});return{prevOutScript:U,prevOutType:b.P2PKH,pubkeys:[O],signatures:[D]}}case b.P2PK:{let{signature:U}=w0.p2pk({input:J});return{prevOutType:b.P2PK,pubkeys:[void 0],signatures:[U]}}case b.P2MS:{let{m:U,pubkeys:O,signatures:D}=w0.p2ms({input:J,output:G},{allowIncomplete:!0});return{prevOutType:b.P2MS,pubkeys:O,signatures:D,maxSignatures:U}}}if(Z===b.P2SH){let{output:U,redeem:O}=w0.p2sh({input:J,witness:$}),D=DJ.output(O.output),F=PQ(O.input,O.witness,D,O.output);if(!F.prevOutType)return{};return{prevOutScript:U,prevOutType:b.P2SH,redeemScript:O.output,redeemScriptType:F.prevOutType,witnessScript:F.witnessScript,witnessScriptType:F.witnessScriptType,pubkeys:F.pubkeys,signatures:F.signatures}}if(Z===b.P2WSH){let{output:U,redeem:O}=w0.p2wsh({input:J,witness:$}),D=DJ.output(O.output),F;if(D===b.P2WPKH)F=PQ(O.input,O.witness,D);else F=PQ(LJ.compile(O.witness),[],D,O.output);if(!F.prevOutType)return{};return{prevOutScript:U,prevOutType:b.P2WSH,witnessScript:O.output,witnessScriptType:F.prevOutType,pubkeys:F.pubkeys,signatures:F.signatures}}return{prevOutType:b.NONSTANDARD,prevOutScript:J}}function WD(J,$,Z){if(J.redeemScriptType!==b.P2MS||!J.redeemScript)return;if(J.pubkeys.length===J.signatures.length)return;let G=J.signatures.concat();J.signatures=J.pubkeys.map((U)=>{let O=OD.fromPublicKey(U),D;return G.some((F,K)=>{if(!F)return!1;let E=LJ.signature.decode(F),R=$.hashForSignature(Z,J.redeemScript,E.hashType);if(!O.verify(R,E.signature))return!1;return G[K]=void 0,D=F,!0}),D})}function R$(J,$){v0(C1.Buffer,J);let Z=DJ.output(J);switch(Z){case b.P2PKH:{if(!$)return{type:Z};let G=w0.p2pkh({output:J}).hash,U=qV.hash160($);if(!G.equals(U))return{type:Z};return{type:Z,pubkeys:[$],signatures:[void 0]}}case b.P2WPKH:{if(!$)return{type:Z};let G=w0.p2wpkh({output:J}).hash,U=qV.hash160($);if(!G.equals(U))return{type:Z};return{type:Z,pubkeys:[$],signatures:[void 0]}}case b.P2PK:{let G=w0.p2pk({output:J});return{type:Z,pubkeys:[G.pubkey],signatures:[void 0]}}case b.P2MS:{let G=w0.p2ms({output:J});return{type:Z,pubkeys:G.pubkeys,signatures:G.pubkeys.map(()=>{return}),maxSignatures:G.m}}}return{type:Z}}function HD(J,$,Z,G){if(Z&&G){let O=w0.p2wsh({redeem:{output:G}}),D=w0.p2wsh({output:Z}),F=w0.p2sh({redeem:{output:Z}}),K=w0.p2sh({redeem:O});if(!O.hash.equals(D.hash))throw new Error("Witness script inconsistent with prevOutScript");if(!F.hash.equals(K.hash))throw new Error("Redeem script inconsistent with prevOutScript");let E=R$(O.redeem.output,$);if(!E.pubkeys)throw new Error(E.type+" not supported as witnessScript ("+LJ.toASM(G)+")");if(J.signatures&&J.signatures.some((C)=>C!==void 0))E.signatures=J.signatures;let R=G;if(E.type===b.P2WPKH)throw new Error("P2SH(P2WSH(P2WPKH)) is a consensus failure");return{redeemScript:Z,redeemScriptType:b.P2WSH,witnessScript:G,witnessScriptType:E.type,prevOutType:b.P2SH,prevOutScript:F.output,hasWitness:!0,signScript:R,signType:E.type,pubkeys:E.pubkeys,signatures:E.signatures,maxSignatures:E.maxSignatures}}if(Z){let O=w0.p2sh({redeem:{output:Z}});if(J.prevOutScript){let K;try{K=w0.p2sh({output:J.prevOutScript})}catch(E){throw new Error("PrevOutScript must be P2SH")}if(!O.hash.equals(K.hash))throw new Error("Redeem script inconsistent with prevOutScript")}let D=R$(O.redeem.output,$);if(!D.pubkeys)throw new Error(D.type+" not supported as redeemScript ("+LJ.toASM(Z)+")");if(J.signatures&&J.signatures.some((K)=>K!==void 0))D.signatures=J.signatures;let F=Z;if(D.type===b.P2WPKH)F=w0.p2pkh({pubkey:D.pubkeys[0]}).output;return{redeemScript:Z,redeemScriptType:D.type,prevOutType:b.P2SH,prevOutScript:O.output,hasWitness:D.type===b.P2WPKH,signScript:F,signType:D.type,pubkeys:D.pubkeys,signatures:D.signatures,maxSignatures:D.maxSignatures}}if(G){let O=w0.p2wsh({redeem:{output:G}});if(J.prevOutScript){let K=w0.p2wsh({output:J.prevOutScript});if(!O.hash.equals(K.hash))throw new Error("Witness script inconsistent with prevOutScript")}let D=R$(O.redeem.output,$);if(!D.pubkeys)throw new Error(D.type+" not supported as witnessScript ("+LJ.toASM(G)+")");if(J.signatures&&J.signatures.some((K)=>K!==void 0))D.signatures=J.signatures;let F=G;if(D.type===b.P2WPKH)throw new Error("P2WSH(P2WPKH) is a consensus failure");return{witnessScript:G,witnessScriptType:D.type,prevOutType:b.P2WSH,prevOutScript:O.output,hasWitness:!0,signScript:F,signType:D.type,pubkeys:D.pubkeys,signatures:D.signatures,maxSignatures:D.maxSignatures}}if(J.prevOutType&&J.prevOutScript){if(J.prevOutType===b.P2SH)throw new Error("PrevOutScript is "+J.prevOutType+", requires redeemScript");if(J.prevOutType===b.P2WSH)throw new Error("PrevOutScript is "+J.prevOutType+", requires witnessScript");if(!J.prevOutScript)throw new Error("PrevOutScript is missing");let O=R$(J.prevOutScript,$);if(!O.pubkeys)throw new Error(O.type+" not supported ("+LJ.toASM(J.prevOutScript)+")");if(J.signatures&&J.signatures.some((F)=>F!==void 0))O.signatures=J.signatures;let D=J.prevOutScript;if(O.type===b.P2WPKH)D=w0.p2pkh({pubkey:O.pubkeys[0]}).output;return{prevOutType:O.type,prevOutScript:J.prevOutScript,hasWitness:O.type===b.P2WPKH,signScript:D,signType:O.type,pubkeys:O.pubkeys,signatures:O.signatures,maxSignatures:O.maxSignatures}}let U=w0.p2pkh({pubkey:$}).output;return{prevOutType:b.P2PKH,prevOutScript:U,hasWitness:!1,signScript:U,signType:b.P2PKH,pubkeys:[$],signatures:[void 0]}}function PZ(J,$,Z){let G=$.pubkeys||[],U=$.signatures||[];switch(J){case b.P2PKH:{if(G.length===0)break;if(U.length===0)break;return w0.p2pkh({pubkey:G[0],signature:U[0]})}case b.P2WPKH:{if(G.length===0)break;if(U.length===0)break;return w0.p2wpkh({pubkey:G[0],signature:U[0]})}case b.P2PK:{if(G.length===0)break;if(U.length===0)break;return w0.p2pk({signature:U[0]})}case b.P2MS:{let O=$.maxSignatures;if(Z)U=U.map((F)=>F||qD.OPS.OP_0);else U=U.filter((F)=>F);let D=!Z||O===U.length;return w0.p2ms({m:O,pubkeys:G,signatures:U},{allowIncomplete:Z,validate:D})}case b.P2SH:{let O=PZ($.redeemScriptType,$,Z);if(!O)return;return w0.p2sh({redeem:{output:O.output||$.redeemScript,input:O.input,witness:O.witness}})}case b.P2WSH:{let O=PZ($.witnessScriptType,$,Z);if(!O)return;return w0.p2wsh({redeem:{output:$.witnessScript,input:O.input,witness:O.witness}})}}}function NZ(J){return J.signScript!==void 0&&J.signType!==void 0&&J.pubkeys!==void 0&&J.signatures!==void 0&&J.signatures.length===J.pubkeys.length&&J.pubkeys.length>0&&(J.hasWitness===!1||J.value!==void 0)}function _Z(J){return J.readUInt8(J.length-1)}function FD(J,$){if(!zD.has($.prevOutScriptType))throw new TypeError(`Unknown prevOutScriptType "${$.prevOutScriptType}"`);g0(v0.Number,$.vin,"sign must include vin parameter as Number (input index)"),g0(C1.Signer,$.keyPair,"sign must include keyPair parameter as Signer interface"),g0(v0.maybe(v0.Number),$.hashType,"sign hashType parameter must be a number");let Z=(J[$.vin]||[]).prevOutType,G=$.prevOutScriptType;switch(G){case"p2pkh":if(Z&&Z!=="pubkeyhash")throw new TypeError(`input #${$.vin} is not of type p2pkh: ${Z}`);g0(v0.value(void 0),$.witnessScript,`${G} requires NO witnessScript`),g0(v0.value(void 0),$.redeemScript,`${G} requires NO redeemScript`),g0(v0.value(void 0),$.witnessValue,`${G} requires NO witnessValue`);break;case"p2pk":if(Z&&Z!=="pubkey")throw new TypeError(`input #${$.vin} is not of type p2pk: ${Z}`);g0(v0.value(void 0),$.witnessScript,`${G} requires NO witnessScript`),g0(v0.value(void 0),$.redeemScript,`${G} requires NO redeemScript`),g0(v0.value(void 0),$.witnessValue,`${G} requires NO witnessValue`);break;case"p2wpkh":if(Z&&Z!=="witnesspubkeyhash")throw new TypeError(`input #${$.vin} is not of type p2wpkh: ${Z}`);g0(v0.value(void 0),$.witnessScript,`${G} requires NO witnessScript`),g0(v0.value(void 0),$.redeemScript,`${G} requires NO redeemScript`),g0(C1.Satoshi,$.witnessValue,`${G} requires witnessValue`);break;case"p2ms":if(Z&&Z!=="multisig")throw new TypeError(`input #${$.vin} is not of type p2ms: ${Z}`);g0(v0.value(void 0),$.witnessScript,`${G} requires NO witnessScript`),g0(v0.value(void 0),$.redeemScript,`${G} requires NO redeemScript`),g0(v0.value(void 0),$.witnessValue,`${G} requires NO witnessValue`);break;case"p2sh-p2wpkh":if(Z&&Z!=="scripthash")throw new TypeError(`input #${$.vin} is not of type p2sh-p2wpkh: ${Z}`);g0(v0.value(void 0),$.witnessScript,`${G} requires NO witnessScript`),g0(v0.Buffer,$.redeemScript,`${G} requires redeemScript`),g0(C1.Satoshi,$.witnessValue,`${G} requires witnessValue`);break;case"p2sh-p2ms":case"p2sh-p2pk":case"p2sh-p2pkh":if(Z&&Z!=="scripthash")throw new TypeError(`input #${$.vin} is not of type ${G}: ${Z}`);g0(v0.value(void 0),$.witnessScript,`${G} requires NO witnessScript`),g0(v0.Buffer,$.redeemScript,`${G} requires redeemScript`),g0(v0.value(void 0),$.witnessValue,`${G} requires NO witnessValue`);break;case"p2wsh-p2ms":case"p2wsh-p2pk":case"p2wsh-p2pkh":if(Z&&Z!=="witnessscripthash")throw new TypeError(`input #${$.vin} is not of type ${G}: ${Z}`);g0(v0.Buffer,$.witnessScript,`${G} requires witnessScript`),g0(v0.value(void 0),$.redeemScript,`${G} requires NO redeemScript`),g0(C1.Satoshi,$.witnessValue,`${G} requires witnessValue`);break;case"p2sh-p2wsh-p2ms":case"p2sh-p2wsh-p2pk":case"p2sh-p2wsh-p2pkh":if(Z&&Z!=="scripthash")throw new TypeError(`input #${$.vin} is not of type ${G}: ${Z}`);g0(v0.Buffer,$.witnessScript,`${G} requires witnessScript`),g0(v0.Buffer,$.redeemScript,`${G} requires witnessScript`),g0(C1.Satoshi,$.witnessValue,`${G} requires witnessScript`);break}}function MD({input:J,ourPubKey:$,keyPair:Z,signatureHash:G,hashType:U,useLowR:O}){let D=!1;for(let[F,K]of J.pubkeys.entries()){if(!$.equals(K))continue;if(J.signatures[F])throw new Error("Signature already exists");if($.length!==33&&J.hasWitness)throw new Error("BIP143 rejects uncompressed public keys in P2WPKH or P2WSH");let E=Z.sign(G,O);J.signatures[F]=LJ.signature.encode(E,U),D=!0}if(!D)throw new Error("Key pair cannot sign for this input")}function KD(J,$,Z,G,U,O,D,F,K,E,R){let C;if(typeof U==="number")console.warn("DEPRECATED: TransactionBuilder sign method arguments will change in v6, please use the TxbSignArg interface"),C=U;else if(typeof U==="object")FD($,U),{vin:C,keyPair:O,redeemScript:D,hashType:F,witnessValue:K,witnessScript:E}=U;else throw new TypeError("TransactionBuilder sign first arg must be TxbSignArg or number");if(O===void 0)throw new Error("sign requires keypair");if(O.network&&O.network!==J)throw new TypeError("Inconsistent network");if(!$[C])throw new Error("No input at index: "+C);if(F=F||j1.Transaction.SIGHASH_ALL,Z(F))throw new Error("Transaction needs outputs");let v=$[C];if(v.redeemScript!==void 0&&D&&!v.redeemScript.equals(D))throw new Error("Inconsistent redeemScript");let c=O.publicKey||O.getPublicKey&&O.getPublicKey();if(!NZ(v)){if(K!==void 0){if(v.value!==void 0&&v.value!==K)throw new Error("Input did not match witnessValue");v0(C1.Satoshi,K),v.value=K}if(!NZ(v)){let C0=HD(v,c,D,E);Object.assign(v,C0)}if(!NZ(v))throw Error(v.prevOutType+" not supported")}let N0;if(v.hasWitness)N0=G.hashForWitnessV0(C,v.signScript,v.value,F);else N0=G.hashForSignature(C,v.signScript,F);return{input:v,ourPubKey:c,keyPair:O,signatureHash:N0,hashType:F,useLowR:!!R}}});var SJ=x((LV)=>{Object.defineProperty(LV,"__esModule",{value:!0});var RD=SX();LV.bip32=RD;var jD=VQ();LV.address=jD;var CD=D1();LV.crypto=CD;var ND=OQ();LV.ECPair=ND;var _D=t0();LV.networks=_D;var PD=W$();LV.payments=PD;var BD=R0();LV.script=BD;var vD=HY();LV.Block=vD.Block;var SD=dY();LV.Psbt=SD.Psbt;var TD=R0();LV.opcodes=TD.OPS;var ID=F$();LV.Transaction=ID.Transaction;var kD=DV();LV.TransactionBuilder=kD.TransactionBuilder});var rZ=x((UW,cV)=>{var G9=function(J,$,Z,G,U,O,D,F){if($===void 0)throw new Error("invariant requires an error message argument");if(!J){var K;if($===void 0)K=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var E=[Z,G,U,O,D,F],R=0;K=new Error($.replace(/%s/g,function(){return E[R++]})),K.name="Invariant Violation"}throw K.framesToPop=1,K}};cV.exports=G9});var ZX=d0(oV(),1);var wV=d0(SJ(),1),yV=d0(z1(),1);var vZ=d0(WV(),1),SZ=d0(A$(),1);function BQ(J){let $=Buffer.alloc(1+J.length*4);return $[0]=J.length,J.forEach((Z,G)=>{$.writeUInt32BE(Z,1+4*G)}),$}function TJ(J){let $=!J?[]:V1(J);return BQ($)}function IJ(J){return vZ.default.fromPathArray(J).toString()}function V1(J){return vZ.default.fromString(J).toPathArray()}function TZ(J){let $=SZ.default.decode(J);return $.slice($.length-33)}function IZ(J){let $=SZ.default.decode(J);return{chaincode:$.slice(13,45),pubkey:$.slice($.length-33),version:$.readUInt32BE(0)}}function HV(J){for(let $=J.length-1;$>=0;$--)if(J[$]>=2147483648)return J.slice(0,$+1);return[]}var vQ=d0(qQ(),1);function kZ(J){if(J>Number.MAX_SAFE_INTEGER)throw new Error("Can't convert numbers > MAX_SAFE_INT");let $=Buffer.alloc(8,0);for(let Z=0;Z<$.length;Z++){let G=J&255;$[Z]=G,J=(J-G)/256}return $}function xZ(J){let $=0;if(J.length!=8)throw new Error("Expected Bufffer of lenght 8");if(J[7]!=0)throw new Error("Can't encode numbers > MAX_SAFE_INT");if(J[6]>31)throw new Error("Can't encode numbers > MAX_SAFE_INT");for(let Z=J.length-1;Z>=0;Z--)$=$*256+J[Z];return $}class b0{constructor(){this.bufs=[]}write(J,$){let Z=Buffer.alloc(J);$(Z),this.bufs.push(Z)}writeUInt8(J){this.write(1,($)=>$.writeUInt8(J,0))}writeInt32(J){this.write(4,($)=>$.writeInt32LE(J,0))}writeUInt32(J){this.write(4,($)=>$.writeUInt32LE(J,0))}writeUInt64(J){let $=kZ(J);this.writeSlice($)}writeVarInt(J){this.bufs.push(vQ.default.encode(J))}writeSlice(J){this.bufs.push(Buffer.from(J))}writeVarSlice(J){this.writeVarInt(J.length),this.writeSlice(J)}buffer(){return Buffer.concat(this.bufs)}}class O1{constructor(J,$=0){this.buffer=J,this.offset=$}available(){return this.buffer.length-this.offset}readUInt8(){let J=this.buffer.readUInt8(this.offset);return this.offset++,J}readInt32(){let J=this.buffer.readInt32LE(this.offset);return this.offset+=4,J}readUInt32(){let J=this.buffer.readUInt32LE(this.offset);return this.offset+=4,J}readUInt64(){let J=this.readSlice(8);return xZ(J)}readVarInt(){let J=vQ.default.decode(this.buffer,this.offset);return this.offset+=vQ.default.decode.bytes,J}readSlice(J){if(this.buffer.length<this.offset+J)throw new Error("Cannot read slice out of bounds");let $=this.buffer.slice(this.offset,this.offset+J);return this.offset+=J,$}readVarSlice(){return this.readSlice(this.readVarInt())}readVector(){let J=this.readVarInt(),$=[];for(let Z=0;Z<J;Z++)$.push(this.readVarSlice());return $}}var wZ=d0(SJ(),1),jV=d0(z1(),1);var Q1=50,FV=1,SQ=0,kJ=4294967295,j$=1,TQ=118,C$=169,xJ=20,MV=135,IQ=136,kQ=172;var EV=d0(KV(),1),RV=d0(gZ(),1);function b1(J){return new EV.default().update(RV.default("sha256").update(J).digest()).digest()}class CV{constructor(J,$){this.psbt=J,this.masterFp=$}}class N$ extends CV{spendingCondition(J){if(J.length!=1)throw new Error("Expected single key, got "+J.length);return this.singleKeyCondition(J[0])}setInput(J,$,Z,G,U){if(G.length!=1)throw new Error("Expected single key, got "+G.length);if(U.length!=1)throw new Error("Expected single path, got "+U.length);this.setSingleKeyInput(J,$,Z,G[0],U[0])}setOwnOutput(J,$,Z,G){if(Z.length!=1)throw new Error("Expected single key, got "+Z.length);if(G.length!=1)throw new Error("Expected single path, got "+G.length);this.setSingleKeyOutput(J,$,Z[0],G[0])}}class yZ extends N${singleKeyCondition(J){let $=new b0,Z=b1(J);return $.writeSlice(Buffer.from([TQ,C$,xJ])),$.writeSlice(Z),$.writeSlice(Buffer.from([IQ,kQ])),{scriptPubKey:$.buffer()}}setSingleKeyInput(J,$,Z,G,U){if(!$)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(J,$),this.psbt.setInputBip32Derivation(J,G,this.masterFp,U)}setSingleKeyOutput(J,$,Z,G){this.psbt.setOutputBip32Derivation(J,Z,this.masterFp,G)}getDescriptorTemplate(){return"pkh(@0)"}}class fZ extends N${singleKeyCondition(J){let $=J.slice(1),Z=new b0,G=this.getTaprootOutputKey($);return Z.writeSlice(Buffer.from([81,32])),Z.writeSlice(G),{scriptPubKey:Z.buffer()}}setSingleKeyInput(J,$,Z,G,U){let O=G.slice(1);this.psbt.setInputTapBip32Derivation(J,O,[],this.masterFp,U),this.psbt.setInputWitnessUtxo(J,Z.amount,Z.cond.scriptPubKey)}setSingleKeyOutput(J,$,Z,G){let U=Z.slice(1);this.psbt.setOutputTapBip32Derivation(J,U,[],this.masterFp,G)}getDescriptorTemplate(){return"tr(@0)"}hashTapTweak(J){let $=wZ.crypto.sha256(Buffer.from("TapTweak","utf-8"));return wZ.crypto.sha256(Buffer.concat([$,$,J]))}getTaprootOutputKey(J){if(J.length!=32)throw new Error("Expected 32 byte pubkey. Got "+J.length);let $=Buffer.concat([Buffer.from([2]),J]),Z=this.hashTapTweak(J);return Buffer.from(jV.pointAddScalar($,Z)).slice(1)}}class cZ extends N${singleKeyCondition(J){let $=new b0,Z=this.createRedeemScript(J),G=b1(Z);return $.writeSlice(Buffer.from([C$,xJ])),$.writeSlice(G),$.writeUInt8(MV),{scriptPubKey:$.buffer(),redeemScript:Z}}setSingleKeyInput(J,$,Z,G,U){if(!$)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(J,$),this.psbt.setInputBip32Derivation(J,G,this.masterFp,U);let O=Z.cond.redeemScript,D=this.createRedeemScript(G);if(O&&!D.equals(O))throw new Error(`User-supplied redeemScript ${O.toString("hex")} doesn't
       match expected ${D.toString("hex")} for input ${J}`);this.psbt.setInputRedeemScript(J,D),this.psbt.setInputWitnessUtxo(J,Z.amount,Z.cond.scriptPubKey)}setSingleKeyOutput(J,$,Z,G){this.psbt.setOutputRedeemScript(J,$.redeemScript),this.psbt.setOutputBip32Derivation(J,Z,this.masterFp,G)}getDescriptorTemplate(){return"sh(wpkh(@0))"}createRedeemScript(J){let $=b1(J);return Buffer.concat([Buffer.from("0014","hex"),$])}}class hZ extends N${singleKeyCondition(J){let $=new b0,Z=b1(J);return $.writeSlice(Buffer.from([0,xJ])),$.writeSlice(Z),{scriptPubKey:$.buffer()}}setSingleKeyInput(J,$,Z,G,U){if(!$)throw new Error("Full input base transaction required");this.psbt.setInputNonWitnessUtxo(J,$),this.psbt.setInputBip32Derivation(J,G,this.masterFp,U),this.psbt.setInputWitnessUtxo(J,Z.amount,Z.cond.scriptPubKey)}setSingleKeyOutput(J,$,Z,G){this.psbt.setOutputBip32Derivation(J,Z,this.masterFp,G)}getDescriptorTemplate(){return"wpkh(@0)"}}var NV=d0(SJ(),1);var dZ=d0(SJ(),1);class Z1{constructor(J,$=dZ.crypto.sha256){this.leaves=J,this.h=$;let Z=this.calculateRoot(J);this.rootNode=Z.root,this.leafNodes=Z.leaves}getRoot(){return this.rootNode.hash}size(){return this.leaves.length}getLeaves(){return this.leaves}getLeafHash(J){return this.leafNodes[J].hash}getProof(J){if(J>=this.leaves.length)throw Error("Index out of bounds");return bZ(this.leafNodes[J])}calculateRoot(J){let $=J.length;if($==0)return{root:new xQ(void 0,void 0,Buffer.alloc(32,0)),leaves:[]};if($==1){let E=new xQ(void 0,void 0,J[0]);return{root:E,leaves:[E]}}let Z=uD($),G=this.calculateRoot(J.slice(0,Z)),U=this.calculateRoot(J.slice(Z)),O=G.root,D=U.root,F=this.hashNode(O.hash,D.hash),K=new xQ(O,D,F);return O.parent=K,D.parent=K,{root:K,leaves:G.leaves.concat(U.leaves)}}hashNode(J,$){return this.h(Buffer.concat([Buffer.from([1]),J,$]))}}function A1(J,$=dZ.crypto.sha256){return pD(Buffer.from([0]),J,$)}function pD(J,$,Z){return Z(Buffer.concat([J,$]))}class xQ{constructor(J,$,Z){this.leftChild=J,this.rightChild=$,this.hash=Z}isLeaf(){return this.leftChild==null}}function bZ(J){if(!J.parent)return[];if(J.parent.leftChild==J){if(!J.parent.rightChild)throw new Error("Expected right child to exist");return[J.parent.rightChild.hash,...bZ(J.parent)]}else{if(!J.parent.leftChild)throw new Error("Expected left child to exist");return[J.parent.leftChild.hash,...bZ(J.parent)]}}function uD(J){if(J<2)throw Error("Expected n >= 2");if(rD(J))return J/2;return 1<<Math.floor(Math.log2(J))}function rD(J){return(J&J-1)==0}class gQ{constructor(J,$){this.descriptorTemplate=J,this.keys=[$]}getWalletId(){return NV.crypto.sha256(this.serialize())}serialize(){let J=this.keys.map((G)=>{return Buffer.from(G,"ascii")}),$=new Z1(J.map((G)=>A1(G))),Z=new b0;return Z.writeUInt8(1),Z.writeUInt8(0),Z.writeVarSlice(Buffer.from(this.descriptorTemplate,"ascii")),Z.writeVarInt(this.keys.length),Z.writeSlice($.getRoot()),Z.buffer()}}function lZ(J,$,Z){let G=IJ($);return`[${J.toString("hex")}${G.substring(1)}]${Z}/**`}function _V(J){var $,Z;let G=new b0;G.writeUInt32(J.getGlobalTxVersion());let U=!!J.getInputWitnessUtxo(0);if(U)G.writeSlice(Buffer.from([0,1]));let O=J.getGlobalInputCount();G.writeVarInt(O);let D=new b0;for(let K=0;K<O;K++)if(G.writeSlice(J.getInputPreviousTxid(K)),G.writeUInt32(J.getInputOutputIndex(K)),G.writeVarSlice(($=J.getInputFinalScriptsig(K))!==null&&$!==void 0?$:Buffer.from([])),G.writeUInt32(J.getInputSequence(K)),U)D.writeSlice(J.getInputFinalScriptwitness(K));let F=J.getGlobalOutputCount();G.writeVarInt(F);for(let K=0;K<F;K++)G.writeUInt64(J.getOutputAmount(K)),G.writeVarSlice(J.getOutputScript(K));return G.writeSlice(D.buffer()),G.writeUInt32((Z=J.getGlobalFallbackLocktime())!==null&&Z!==void 0?Z:0),G.buffer()}var a0;(function(J){J[J.TX_VERSION=2]="TX_VERSION",J[J.FALLBACK_LOCKTIME=3]="FALLBACK_LOCKTIME",J[J.INPUT_COUNT=4]="INPUT_COUNT",J[J.OUTPUT_COUNT=5]="OUTPUT_COUNT",J[J.TX_MODIFIABLE=6]="TX_MODIFIABLE",J[J.VERSION=251]="VERSION"})(a0||(a0={}));var j0;(function(J){J[J.NON_WITNESS_UTXO=0]="NON_WITNESS_UTXO",J[J.WITNESS_UTXO=1]="WITNESS_UTXO",J[J.PARTIAL_SIG=2]="PARTIAL_SIG",J[J.SIGHASH_TYPE=3]="SIGHASH_TYPE",J[J.REDEEM_SCRIPT=4]="REDEEM_SCRIPT",J[J.BIP32_DERIVATION=6]="BIP32_DERIVATION",J[J.FINAL_SCRIPTSIG=7]="FINAL_SCRIPTSIG",J[J.FINAL_SCRIPTWITNESS=8]="FINAL_SCRIPTWITNESS",J[J.PREVIOUS_TXID=14]="PREVIOUS_TXID",J[J.OUTPUT_INDEX=15]="OUTPUT_INDEX",J[J.SEQUENCE=16]="SEQUENCE",J[J.TAP_KEY_SIG=19]="TAP_KEY_SIG",J[J.TAP_BIP32_DERIVATION=22]="TAP_BIP32_DERIVATION"})(j0||(j0={}));var X1;(function(J){J[J.REDEEM_SCRIPT=0]="REDEEM_SCRIPT",J[J.BIP_32_DERIVATION=2]="BIP_32_DERIVATION",J[J.AMOUNT=3]="AMOUNT",J[J.SCRIPT=4]="SCRIPT",J[J.TAP_BIP32_DERIVATION=7]="TAP_BIP32_DERIVATION"})(X1||(X1={}));var nD=Buffer.from([112,115,98,116,255]);class vV extends Error{}class P${constructor(){this.globalMap=new Map,this.inputMaps=[],this.outputMaps=[]}setGlobalTxVersion(J){this.setGlobal(a0.TX_VERSION,gJ(J))}getGlobalTxVersion(){return this.getGlobal(a0.TX_VERSION).readUInt32LE(0)}setGlobalFallbackLocktime(J){this.setGlobal(a0.FALLBACK_LOCKTIME,gJ(J))}getGlobalFallbackLocktime(){var J;return(J=this.getGlobalOptional(a0.FALLBACK_LOCKTIME))===null||J===void 0?void 0:J.readUInt32LE(0)}setGlobalInputCount(J){this.setGlobal(a0.INPUT_COUNT,PV(J))}getGlobalInputCount(){return BV(this.getGlobal(a0.INPUT_COUNT))}setGlobalOutputCount(J){this.setGlobal(a0.OUTPUT_COUNT,PV(J))}getGlobalOutputCount(){return BV(this.getGlobal(a0.OUTPUT_COUNT))}setGlobalTxModifiable(J){this.setGlobal(a0.TX_MODIFIABLE,J)}getGlobalTxModifiable(){return this.getGlobalOptional(a0.TX_MODIFIABLE)}setGlobalPsbtVersion(J){this.setGlobal(a0.VERSION,gJ(J))}getGlobalPsbtVersion(){return this.getGlobal(a0.VERSION).readUInt32LE(0)}setInputNonWitnessUtxo(J,$){this.setInput(J,j0.NON_WITNESS_UTXO,k0(),$)}getInputNonWitnessUtxo(J){return this.getInputOptional(J,j0.NON_WITNESS_UTXO,k0())}setInputWitnessUtxo(J,$,Z){let G=new b0;G.writeSlice($),G.writeVarSlice(Z),this.setInput(J,j0.WITNESS_UTXO,k0(),G.buffer())}getInputWitnessUtxo(J){let $=this.getInputOptional(J,j0.WITNESS_UTXO,k0());if(!$)return;let Z=new O1($);return{amount:Z.readSlice(8),scriptPubKey:Z.readVarSlice()}}setInputPartialSig(J,$,Z){this.setInput(J,j0.PARTIAL_SIG,$,Z)}getInputPartialSig(J,$){return this.getInputOptional(J,j0.PARTIAL_SIG,$)}setInputSighashType(J,$){this.setInput(J,j0.SIGHASH_TYPE,k0(),gJ($))}getInputSighashType(J){let $=this.getInputOptional(J,j0.SIGHASH_TYPE,k0());if(!$)return;return $.readUInt32LE(0)}setInputRedeemScript(J,$){this.setInput(J,j0.REDEEM_SCRIPT,k0(),$)}getInputRedeemScript(J){return this.getInputOptional(J,j0.REDEEM_SCRIPT,k0())}setInputBip32Derivation(J,$,Z,G){if($.length!=33)throw new Error("Invalid pubkey length: "+$.length);this.setInput(J,j0.BIP32_DERIVATION,$,this.encodeBip32Derivation(Z,G))}getInputBip32Derivation(J,$){let Z=this.getInputOptional(J,j0.BIP32_DERIVATION,$);if(!Z)return;return this.decodeBip32Derivation(Z)}setInputFinalScriptsig(J,$){this.setInput(J,j0.FINAL_SCRIPTSIG,k0(),$)}getInputFinalScriptsig(J){return this.getInputOptional(J,j0.FINAL_SCRIPTSIG,k0())}setInputFinalScriptwitness(J,$){this.setInput(J,j0.FINAL_SCRIPTWITNESS,k0(),$)}getInputFinalScriptwitness(J){return this.getInput(J,j0.FINAL_SCRIPTWITNESS,k0())}setInputPreviousTxId(J,$){this.setInput(J,j0.PREVIOUS_TXID,k0(),$)}getInputPreviousTxid(J){return this.getInput(J,j0.PREVIOUS_TXID,k0())}setInputOutputIndex(J,$){this.setInput(J,j0.OUTPUT_INDEX,k0(),gJ($))}getInputOutputIndex(J){return this.getInput(J,j0.OUTPUT_INDEX,k0()).readUInt32LE(0)}setInputSequence(J,$){this.setInput(J,j0.SEQUENCE,k0(),gJ($))}getInputSequence(J){var $,Z;return(Z=($=this.getInputOptional(J,j0.SEQUENCE,k0()))===null||$===void 0?void 0:$.readUInt32LE(0))!==null&&Z!==void 0?Z:4294967295}setInputTapKeySig(J,$){this.setInput(J,j0.TAP_KEY_SIG,k0(),$)}getInputTapKeySig(J){return this.getInputOptional(J,j0.TAP_KEY_SIG,k0())}setInputTapBip32Derivation(J,$,Z,G,U){if($.length!=32)throw new Error("Invalid pubkey length: "+$.length);let O=this.encodeTapBip32Derivation(Z,G,U);this.setInput(J,j0.TAP_BIP32_DERIVATION,$,O)}getInputTapBip32Derivation(J,$){let Z=this.getInput(J,j0.TAP_BIP32_DERIVATION,$);return this.decodeTapBip32Derivation(Z)}getInputKeyDatas(J,$){return this.getKeyDatas(this.inputMaps[J],$)}setOutputRedeemScript(J,$){this.setOutput(J,X1.REDEEM_SCRIPT,k0(),$)}getOutputRedeemScript(J){return this.getOutput(J,X1.REDEEM_SCRIPT,k0())}setOutputBip32Derivation(J,$,Z,G){this.setOutput(J,X1.BIP_32_DERIVATION,$,this.encodeBip32Derivation(Z,G))}getOutputBip32Derivation(J,$){let Z=this.getOutput(J,X1.BIP_32_DERIVATION,$);return this.decodeBip32Derivation(Z)}setOutputAmount(J,$){this.setOutput(J,X1.AMOUNT,k0(),aD($))}getOutputAmount(J){let $=this.getOutput(J,X1.AMOUNT,k0());return xZ($)}setOutputScript(J,$){this.setOutput(J,X1.SCRIPT,k0(),$)}getOutputScript(J){return this.getOutput(J,X1.SCRIPT,k0())}setOutputTapBip32Derivation(J,$,Z,G,U){let O=this.encodeTapBip32Derivation(Z,G,U);this.setOutput(J,X1.TAP_BIP32_DERIVATION,$,O)}getOutputTapBip32Derivation(J,$){let Z=this.getOutput(J,X1.TAP_BIP32_DERIVATION,$);return this.decodeTapBip32Derivation(Z)}deleteInputEntries(J,$){this.inputMaps[J].forEach((G,U,O)=>{if(this.isKeyType(U,$))O.delete(U)})}copy(J){this.copyMap(this.globalMap,J.globalMap),this.copyMaps(this.inputMaps,J.inputMaps),this.copyMaps(this.outputMaps,J.outputMaps)}copyMaps(J,$){J.forEach((Z,G)=>{let U=new Map;this.copyMap(Z,U),$[G]=U})}copyMap(J,$){J.forEach((Z,G)=>$.set(G,Buffer.from(Z)))}serialize(){let J=new b0;return J.writeSlice(Buffer.from([112,115,98,116,255])),mZ(J,this.globalMap),this.inputMaps.forEach(($)=>{mZ(J,$)}),this.outputMaps.forEach(($)=>{mZ(J,$)}),J.buffer()}deserialize(J){let $=new O1(J);if(!$.readSlice(5).equals(nD))throw new Error("Invalid magic bytes");while(this.readKeyPair(this.globalMap,$));for(let Z=0;Z<this.getGlobalInputCount();Z++){this.inputMaps[Z]=new Map;while(this.readKeyPair(this.inputMaps[Z],$));}for(let Z=0;Z<this.getGlobalOutputCount();Z++){this.outputMaps[Z]=new Map;while(this.readKeyPair(this.outputMaps[Z],$));}}readKeyPair(J,$){let Z=$.readVarInt();if(Z==0)return!1;let G=$.readUInt8(),U=$.readSlice(Z-1),O=$.readVarSlice();return oZ(J,G,U,O),!0}getKeyDatas(J,$){let Z=[];return J.forEach((G,U)=>{if(this.isKeyType(U,[$]))Z.push(Buffer.from(U.substring(2),"hex"))}),Z}isKeyType(J,$){let Z=Buffer.from(J.substring(0,2),"hex").readUInt8(0);return $.some((G)=>G==Z)}setGlobal(J,$){let Z=new B$(J,Buffer.from([]));this.globalMap.set(Z.toString(),$)}getGlobal(J){return _$(this.globalMap,J,k0(),!1)}getGlobalOptional(J){return _$(this.globalMap,J,k0(),!0)}setInput(J,$,Z,G){oZ(this.getMap(J,this.inputMaps),$,Z,G)}getInput(J,$,Z){return _$(this.inputMaps[J],$,Z,!1)}getInputOptional(J,$,Z){return _$(this.inputMaps[J],$,Z,!0)}setOutput(J,$,Z,G){oZ(this.getMap(J,this.outputMaps),$,Z,G)}getOutput(J,$,Z){return _$(this.outputMaps[J],$,Z,!1)}getMap(J,$){if($[J])return $[J];return $[J]=new Map}encodeBip32Derivation(J,$){let Z=new b0;return this.writeBip32Derivation(Z,J,$),Z.buffer()}decodeBip32Derivation(J){let $=new O1(J);return this.readBip32Derivation($)}writeBip32Derivation(J,$,Z){J.writeSlice($),Z.forEach((G)=>{J.writeUInt32(G)})}readBip32Derivation(J){let $=J.readSlice(4),Z=[];while(J.offset<J.buffer.length)Z.push(J.readUInt32());return{masterFingerprint:$,path:Z}}encodeTapBip32Derivation(J,$,Z){let G=new b0;return G.writeVarInt(J.length),J.forEach((U)=>{G.writeSlice(U)}),this.writeBip32Derivation(G,$,Z),G.buffer()}decodeTapBip32Derivation(J){let $=new O1(J),Z=$.readVarInt(),G=[];for(let O=0;O<Z;O++)G.push($.readSlice(32));let U=this.readBip32Derivation($);return Object.assign({hashes:G},U)}}function _$(J,$,Z,G){if(!J)throw Error("No such map");let U=new B$($,Z),O=J.get(U.toString());if(!O){if(G)return;throw new vV(U.toString())}return Buffer.from(O)}class B${constructor(J,$){this.keyType=J,this.keyData=$}toString(){let J=new b0;return this.toBuffer(J),J.buffer().toString("hex")}serialize(J){J.writeVarInt(1+this.keyData.length),this.toBuffer(J)}toBuffer(J){J.writeUInt8(this.keyType),J.writeSlice(this.keyData)}}class SV{constructor(J,$){this.key=J,this.value=$}serialize(J){this.key.serialize(J),J.writeVarSlice(this.value)}}function sD(J){return new B$(J.readUInt8(0),J.slice(1))}function mZ(J,$){for(let Z of $.keys()){let G=$.get(Z);new SV(sD(Buffer.from(Z,"hex")),G).serialize(J)}J.writeUInt8(0)}function k0(){return Buffer.from([])}function oZ(J,$,Z,G){let U=new B$($,Z);J.set(U.toString(),G)}function gJ(J){let $=Buffer.alloc(4);return $.writeUInt32LE(J,0),$}function aD(J){return kZ(J)}function PV(J){let $=new b0;return $.writeVarInt(J),$.buffer()}function BV(J){return new O1(J).readVarInt()}function IV(J){let $=J.getGlobalInputCount();for(let Z=0;Z<$;Z++){let G=J.getInputKeyDatas(Z,j0.PARTIAL_SIG),U=J.getInputTapKeySig(Z);if(G.length==0&&!U)throw Error(`No signature for input ${Z} present`);if(G.length>0){if(G.length>1)throw Error(`Expected exactly one signature, got ${G.length}`);if(U)throw Error("Both taproot and non-taproot signatures present.");let O=!!J.getInputWitnessUtxo(Z),D=J.getInputRedeemScript(Z),F=!!D,K=J.getInputPartialSig(Z,G[0]);if(!K)throw new Error("Expected partial signature for input "+Z);if(O){let E=new b0;if(E.writeVarInt(2),E.writeVarInt(K.length),E.writeSlice(K),E.writeVarInt(G[0].length),E.writeSlice(G[0]),J.setInputFinalScriptwitness(Z,E.buffer()),F){if(!D||D.length==0)throw new Error("Expected non-empty redeemscript. Can't finalize intput "+Z);let R=new b0;R.writeUInt8(D.length),R.writeSlice(D),J.setInputFinalScriptsig(Z,R.buffer())}}else{let E=new b0;TV(E,K),TV(E,G[0]),J.setInputFinalScriptsig(Z,E.buffer())}}else{let O=J.getInputTapKeySig(Z);if(!O)throw Error("No taproot signature found");if(O.length!=64&&O.length!=65)throw Error("Unexpected length of schnorr signature.");let D=new b0;D.writeVarInt(1),D.writeVarSlice(O),J.setInputFinalScriptwitness(Z,D.buffer())}iD(J,Z)}}function iD(J,$){let Z=[j0.BIP32_DERIVATION,j0.PARTIAL_SIG,j0.TAP_BIP32_DERIVATION,j0.TAP_KEY_SIG],G=!!J.getInputWitnessUtxo($),U=!!J.getInputNonWitnessUtxo($);if(G&&U)Z.push(j0.NON_WITNESS_UTXO);J.deleteInputEntries($,Z)}function TV(J,$){if($.length<=75)J.writeUInt8($.length);else if($.length<=256)J.writeUInt8(76),J.writeUInt8($.length);else if($.length<=65536){J.writeUInt8(77);let Z=Buffer.alloc(2);Z.writeUInt16LE($.length,0),J.writeSlice(Z)}J.writeSlice($)}function WJ(J,$){if(J[$]<253)return[J[$],1];if(J[$]===253)return[(J[$+2]<<8)+J[$+1],3];if(J[$]===254)return[(J[$+4]<<24)+(J[$+3]<<16)+(J[$+2]<<8)+J[$+1],5];throw new Error("getVarint called with unexpected parameters")}function h0(J){if(J<253){let Z=Buffer.alloc(1);return Z[0]=J,Z}if(J<=65535){let Z=Buffer.alloc(3);return Z[0]=253,Z[1]=J&255,Z[2]=J>>8&255,Z}let $=Buffer.alloc(5);return $[0]=254,$[1]=J&255,$[2]=J>>8&255,$[3]=J>>16&255,$[4]=J>>24&255,$}function pZ({outputs:J}){let $=Buffer.alloc(0);if(typeof J!=="undefined")$=Buffer.concat([$,h0(J.length)]),J.forEach((Z)=>{$=Buffer.concat([$,Z.amount,h0(Z.script.length),Z.script])});return $}function wJ(J,$,Z,G=[]){let U=G.includes("decred"),O=G.includes("zcash"),D=G.includes("bech32"),F=Buffer.alloc(0),K=typeof J.witness!="undefined"&&!$;J.inputs.forEach((R)=>{F=U||D?Buffer.concat([F,R.prevout,Buffer.from([0]),R.sequence]):Buffer.concat([F,R.prevout,h0(R.script.length),R.script,R.sequence])});let E=pZ(J);if(typeof J.outputs!=="undefined"&&typeof J.locktime!=="undefined")E=Buffer.concat([E,K&&J.witness||Buffer.alloc(0),J.locktime,J.nExpiryHeight||Buffer.alloc(0),J.extraData||Buffer.alloc(0)]);if(O)return Buffer.concat([J.version,J.nVersionGroupId||Buffer.alloc(0),Buffer.from([180,208,214,194]),J.locktime||Buffer.from([0,0,0,0]),J.nExpiryHeight||Buffer.from([0,0,0,0]),K?Buffer.from("0001","hex"):Buffer.alloc(0),h0(J.inputs.length),F,E]);return Buffer.concat([J.version,Z?Z:Buffer.alloc(0),J.nVersionGroupId||Buffer.alloc(0),K?Buffer.from("0001","hex"):Buffer.alloc(0),h0(J.inputs.length),F,E])}var d1=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})};class wQ{constructor(J){this.client=J}getWalletXpub(J){return d1(this,arguments,void 0,function*({path:$,xpubVersion:Z}){let G=V1($),U=yield this.client.getExtendedPubkey(!1,G),O=IZ(U);if(O.version!=Z)throw new Error(`Expected xpub version ${Z} doesn't match the xpub version from the device ${O.version}`);return U})}getWalletPublicKey(J,$){return d1(this,void 0,void 0,function*(){var Z,G;if(!U9(J))throw Error(`non-standard path: ${J}`);let U=V1(J),O=yield this.client.getExtendedPubkey(!1,U),D=(Z=$===null||$===void 0?void 0:$.verify)!==null&&Z!==void 0?Z:!1,F=yield this.getWalletAddress(U,tD((G=$===null||$===void 0?void 0:$.format)!==null&&G!==void 0?G:"legacy"),D),K=IZ(O);return{publicKey:Buffer.from(yV.pointCompress(K.pubkey,!1)).toString("hex"),bitcoinAddress:F,chainCode:K.chaincode.toString("hex")}})}getWalletAddress(J,$,Z){return d1(this,void 0,void 0,function*(){let G=HV(J);if(G.length+2!=J.length)return"";let U=yield this.client.getExtendedPubkey(!1,G),O=yield this.client.getMasterFingerprint(),D=new gQ($,lZ(O,G,U)),F=J.slice(-2,J.length);return this.client.getWalletAddress(D,Buffer.alloc(32,0),F[0],F[1],Z)})}createPaymentTransaction(J){return d1(this,void 0,void 0,function*(){let $=J.inputs.length;if($==0)throw Error("No inputs");let Z=new P$,G=yield this.client.getMasterFingerprint(),U=eD(J,Z,G);if(J.lockTime!=null)Z.setGlobalFallbackLocktime(J.lockTime);Z.setGlobalInputCount($),Z.setGlobalPsbtVersion(2),Z.setGlobalTxVersion(2);let O=0,D=()=>{if(!J.onDeviceStreaming)return;J.onDeviceStreaming({total:2*$,index:O,progress:++O/(2*$)})},F="",K=[];for(let k=0;k<$;k++){D();let S=V1(J.associatedKeysets[k]);if(F=="")K=S.slice(0,-2),F=yield this.client.getExtendedPubkey(!1,K);yield this.setInput(Z,k,J.inputs[k],S,U,G,J.sigHashType)}let E=Buffer.from(J.outputScriptHex,"hex"),R=new O1(E),C=R.readVarInt();Z.setGlobalOutputCount(C);let v=yield this.outputScriptAt(K,U,J.changePath),c=!v;for(let k=0;k<C;k++){let S=Number(R.readUInt64()),P0=R.readVarSlice();if(Z.setOutputAmount(k,S),Z.setOutputScript(k,P0),v&&P0.equals(v===null||v===void 0?void 0:v.cond.scriptPubKey)){c=!0;let S0=V1(J.changePath),T=v.pubkey;U.setOwnOutput(k,v.cond,[T],[S0])}}if(!c)throw new Error("Change script not found among outputs! "+(v===null||v===void 0?void 0:v.cond.scriptPubKey.toString("hex")));let N0=lZ(G,K,F),C0=new gQ(U.getDescriptorTemplate(),N0);if(J.onDeviceSignatureRequested)J.onDeviceSignatureRequested();let _0=!1,f=()=>{if(!_0)_0=!0,J.onDeviceSignatureGranted&&J.onDeviceSignatureGranted();D()};return yield this.signPsbt(Z,C0,f),IV(Z),_V(Z).toString("hex")})}signMessage(J){return d1(this,arguments,void 0,function*({path:$,messageHex:Z}){let G=V1($),U=Buffer.from(Z,"hex"),O=yield this.client.signMessage(U,G),D=Buffer.from(O,"base64"),F=D.readUInt8()-27-4,K=D.slice(1,33).toString("hex"),E=D.slice(33,65).toString("hex");return{v:F,r:K,s:E}})}outputScriptAt(J,$,Z){return d1(this,void 0,void 0,function*(){if(!Z)return;let G=V1(Z);for(let F=0;F<J.length;F++)if(J[F]!=G[F])throw new Error(`Path ${Z} not in account ${IJ(J)}`);let U=yield this.client.getExtendedPubkey(!1,G),O=TZ(U);return{cond:$.spendingCondition([O]),pubkey:O}})}setInput(J,$,Z,G,U,O,D){return d1(this,void 0,void 0,function*(){let F=Z[0],K=Z[1],E=Z[2]?Buffer.from(Z[2],"hex"):void 0,R=Z[3];if(R!=null)J.setInputSequence($,R);if(D!=null)J.setInputSighashType($,D);let C=wJ(F,!0),v=wV.crypto.hash256(C),c=yield this.client.getExtendedPubkey(!1,G),N0=TZ(c);if(!F.outputs)throw Error("Missing outputs array in transaction to sign");let C0=F.outputs[K],f={cond:{scriptPubKey:C0.script,redeemScript:E},amount:C0.amount};U.setInput($,C,f,[N0],[G]),J.setInputPreviousTxId($,v),J.setInputOutputIndex($,K)})}signPsbt(J,$,Z){return d1(this,void 0,void 0,function*(){(yield this.client.signPsbt(J,$,Buffer.alloc(32,0),Z)).forEach((U,O)=>{let D=J.getInputKeyDatas(O,j0.BIP32_DERIVATION),F;if(D.length!=1){if(F=J.getInputKeyDatas(O,j0.TAP_BIP32_DERIVATION),F.length==0)throw Error(`Missing pubkey derivation for input ${O}`);J.setInputTapKeySig(O,U)}else F=D[0],J.setInputPartialSig(O,F,U)})})}}function tD(J){if(J=="legacy")return"pkh(@0)";if(J=="p2sh")return"sh(wpkh(@0))";if(J=="bech32")return"wpkh(@0)";if(J=="bech32m")return"tr(@0)";throw new Error("Unsupported address format "+J)}function eD(J,$,Z){if(J.additionals.includes("bech32m"))return new fZ($,Z);if(J.additionals.includes("bech32"))return new hZ($,Z);if(J.segwit)return new cZ($,Z);return new yZ($,Z)}var v$=2147483648,J9=[0,1,88],$9=[44,49,84,86],Q9=[48],uZ=(J)=>J>=v$,kV=(J)=>J===void 0||J<v$,xV=(J)=>J===void 0||J===0||J===1,gV=new Set(J9.map((J)=>J+v$)),Z9=new Set($9.map((J)=>J+v$)),X9=new Set(Q9.map((J)=>J+v$));function U9(J){let $=V1(J);if($.length>=3&&$.length<=5&&Z9.has($[0])&&gV.has($[1])&&uZ($[2])&&xV($[3])&&kV($[4]))return!0;if($.length>=4&&$.length<=6&&X9.has($[0])&&gV.has($[1])&&uZ($[2])&&uZ($[3])&&xV($[4])&&kV($[5]))return!0;return!1}var tV=d0(D9(),1),eV=d0(KV(),1),JO=d0(gZ(),1);var Y9=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})},fV={legacy:0,p2sh:1,bech32:2,cashaddr:3};function S$(J,$){return Y9(this,void 0,void 0,function*(){let{path:Z,verify:G,format:U}=Object.assign({verify:!1,format:"legacy"},$);if(!(U in fV))throw new Error("btc.getWalletPublicKey invalid format="+U);let O=TJ(Z),D=G?1:0,F=fV[U],K=yield J.send(224,64,D,F,O),E=K[0],R=K[1+E],C=K.slice(1,1+E).toString("hex"),v=K.slice(1+E+1,1+E+1+R).toString("ascii"),c=K.slice(1+E+1+R,1+E+1+R+32).toString("hex");return{publicKey:C,bitcoinAddress:v,chainCode:c}})}var hV=d0(rZ(),1);var nZ=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})};function yJ(J,$,Z){return nZ(this,void 0,void 0,function*(){let G,U=!1;if(typeof Z==="number"){U=!0;let F=Buffer.alloc(4);F.writeUInt32BE(Z,0),G=Buffer.concat([F,$],$.length+4)}else G=$;let O=yield J.send(224,66,U?0:128,0,G);return O.slice(0,O.length-2).toString("hex")})}function fJ(J,$,Z){return nZ(this,arguments,void 0,function*(G,U,O,D=[]){let{version:F,inputs:K,outputs:E,locktime:R,nExpiryHeight:C,extraData:v}=O;if(!E||!R)throw new Error("getTrustedInput: locktime & outputs is expected");let c=D.includes("decred"),N0=D.includes("stealthcoin"),C0=(S,P0)=>nZ(this,void 0,void 0,function*(){let h=P0||Buffer.alloc(0),S0=[],T=0;while(T!==S.length){let W=S.length-T>Q1?Q1:S.length-T;if(T+W!==S.length)S0.push(S.slice(T,T+W));else S0.push(Buffer.concat([S.slice(T,T+W),h]));T+=W}if(S.length===0)S0.push(h);let T0;for(let W of S0)T0=yield yJ(G,W);return T0}),_0=(S)=>yJ(G,S);yield yJ(G,Buffer.concat([O.version,O.timestamp||Buffer.alloc(0),O.nVersionGroupId||Buffer.alloc(0),h0(K.length)]),U);for(let S of K){let P0=N0&&Buffer.compare(F,Buffer.from([2,0,0,0]))===0,h=c?S.tree||Buffer.from([0]):Buffer.alloc(0),S0=Buffer.concat([S.prevout,h,P0?Buffer.from([0]):h0(S.script.length)]);yield yJ(G,S0),yield c?_0(Buffer.concat([S.script,S.sequence])):P0?_0(S.sequence):C0(S.script,S.sequence)}yield yJ(G,h0(E.length));for(let S of E){let P0=Buffer.concat([S.amount,c?Buffer.from([0,0]):Buffer.alloc(0),h0(S.script.length),S.script]);yield yJ(G,P0)}let f=[];if(C&&C.length>0)f.push(C);if(v&&v.length>0)f.push(v);let w;if(f.length){let S=Buffer.concat(f);w=c?S:Buffer.concat([h0(S.length),S])}let k=yield C0(Buffer.concat([R,w||Buffer.alloc(0)]));return hV.default(k,"missing result in processScriptBlocks"),k})}var V9=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})};function sZ(J,$,Z,G,U=!1,O=!1,D=[]){let F=D.includes("cashaddr")?3:U?D.includes("sapling")?5:O?4:2:0;return J.send(224,68,Z?0:128,$?F:128,G)}function cJ(J,$,Z,G){return V9(this,arguments,void 0,function*(U,O,D,F,K=!1,E=!1,R=[],C=!1){let v=Buffer.concat([D.version,D.timestamp||Buffer.alloc(0),D.nVersionGroupId||Buffer.alloc(0),h0(D.inputs.length)]);yield sZ(U,O,!0,v,K,E,R);let c=0,N0=R.includes("decred");for(let C0 of D.inputs){let _0,f=F[c].value;if(K)if(C&&F[c].trustedInput)_0=Buffer.from([1,f.length]);else _0=Buffer.from([2]);else if(F[c].trustedInput)_0=Buffer.from([1,F[c].value.length]);else _0=Buffer.from([0]);v=Buffer.concat([_0,f,N0?Buffer.from([0]):Buffer.alloc(0),h0(C0.script.length)]),yield sZ(U,O,!1,v,K,E,R);let w=[],k=0;if(C0.script.length===0)w.push(C0.sequence);else while(k!==C0.script.length){let S=C0.script.length-k>Q1?Q1:C0.script.length-k;if(k+S!==C0.script.length)w.push(C0.script.slice(k,k+S));else w.push(Buffer.concat([C0.script.slice(k,k+S),C0.sequence]));k+=S}for(let S of w)yield sZ(U,O,!1,S,K,E,R);c++}})}var aZ=d0(gZ(),1);function hJ(J,$,Z,G=[]){if(!Z)throw new Error("getTrustedInputBIP143: missing tx");if(G.includes("decred"))throw new Error("Decred does not implement BIP143");let O=aZ.default("sha256").update(aZ.default("sha256").update(wJ(Z,!0)).digest()).digest(),D=Buffer.alloc(4);D.writeUInt32LE($,0);let{outputs:F,locktime:K}=Z;if(!F||!K)throw new Error("getTrustedInputBIP143: locktime & outputs is expected");if(!F[$])throw new Error("getTrustedInputBIP143: wrong index");return O=Buffer.concat([O,D,F[$].amount]),O.toString("hex")}function bV(J){let $=(J[64]&1)!==0?3:2,Z=Buffer.alloc(1);return Z[0]=$,Buffer.concat([Z,J.slice(1,33)])}function T$(J,$,Z,G,U,O=[]){let D=O.includes("decred"),F=TJ($),K=Buffer.alloc(4);K.writeUInt32BE(Z,0);let E=D?Buffer.concat([F,K,U||Buffer.from([0,0,0,0]),Buffer.from([G])]):Buffer.concat([F,Buffer.from([0]),K,Buffer.from([G])]);if(U&&!D)E=Buffer.concat([E,U]);return J.send(224,72,0,0,E).then((R)=>{if(R.length>0)return R[0]=48,R.slice(0,R.length-2);return R})}var O9=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})};function iZ(J,$){let Z=TJ($);return J.send(224,74,255,0,Z)}function bJ(J,$){return O9(this,arguments,void 0,function*(Z,G,U=[]){let O=0,D=Number(128);if(U.includes("decred"))return Z.send(224,74,D,0,G);while(O<G.length){let K=O+Q1>=G.length?G.length-O:Q1,E=O+K===G.length?128:0,R=G.slice(O,O+K);yield Z.send(224,74,E,0,R),O+=K}})}var lV=d0(rZ(),1),dV=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})},yQ=(J)=>dV(void 0,void 0,void 0,function*(){let $=yield J.send(176,1,0,0),Z=0,G=$[Z++];lV.default(G===1,"getAppAndVersion: format not supported");let U=$[Z++],O=$.slice(Z,Z+=U).toString("ascii"),D=$[Z++],F=$.slice(Z,Z+=D).toString("ascii"),K=$[Z++],E=$.slice(Z,Z+=K);return{name:O,version:F,flags:E}}),mV=(J)=>dV(void 0,void 0,void 0,function*(){try{yield J.send(224,196,0,0)}catch($){return!1}return!0});var pV=d0(oV(),1);function uV({version:J,name:$}){if($==="Decred")return!1;if($==="Exchange")return!0;return pV.default.gte(J,"1.4.0")}var A9=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})},q9={lockTime:SQ,sigHashType:j$,segwit:!1,additionals:[],onDeviceStreaming:(J)=>{},onDeviceSignatureGranted:()=>{},onDeviceSignatureRequested:()=>{}};function rV(J,$){return A9(this,void 0,void 0,function*(){let Z=Object.assign(Object.assign({},q9),$),{inputs:G,associatedKeysets:U,changePath:O,outputScriptHex:D,lockTime:F,sigHashType:K,segwit:E,initialTimestamp:R,additionals:C,expiryHeight:v,onDeviceStreaming:c,onDeviceSignatureGranted:N0,onDeviceSignatureRequested:C0}=Z,_0=Z.useTrustedInputForSegwit;if(_0===void 0)try{let j=yield yQ(J);_0=uV(j)}catch(j){if(j.statusCode===27904)_0=!1;else throw j}let f=(j,P)=>{let{length:B}=G;if(B<3)return;let I=B*j+P,y0=2*B,g=I/y0;c({progress:g,total:y0,index:I})},w=C.includes("decred"),k=C.includes("zcash"),S=C.includes("stealthcoin"),P0=Date.now(),h=C.includes("sapling"),S0=E&&C.includes("bech32"),T=E||!!C&&(C.includes("abc")||C.includes("gold")||C.includes("bip143"))||!!v&&!w,T0=Buffer.alloc(4);T0.writeUInt32LE(F,0);let W=Buffer.alloc(0),Q=Buffer.alloc(0),Y=Buffer.alloc(4);!!v&&!w?Y.writeUInt32LE(k?2147483653:h?2147483652:2147483651,0):S?Y.writeUInt32LE(2,0):Y.writeUInt32LE(1,0);let V=[],A=[],L=[],H=[],M=!0,q=!1,X={inputs:[],version:Y,timestamp:Buffer.alloc(0)},z=T&&!_0?hJ:fJ,_=Buffer.from(D,"hex");f(0,0);for(let j of G){if(!q){let I=yield z(J,j[1],j[0],C);fQ("hw","got trustedInput="+I);let y0=Buffer.alloc(4);y0.writeUInt32LE(j.length>=4&&typeof j[3]==="number"?j[3]:kJ,0),V.push({trustedInput:!0,value:Buffer.from(I,"hex"),sequence:y0})}let{outputs:P}=j[0],B=j[1];if(P&&B<=P.length-1)A.push(P[B]);if(v&&!w)X.nVersionGroupId=Buffer.from(k?[10,39,167,38]:h?[133,32,47,137]:[112,130,196,3]),X.nExpiryHeight=v,X.extraData=Buffer.from(h?[0,0,0,0,0,0,0,0,0,0,0]:[0]);else if(w)X.nExpiryHeight=v}if(X.inputs=G.map((j,P)=>{let B=Buffer.alloc(4);return B.writeUInt32LE(j.length>=4&&typeof j[3]==="number"?j[3]:kJ,0),{script:k?A[P].script:W,prevout:Q,sequence:B}}),!q){let j=[];for(let P=0;P<G.length;P++){let B=yield S$(J,{path:U[P]});f(0,P+1),j.push(B)}for(let P=0;P<j.length;P++)H.push(bV(Buffer.from(j[P].publicKey,"hex")))}if(R!==void 0)X.timestamp=Buffer.alloc(4),X.timestamp.writeUInt32LE(Math.floor(R+(Date.now()-P0)/1000),0);if(C0(),T){if(yield cJ(J,!0,X,V,!0,!!v,C,_0),!q&&O)yield iZ(J,O);yield bJ(J,_)}if(!!v&&!w)yield T$(J,"",F,j$,v);for(let j=0;j<G.length;j++){let P=G[j],B=G[j].length>=3&&typeof P[2]==="string"?Buffer.from(P[2],"hex"):!E?A[j].script:Buffer.concat([Buffer.from([TQ,C$,xJ]),b1(H[j]),Buffer.from([IQ,kQ])]),I=Object.assign({},X),y0=T?[V[j]]:V;if(T)I.inputs=[Object.assign(Object.assign({},I.inputs[j]),{script:B})];else I.inputs[j].script=B;if(yield cJ(J,!T&&M,I,y0,T,!!v&&!w,C,_0),!T){if(!q&&O)yield iZ(J,O);yield bJ(J,_,C)}if(M)N0(),f(1,0);let g=yield T$(J,U[j],F,K,v,C);if(f(1,j+1),L.push(g),X.inputs[j].script=W,M)M=!1}for(let j=0;j<G.length;j++){if(E){if(X.witness=Buffer.alloc(0),!S0)X.inputs[j].script=Buffer.concat([Buffer.from("160014","hex"),b1(H[j])])}else{let B=Buffer.alloc(1),I=Buffer.alloc(1);B[0]=L[j].length,I[0]=H[j].length,X.inputs[j].script=Buffer.concat([B,L[j],I,H[j]])}let P=T&&!_0?0:4;X.inputs[j].prevout=V[j].value.slice(P,P+36)}X.locktime=T0;let N=Buffer.concat([wJ(X,!1,X.timestamp,C),_]);if(E&&!w){let j=Buffer.alloc(0);for(let P=0;P<G.length;P++){let B=Buffer.concat([Buffer.from("02","hex"),Buffer.from([L[P].length]),L[P],Buffer.from([H[P].length]),H[P]]);j=Buffer.concat([j,B])}N=Buffer.concat([N,j])}if(!k){if(N=Buffer.concat([N,T0]),v)N=Buffer.concat([N,X.nExpiryHeight||Buffer.alloc(0),X.extraData||Buffer.alloc(0)])}if(w){let j=Buffer.from([X.inputs.length]);G.forEach((P,B)=>{j=Buffer.concat([j,Buffer.from([0,0,0,0,0,0,0,0]),Buffer.from([0,0,0,0]),Buffer.from([255,255,255,255]),Buffer.from([X.inputs[B].script.length]),X.inputs[B].script])}),N=Buffer.concat([N,j])}if(k)N=Buffer.concat([N,Buffer.from([0,0,0])]);return N.toString("hex")})}var nV=d0(WV(),1);var z9=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})};function sV(J,$){return z9(this,arguments,void 0,function*(Z,{path:G,messageHex:U}){let O=nV.default.fromString(G).toPathArray(),D=Buffer.from(U,"hex"),F=0;while(F!==D.length){let v=F===0?Q1-1-O.length*4-4:Q1,c=F+v>D.length?D.length-F:v,N0=Buffer.alloc(F===0?1+O.length*4+2+c:c);if(F===0)N0[0]=O.length,O.forEach((C0,_0)=>{N0.writeUInt32BE(C0,1+4*_0)}),N0.writeUInt16BE(D.length,1+4*O.length),D.copy(N0,1+4*O.length+2,F,F+c);else D.copy(N0,0,F,F+c);yield Z.send(224,78,0,F===0?1:128,N0),F+=c}let K=yield Z.send(224,78,128,0,Buffer.from([0])),E=K[0]-48,R=K.slice(4,4+K[3]);if(R[0]===0)R=R.slice(1);R=R.toString("hex"),F=4+K[3]+2;let C=K.slice(F,F+K[F-1]);if(C[0]===0)C=C.slice(1);return C=C.toString("hex"),{v:E,r:R,s:C}})}var tZ=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})};class dJ{constructor(J){this.transport=J,this.derivationsCache={}}derivatePath(J){return tZ(this,void 0,void 0,function*(){if(this.derivationsCache[J])return this.derivationsCache[J];let $=yield S$(this.transport,{path:J});return this.derivationsCache[J]=$,$})}getWalletXpub(J){return tZ(this,arguments,void 0,function*({path:$,xpubVersion:Z}){let G=V1($),U=G.slice(0,-1),O=yield this.derivatePath(IJ(U)),D=yield this.derivatePath($),F=L9(iV(Buffer.from(O.publicKey,"hex")));return W9(Z,G.length,F,G[G.length-1],Buffer.from(D.chainCode,"hex"),iV(Buffer.from(D.publicKey,"hex")))})}getWalletPublicKey(J,$){if(($===null||$===void 0?void 0:$.format)==="bech32m")throw new Error("Unsupported address format bech32m");return S$(this.transport,Object.assign(Object.assign({},$),{path:J}))}createPaymentTransaction(J){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return rV(this.transport,J)}signMessage(J){return tZ(this,arguments,void 0,function*({path:$,messageHex:Z}){return sV(this.transport,{path:$,messageHex:Z})})}}function L9(J){return M9(J).slice(0,4)}function aV(J){let $=Buffer.allocUnsafe(4);return $.writeUInt32BE(J,0),$}var iV=(J)=>Buffer.concat([Buffer.from([2+(J[64]&1)]),J.slice(1,33)]);function W9(J,$,Z,G,U,O){let D=aV(G);D[0]|=128;let F=Buffer.concat([aV(J),Buffer.from([$]),Z,D,U,O]),K=H9(F).slice(0,4);return tV.default.encode(Buffer.concat([F,K]))}function eZ(J){return JO.default("sha256").update(J).digest()}function H9(J){return eZ(eZ(J))}function F9(J){return new eV.default().update(J).digest()}function M9(J){return F9(eZ(J))}class JX{constructor(J,$){if(J.length!=$.length)throw new Error("keys and values should have the same length");for(let Z=0;Z<J.length-1;Z++)if(J[Z].toString("hex")>=J[Z+1].toString("hex"))throw new Error("keys must be in strictly increasing order");this.keys=J,this.keysTree=new Z1(J.map((Z)=>A1(Z))),this.values=$,this.valuesTree=new Z1($.map((Z)=>A1(Z)))}commitment(){return Buffer.concat([h0(this.keys.length),this.keysTree.getRoot(),this.valuesTree.getRoot()])}}class lJ extends P${constructor(J){super();this.inputMerkleMaps=[],this.outputMerkleMaps=[],J.copy(this),this.globalMerkleMap=lJ.createMerkleMap(this.globalMap);for(let $=0;$<this.getGlobalInputCount();$++)this.inputMerkleMaps.push(lJ.createMerkleMap(this.inputMaps[$]));this.inputMapCommitments=[...this.inputMerkleMaps.values()].map(($)=>$.commitment());for(let $=0;$<this.getGlobalOutputCount();$++)this.outputMerkleMaps.push(lJ.createMerkleMap(this.outputMaps[$]));this.outputMapCommitments=[...this.outputMerkleMaps.values()].map(($)=>$.commitment())}getGlobalSize(){return this.globalMap.size}getGlobalKeysValuesRoot(){return this.globalMerkleMap.commitment()}static createMerkleMap(J){let $=[...J.keys()].sort(),Z=$.map((O)=>{let D=J.get(O);if(!D)throw new Error("No value for key "+O);return D}),G=$.map((O)=>Buffer.from(O,"hex"));return new JX(G,Z)}}var $O=d0(SJ(),1);var HJ;(function(J){J[J.YIELD=16]="YIELD",J[J.GET_PREIMAGE=64]="GET_PREIMAGE",J[J.GET_MERKLE_LEAF_PROOF=65]="GET_MERKLE_LEAF_PROOF",J[J.GET_MERKLE_LEAF_INDEX=66]="GET_MERKLE_LEAF_INDEX",J[J.GET_MORE_ELEMENTS=160]="GET_MORE_ELEMENTS"})(HJ||(HJ={}));class mJ{}class QO extends mJ{constructor(J,$){super();this.progressCallback=$,this.code=HJ.YIELD,this.results=J}execute(J){return this.results.push(Buffer.from(J.subarray(1))),this.progressCallback(),Buffer.from("")}}class ZO extends mJ{constructor(J,$){super();this.code=HJ.GET_PREIMAGE,this.known_preimages=J,this.queue=$}execute(J){let $=Buffer.from(J.subarray(1));if($.length!=33)throw new Error("Invalid request, unexpected trailing data");if($[0]!=0)throw new Error("Unsupported request, the first byte should be 0");let Z=Buffer.alloc(32);for(let O=0;O<32;O++)Z[O]=$[1+O];let G=Z.toString("hex"),U=this.known_preimages.get(G);if(U!=null){let O=h0(U.length),D=255-O.length-1,F=Math.min(D,U.length);if(F<U.length)for(let K=F;K<U.length;K++)this.queue.push(Buffer.from([U[K]]));return Buffer.concat([O,Buffer.from([F]),Buffer.from(U.subarray(0,F))])}throw Error(`Requested unknown preimage for: ${G}`)}}class XO extends mJ{constructor(J,$){super();this.code=HJ.GET_MERKLE_LEAF_PROOF,this.known_trees=J,this.queue=$}execute(J){let $=Buffer.from(J.subarray(1));if($.length<34)throw new Error("Invalid request, expected at least 34 bytes");let Z=new O1($),U=Z.readSlice(32).toString("hex"),O,D;try{O=Z.readVarInt(),D=Z.readVarInt()}catch(C){throw new Error("Invalid request, couldn't parse tree_size or leaf_index")}let F=this.known_trees.get(U);if(!F)throw Error(`Requested Merkle leaf proof for unknown tree: ${U}`);if(D>=O||F.size()!=O)throw Error("Invalid index or tree size.");if(this.queue.length!=0)throw Error("This command should not execute when the queue is not empty.");let K=F.getProof(D),E=Math.min(Math.floor(6.90625),K.length),R=K.length-E;if(R>0)this.queue.push(...K.slice(-R));return Buffer.concat([F.getLeafHash(D),Buffer.from([K.length]),Buffer.from([E]),...K.slice(0,E)])}}class UO extends mJ{constructor(J){super();this.code=HJ.GET_MERKLE_LEAF_INDEX,this.known_trees=J}execute(J){let $=Buffer.from(J.subarray(1));if($.length!=64)throw new Error("Invalid request, unexpected trailing data");let Z=Buffer.alloc(32);for(let E=0;E<32;E++)Z[E]=$.readUInt8(E);let G=Z.toString("hex"),U=Buffer.alloc(32);for(let E=0;E<32;E++)U[E]=$.readUInt8(32+E);let O=U.toString("hex"),D=this.known_trees.get(G);if(!D)throw Error(`Requested Merkle leaf index for unknown root: ${G}`);let F=0,K=0;for(let E=0;E<D.size();E++)if(D.getLeafHash(E).toString("hex")==O){K=1,F=E;break}return Buffer.concat([Buffer.from([K]),h0(F)])}}class YO extends mJ{constructor(J){super();this.code=HJ.GET_MORE_ELEMENTS,this.queue=J}execute(J){if(J.length!=1)throw new Error("Invalid request, unexpected trailing data");if(this.queue.length===0)throw new Error("No elements to get");let $=this.queue[0].length;if(this.queue.some((O)=>O.length!=$))throw new Error("The queue contains elements with different byte length, which is not expected");let Z=Math.floor(253/$),G=Math.min(Z,this.queue.length),U=this.queue.splice(0,G);return Buffer.concat([Buffer.from([G]),Buffer.from([$]),...U])}}class I${constructor(J){this.roots=new Map,this.preimages=new Map,this.yielded=[],this.queue=[],this.commands=new Map;let $=[new QO(this.yielded,J),new ZO(this.preimages,this.queue),new UO(this.roots),new XO(this.roots,this.queue),new YO(this.queue)];for(let Z of $){if(this.commands.has(Z.code))throw new Error(`Multiple commands with code ${Z.code}`);this.commands.set(Z.code,Z)}}getYielded(){return this.yielded}addKnownPreimage(J){this.preimages.set($O.crypto.sha256(J).toString("hex"),J)}addKnownList(J){for(let Z of J){let G=Buffer.concat([Buffer.from([0]),Z]);this.addKnownPreimage(G)}let $=new Z1(J.map((Z)=>A1(Z)));this.roots.set($.getRoot().toString("hex"),$)}addKnownMapping(J){this.addKnownList(J.keys),this.addKnownList(J.values)}execute(J){if(J.length==0)throw new Error("Unexpected empty command");let $=J[0],Z=this.commands.get($);if(!Z)throw new Error(`Unexpected command code ${$}`);return Z.execute(J)}}var oJ=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})},K9=225,E9=248,FJ;(function(J){J[J.GET_PUBKEY=0]="GET_PUBKEY",J[J.REGISTER_WALLET=2]="REGISTER_WALLET",J[J.GET_WALLET_ADDRESS=3]="GET_WALLET_ADDRESS",J[J.SIGN_PSBT=4]="SIGN_PSBT",J[J.GET_MASTER_FINGERPRINT=5]="GET_MASTER_FINGERPRINT",J[J.SIGN_MESSAGE=16]="SIGN_MESSAGE"})(FJ||(FJ={}));var $X;(function(J){J[J.CONTINUE_INTERRUPTED=1]="CONTINUE_INTERRUPTED"})($X||($X={}));class QX{constructor(J){this.transport=J}makeRequest(J,$,Z){return oJ(this,void 0,void 0,function*(){let G=yield this.transport.send(K9,J,0,0,$,[36864,57344]);while(G.readUInt16BE(G.length-2)===57344){if(!Z)throw new Error("Unexpected SW_INTERRUPTED_EXECUTION");let U=G.slice(0,-2),O=Z.execute(U);G=yield this.transport.send(E9,$X.CONTINUE_INTERRUPTED,0,0,O,[36864,57344])}return G.slice(0,-2)})}getExtendedPubkey(J,$){return oJ(this,void 0,void 0,function*(){if($.length>6)throw new Error("Path too long. At most 6 levels allowed.");return(yield this.makeRequest(FJ.GET_PUBKEY,Buffer.concat([Buffer.from(J?[1]:[0]),BQ($)]))).toString("ascii")})}getWalletAddress(J,$,Z,G,U){return oJ(this,void 0,void 0,function*(){if(Z!==0&&Z!==1)throw new Error("Change can only be 0 or 1");if(G<0||!Number.isInteger(G))throw new Error("Invalid address index");if($!=null&&$.length!=32)throw new Error("Invalid HMAC length");let O=new I$(()=>{});O.addKnownList(J.keys.map((K)=>Buffer.from(K,"ascii"))),O.addKnownPreimage(J.serialize());let D=Buffer.alloc(4);return D.writeUInt32BE(G,0),(yield this.makeRequest(FJ.GET_WALLET_ADDRESS,Buffer.concat([Buffer.from(U?[1]:[0]),J.getWalletId(),$||Buffer.alloc(32,0),Buffer.from([Z]),D]),O)).toString("ascii")})}signPsbt(J,$,Z,G){return oJ(this,void 0,void 0,function*(){let U=new lJ(J);if(Z!=null&&Z.length!=32)throw new Error("Invalid HMAC length");let O=new I$(G);O.addKnownList($.keys.map((R)=>Buffer.from(R,"ascii"))),O.addKnownPreimage($.serialize()),O.addKnownMapping(U.globalMerkleMap);for(let R of U.inputMerkleMaps)O.addKnownMapping(R);for(let R of U.outputMerkleMaps)O.addKnownMapping(R);O.addKnownList(U.inputMapCommitments);let D=new Z1(U.inputMapCommitments.map((R)=>A1(R))).getRoot();O.addKnownList(U.outputMapCommitments);let F=new Z1(U.outputMapCommitments.map((R)=>A1(R))).getRoot();yield this.makeRequest(FJ.SIGN_PSBT,Buffer.concat([U.getGlobalKeysValuesRoot(),h0(U.getGlobalInputCount()),D,h0(U.getGlobalOutputCount()),F,$.getWalletId(),Z||Buffer.alloc(32,0)]),O);let K=O.getYielded(),E=new Map;for(let R of K)E.set(R[0],R.slice(1));return E})}getMasterFingerprint(){return oJ(this,void 0,void 0,function*(){return this.makeRequest(FJ.GET_MASTER_FINGERPRINT,Buffer.from([]))})}signMessage(J,$){return oJ(this,void 0,void 0,function*(){if($.length>6)throw new Error("Path too long. At most 6 levels allowed.");let Z=new I$(()=>{}),G=Math.ceil(J.length/64),U=[];for(let F=0;F<G;F++)U.push(J.subarray(64*F,64*F+64));Z.addKnownList(U);let O=new Z1(U.map((F)=>A1(F))).getRoot();return(yield this.makeRequest(FJ.SIGN_MESSAGE,Buffer.concat([BQ($),h0(J.length),O]),Z)).toString("base64")})}}function GO(J){let $="TX";if($+=" version "+J.version.toString("hex"),J.locktime)$+=" locktime "+J.locktime.toString("hex");if(J.witness)$+=" witness "+J.witness.toString("hex");if(J.timestamp)$+=" timestamp "+J.timestamp.toString("hex");if(J.nVersionGroupId)$+=" nVersionGroupId "+J.nVersionGroupId.toString("hex");if(J.nExpiryHeight)$+=" nExpiryHeight "+J.nExpiryHeight.toString("hex");if(J.extraData)$+=" extraData "+J.extraData.toString("hex");return J.inputs.forEach(({prevout:Z,script:G,sequence:U},O)=>{$+=`
input ${O}:`,$+=` prevout ${Z.toString("hex")}`,$+=` script ${G.toString("hex")}`,$+=` sequence ${U.toString("hex")}`}),(J.outputs||[]).forEach(({amount:Z,script:G},U)=>{$+=`
output ${U}:`,$+=` amount ${Z.toString("hex")}`,$+=` script ${G.toString("hex")}`}),$}function VO(J,$=!1,Z=!1,G=!1,U=[]){let O=[],D=[],F=!1,K=0,E=Buffer.alloc(0),R=Buffer.alloc(0),C=Buffer.alloc(0),v=Buffer.alloc(0),c,N0,C0=U.includes("decred"),_0=U.includes("zencash"),f=U.includes("zcash"),w=Buffer.from(J,"hex"),k=w.slice(K,K+4),S=k.equals(Buffer.from([3,0,0,128]))||k.equals(Buffer.from([4,0,0,128]))||k.equals(Buffer.from([5,0,0,128])),P0=f&&k.equals(Buffer.from([5,0,0,128]));if(K+=4,!Z&&$&&w[K]===0&&w[K+1]!==0&&!_0)K+=2,F=!0;if(Z)E=w.slice(K,4+K),K+=4;if(S)C=w.slice(K,4+K),K+=4;if(P0)N0=w.slice(K+4,K+8),R=w.slice(K+8,K+12),K+=12;let h=WJ(w,K),S0=h[0];K+=h[1];for(let W=0;W<S0;W++){let Q=w.slice(K,K+36);K+=36;let Y=Buffer.alloc(0),V=Buffer.alloc(0);if(!C0)h=WJ(w,K),K+=h[1],Y=w.slice(K,K+h[0]),K+=h[0];else V=w.slice(K,K+1),K+=1;let A=w.slice(K,K+4);K+=4,O.push({prevout:Q,script:Y,sequence:A,tree:V})}h=WJ(w,K);let T=h[0];K+=h[1];for(let W=0;W<T;W++){let Q=w.slice(K,K+8);if(K+=8,C0)K+=2;h=WJ(w,K),K+=h[1];let Y=w.slice(K,K+h[0]);K+=h[0],D.push({amount:Q,script:Y})}if(F)c=w.slice(K,-4),N0=w.slice(w.length-4);else if(!P0)N0=w.slice(K,K+4);if(K+=4,(S||C0)&&!P0)R=w.slice(K,K+4),K+=4;if(G)v=w.slice(K);if(C0){if(h=WJ(w,K),K+=h[1],h[0]!==S0)throw new Error("splitTransaction: incoherent number of witnesses");for(let W=0;W<S0;W++){K+=8,K+=4,K+=4,h=WJ(w,K),K+=h[1];let Q=w.slice(K,K+h[0]);K+=h[0],O[W].script=Q}}let T0={version:k,inputs:O,outputs:D,locktime:N0,witness:c,timestamp:E,nVersionGroupId:C,nExpiryHeight:R,extraData:v};return fQ("btc",`splitTransaction ${J}:
${GO(T0)}`),T0}var R9=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})},j9={lockTime:SQ,sigHashType:j$,segwit:!1,transactionVersion:FV};function OO(J,$){return R9(this,void 0,void 0,function*(){let{inputs:Z,associatedKeysets:G,outputScriptHex:U,lockTime:O,sigHashType:D,segwit:F,transactionVersion:K}=Object.assign(Object.assign({},j9),$),E=Buffer.alloc(0),R=Buffer.alloc(0),C=Buffer.alloc(4);C.writeUInt32LE(K,0);let v=[],c=[],N0=[],C0=!0,_0=!1,f={inputs:[],version:C},w=F?hJ:fJ,k=Buffer.from(U,"hex");for(let S of Z){if(!_0){let S0=yield w(J,S[1],S[0]),T=Buffer.alloc(4);T.writeUInt32LE(S.length>=4&&typeof S[3]==="number"?S[3]:kJ,0),v.push({trustedInput:!1,value:F?Buffer.from(S0,"hex"):Buffer.from(S0,"hex").slice(4,40),sequence:T})}let{outputs:P0}=S[0],h=S[1];if(P0&&h<=P0.length-1)c.push(P0[h])}for(let S=0;S<Z.length;S++){let P0=Buffer.alloc(4);P0.writeUInt32LE(Z[S].length>=4&&typeof Z[S][3]==="number"?Z[S][3]:kJ,0),f.inputs.push({script:E,prevout:R,sequence:P0})}if(F)yield cJ(J,!0,f,v,!0),yield bJ(J,k);for(let S=0;S<Z.length;S++){let P0=Z[S],h=Z[S].length>=3&&typeof P0[2]==="string"?Buffer.from(P0[2],"hex"):c[S].script,S0=Object.assign({},f),T=F?[v[S]]:v;if(F)S0.inputs=[Object.assign(Object.assign({},S0.inputs[S]),{script:h})];else S0.inputs[S].script=h;if(yield cJ(J,!F&&C0,S0,T,F),!F)yield bJ(J,k);let T0=yield T$(J,G[S],O,D);if(N0.push(F?T0.toString("hex"):T0.slice(0,T0.length-1).toString("hex")),f.inputs[S].script=E,C0)C0=!1}return N0})}var AO=function(J,$,Z,G){function U(O){return O instanceof Z?O:new Z(function(D){D(O)})}return new(Z||(Z=Promise))(function(O,D){function F(R){try{E(G.next(R))}catch(C){D(C)}}function K(R){try{E(G.throw(R))}catch(C){D(C)}}function E(R){R.done?O(R.value):U(R.value).then(F,K)}E((G=G.apply(J,$||[])).next())})};class qO{constructor({transport:J,scrambleKey:$="BTC",currency:Z="bitcoin"}){this._transport=J,this._transport.decorateAppAPIMethods(this,["getWalletXpub","getWalletPublicKey","signP2SHTransaction","signMessage","createPaymentTransaction","getTrustedInput","getTrustedInputBIP143"],$),this._impl=(()=>{switch(Z){case"bitcoin":case"bitcoin_testnet":case"qtum":return new wQ(new QX(this._transport));default:return new dJ(this._transport)}})()}getWalletXpub(J){return this.changeImplIfNecessary().then(($)=>{return $.getWalletXpub(J)})}getWalletPublicKey(J,$){let Z;if(arguments.length>2||typeof $==="boolean")console.warn("btc.getWalletPublicKey deprecated signature used. Please switch to getWalletPublicKey(path, { format, verify })"),Z={verify:!!$,format:arguments[2]?"p2sh":"legacy"};else Z=$||{};return this.changeImplIfNecessary().then((G)=>{return G.getWalletPublicKey(J,Z)})}signMessage(J,$){return this.changeImplIfNecessary().then((Z)=>{return Z.signMessage({path:J,messageHex:$})})}createPaymentTransaction(J){if(arguments.length>1)throw new Error("@ledgerhq/hw-app-btc: createPaymentTransaction multi argument signature is deprecated. please switch to named parameters.");return this.changeImplIfNecessary().then(($)=>{return $.createPaymentTransaction(J)})}signP2SHTransaction(J){return OO(this._transport,J)}splitTransaction(J,$=!1,Z=!1,G=!1,U=[]){return VO(J,$,Z,G,U)}serializeTransactionOutputs(J){return pZ(J)}getTrustedInput(J,$,Z=[]){return fJ(this._transport,J,$,Z)}getTrustedInputBIP143(J,$,Z=[]){return hJ(this._transport,J,$,Z)}changeImplIfNecessary(){return AO(this,void 0,void 0,function*(){if(this._impl instanceof dJ)return this._impl;let{name:J,version:$}=yield yQ(this._transport);if(yield(()=>AO(this,void 0,void 0,function*(){switch(J){case"Bitcoin":case"Bitcoin Test":return ZX.default.lt($,"2.1.0");case"Bitcoin Legacy":case"Bitcoin Test Legacy":return!0;case"Exchange":return yield mV(this._transport);case"Qtum":return ZX.default.lt($,"3.0.0");default:return!0}}))())this._impl=new dJ(this._transport);return this._impl})}}export{qO as default};

//# debugId=26DB57D3831C907C64756E2164756E21
